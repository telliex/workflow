<!DOCTYPE html>
<html lang="zh-Hans">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>重构 - 找出代码的 24 种坏味道 | 前端学习</title>
    <meta name="description" content="工作流">
    <link rel="manifest" href="/workflow/manifest.json">
  <link rel="apple-touch-icon" href="/workflow/img/logo.png">
    
    <link rel="preload" href="/workflow/assets/css/0.styles.89c56574.css" as="style"><link rel="preload" href="/workflow/assets/js/app.21f02376.js" as="script"><link rel="preload" href="/workflow/assets/js/29.5466dfa8.js" as="script"><link rel="prefetch" href="/workflow/assets/js/10.21852b11.js"><link rel="prefetch" href="/workflow/assets/js/11.f64d45b2.js"><link rel="prefetch" href="/workflow/assets/js/12.9586b2eb.js"><link rel="prefetch" href="/workflow/assets/js/13.362695f8.js"><link rel="prefetch" href="/workflow/assets/js/14.5011e510.js"><link rel="prefetch" href="/workflow/assets/js/15.602ee5a0.js"><link rel="prefetch" href="/workflow/assets/js/16.f76b32cd.js"><link rel="prefetch" href="/workflow/assets/js/17.12a6afbb.js"><link rel="prefetch" href="/workflow/assets/js/18.eab1da27.js"><link rel="prefetch" href="/workflow/assets/js/19.2b640b10.js"><link rel="prefetch" href="/workflow/assets/js/2.d5709b3c.js"><link rel="prefetch" href="/workflow/assets/js/20.3398b7c2.js"><link rel="prefetch" href="/workflow/assets/js/21.c325b732.js"><link rel="prefetch" href="/workflow/assets/js/22.c3df5e1b.js"><link rel="prefetch" href="/workflow/assets/js/23.898e6112.js"><link rel="prefetch" href="/workflow/assets/js/24.051a0bbc.js"><link rel="prefetch" href="/workflow/assets/js/25.554600d3.js"><link rel="prefetch" href="/workflow/assets/js/26.16320fe2.js"><link rel="prefetch" href="/workflow/assets/js/27.512eede4.js"><link rel="prefetch" href="/workflow/assets/js/28.3e0725db.js"><link rel="prefetch" href="/workflow/assets/js/3.0689ac69.js"><link rel="prefetch" href="/workflow/assets/js/30.cd41e5b5.js"><link rel="prefetch" href="/workflow/assets/js/31.002ecbd9.js"><link rel="prefetch" href="/workflow/assets/js/32.a705fe0e.js"><link rel="prefetch" href="/workflow/assets/js/33.97b79008.js"><link rel="prefetch" href="/workflow/assets/js/34.3796137b.js"><link rel="prefetch" href="/workflow/assets/js/35.0b4e016b.js"><link rel="prefetch" href="/workflow/assets/js/36.dd2588d5.js"><link rel="prefetch" href="/workflow/assets/js/37.b7cf03a2.js"><link rel="prefetch" href="/workflow/assets/js/38.8e43f6aa.js"><link rel="prefetch" href="/workflow/assets/js/39.2fd073aa.js"><link rel="prefetch" href="/workflow/assets/js/4.1d131f68.js"><link rel="prefetch" href="/workflow/assets/js/40.739236ee.js"><link rel="prefetch" href="/workflow/assets/js/41.77a6a6db.js"><link rel="prefetch" href="/workflow/assets/js/42.147c2537.js"><link rel="prefetch" href="/workflow/assets/js/43.98113f75.js"><link rel="prefetch" href="/workflow/assets/js/44.7e138f8f.js"><link rel="prefetch" href="/workflow/assets/js/45.18960dae.js"><link rel="prefetch" href="/workflow/assets/js/46.5facf218.js"><link rel="prefetch" href="/workflow/assets/js/47.80ebf3e6.js"><link rel="prefetch" href="/workflow/assets/js/5.cb412c95.js"><link rel="prefetch" href="/workflow/assets/js/6.59392cf1.js"><link rel="prefetch" href="/workflow/assets/js/7.62b86de1.js"><link rel="prefetch" href="/workflow/assets/js/8.455db33c.js"><link rel="prefetch" href="/workflow/assets/js/9.eab8be47.js">
    <link rel="stylesheet" href="/workflow/assets/css/0.styles.89c56574.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/workflow/" class="home-link router-link-active"><!----> <span class="site-name">前端学习</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/workflow/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://confluence.shinho.net.cn/pages/viewpage.action?pageId=17127648" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Activo
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/telliex/telliex.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/workflow/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://confluence.shinho.net.cn/pages/viewpage.action?pageId=17127648" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Activo
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/telliex/telliex.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/workflow/work/" class="sidebar-link">工作流</a></li><li><a href="/workflow/demand/" class="sidebar-link">需求分析</a></li><li><a href="/workflow/task/" class="sidebar-link">任务拆解</a></li><li><a href="/workflow/user-story/" class="sidebar-link">使用者故事</a></li><li><a href="/workflow/test-strategy/" class="sidebar-link">测试策略</a></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>TDD</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/tdd/" class="sidebar-link">认识 TDD</a></li><li><a href="/workflow/tdd/TDD-touch.html" class="sidebar-link">TDD 轻体验</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>单元测试</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/ut/" class="sidebar-link">单元测试</a></li><li><a href="/workflow/ut/ut-vue.html" class="sidebar-link">Vue 单元测试</a></li><li><a href="/workflow/ut/jest.html" class="sidebar-link">Jest</a></li><li><a href="/workflow/ut/vue-jest-callback-functions.html" class="sidebar-link">异步调用</a></li><li><a href="/workflow/ut/vue-jest-mock.html" class="sidebar-link">Mock</a></li><li><a href="/workflow/ut/vue-jest-template1.html" class="sidebar-link">Jest 实战范例 1</a></li><li><a href="/workflow/ut/vue-jest-template2.html" class="sidebar-link">Jest 实战范例 2</a></li><li><a href="/workflow/ut/vue-jest-template3.html" class="sidebar-link">Jest 实战范例 3</a></li><li><a href="/workflow/ut/vue-jest-template4.html" class="sidebar-link">Jest 实战范例 4</a></li><li><a href="/workflow/ut/vue-jest-tools.html" class="sidebar-link">工具</a></li><li><a href="/workflow/ut/ut-doit.html" class="sidebar-link">实作</a></li><li><a href="/workflow/ut/ut-question.html" class="sidebar-link">问题</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>BDD 测试</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/vue-bdd-test/" class="sidebar-link">Vue BDD 测试</a></li><li><a href="/workflow/vue-bdd-test/bdd-cucumber.html" class="sidebar-link">Cucumber</a></li><li><a href="/workflow/vue-bdd-test/bdd-nightwatch.html" class="sidebar-link">Nightwatch</a></li><li><a href="/workflow/vue-bdd-test/bdd-cuketest.html" class="sidebar-link">Cuketest</a></li><li><a href="/workflow/vue-bdd-test/bdd-report.html" class="sidebar-link">bdd report</a></li><li><a href="/workflow/vue-bdd-test/bdd-doit.html" class="sidebar-link">实作 1</a></li><li><a href="/workflow/vue-bdd-test/bdd-doit-2.html" class="sidebar-link">实作 2</a></li></ul></div></li><li><a href="/workflow/performance/" class="sidebar-link">性能测试</a></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>重构</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/refactor/" class="active sidebar-link">代码坏味道</a></li><li><a href="/workflow/refactor/refactor.html" class="sidebar-link">重構</a></li><li><a href="/workflow/refactor/encapsulate.html" class="sidebar-link">封装</a></li><li><a href="/workflow/refactor/move.html" class="sidebar-link">搬移</a></li><li><a href="/workflow/refactor/anew.html" class="sidebar-link">重新组织数据</a></li><li><a href="/workflow/refactor/simplify.html" class="sidebar-link">简化条件逻辑</a></li><li><a href="/workflow/refactor/api.html" class="sidebar-link">重构API</a></li><li><a href="/workflow/refactor/inherit.html" class="sidebar-link">处理继承关系</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>设计模式</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/designpattern/" class="sidebar-link">设计模式</a></li></ul></div></li><li><a href="/workflow/function/" class="sidebar-link">函数式编程</a></li><li><a href="/workflow/explanation/" class="sidebar-link">名词解释</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="重构-找出代码的-24-种坏味道"><a href="#重构-找出代码的-24-种坏味道" aria-hidden="true" class="header-anchor">#</a> 重构 - 找出代码的 24 种坏味道</h1> <p>基于 Martin Fowler 所指导的重构，代码的24 条坏味道。</p> <h2 id="_1-神秘命名-mysterious-name"><a href="#_1-神秘命名-mysterious-name" aria-hidden="true" class="header-anchor">#</a> 1. 神秘命名 / Mysterious Name</h2> <p>深思熟虑如何给<strong>函数</strong>、<strong>模块</strong>、<strong>变量</strong>、<strong>类</strong>命名，使它们清晰表达自己的功能和用法。</p> <h3 id="改变函数声明-124"><a href="#改变函数声明-124" aria-hidden="true" class="header-anchor">#</a> <span id="s124">改变函数声明(124)</span></h3> <p>常见改名手段 1</p> <h4 id="函数改名-简单作法"><a href="#函数改名-简单作法" aria-hidden="true" class="header-anchor">#</a> 函数改名 / 简单作法</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">circum</span><span class="token punctuation">(</span><span class="token parameter">radius</span><span class="token punctuation">)</span><span class="token punctuation">{</span> # 围绕
  <span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span>Pi <span class="token operator">*</span> radius<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">circumference</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>radius<span class="token punctuation">)</span><span class="token punctuation">{</span> # 圆周
  <span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span>Pi <span class="token operator">*</span> radius<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>好的命名能一眼看出用途，不必查看实际代码。</p></div> <h4 id="函数改名-迁移式作法"><a href="#函数改名-迁移式作法" aria-hidden="true" class="header-anchor">#</a> 函数改名 / 迁移式作法</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">circum</span><span class="token punctuation">(</span><span class="token parameter">radius</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">circumference</span><span class="token punctuation">(</span>radius<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">circumference</span><span class="token punctuation">(</span><span class="token parameter">radius</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span>Pi <span class="token operator">*</span> radius<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>找出调用旧代码的地方改成新代码，改完后即可执行测试。未来所有调用者都改完后，就可以删除旧函数。</p></div> <h3 id="变量改名-137"><a href="#变量改名-137" aria-hidden="true" class="header-anchor">#</a> <span id="s137">变量改名(137)</span></h3> <p>常见改名手段 2</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> hight <span class="token operator">*</span> width
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> area <span class="token operator">=</span> hight <span class="token operator">*</span> width
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>好的变量命名可以很好解釋一段程式是干什麼用的，是整洁编程的核心。可将类型信息也放进变数名里，例如：aCustomer。</p></div> <h3 id="字段改名-244"><a href="#字段改名-244" aria-hidden="true" class="header-anchor">#</a> <span id="s224">字段改名(244)</span></h3> <p>常见改名手段 3</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Organization</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Organization</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">title</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>数据结构是理解程序行为的关键。所以字段的命名对理解非常重要。</p></div> <h2 id="_2-重复代码-duplicated-code"><a href="#_2-重复代码-duplicated-code" aria-hidden="true" class="header-anchor">#</a> 2. 重复代码 / Duplicated Code</h2> <p>在一个以上的地方看到相同的代码结构，可以肯定，将它们合而为一会让代码更好。</p> <h3 id="提炼函数-106"><a href="#提炼函数-106" aria-hidden="true" class="header-anchor">#</a> <span id="s106">提炼函数(106)</span></h3> <p>当一个类的两个函数里看到相同的表达式，我们就需要采用<code>提炼函数</code>提炼出重复部分，让两地都可以调用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">printOwing</span><span class="token punctuation">(</span><span class="token parameter">invoice</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">printBanner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> outstanding<span class="token operator">=</span><span class="token function">calculateOutstanding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//print details</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`name:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>invoice<span class="token punctuation">.</span>customer<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`amount:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>outstanding<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">printOwing</span><span class="token punctuation">(</span><span class="token parameter">invoice</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">printBanner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> outstanding<span class="token operator">=</span><span class="token function">calculateOutstanding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printDetails</span><span class="token punctuation">(</span>outstanding<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">printDetails</span><span class="token punctuation">(</span><span class="token parameter">outstanding</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`name:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>invoice<span class="token punctuation">.</span>customer<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`amount:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>outstanding<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>将意图与现实分开，如果需要花时间浏览一段代码才能弄清楚它到底在做什么，那就应该提炼到一个涵数中去。</p></div> <h3 id="移动语句-223"><a href="#移动语句-223" aria-hidden="true" class="header-anchor">#</a> <span id="s223">移动语句(223)</span></h3> <p>若代码只是相似并非相同，可先尝试<code>移动语句</code>重整代码顺序，把相似的放一起。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> pricingPlan <span class="token operator">=</span> <span class="token function">retrievePricingPlan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> oder <span class="token operator">=</span> <span class="token function">retreiveOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> charge<span class="token punctuation">;</span>
<span class="token keyword">const</span> chargePerUnit <span class="token operator">=</span> pricingPlan<span class="token punctuation">.</span>unit<span class="token punctuation">;</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> pricingPlan <span class="token operator">=</span> <span class="token function">retrievePricingPlan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> chargePerUnit <span class="token operator">=</span> pricingPlan<span class="token punctuation">.</span>unit<span class="token punctuation">;</span>
<span class="token keyword">const</span> oder <span class="token operator">=</span> <span class="token function">retreiveOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> charge<span class="token punctuation">;</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>几行代码用了同一个数据结构，最好将它们集中在一起，而不是参杂在代码中。这也常是<code>提取代码</code>的事前工作。</p></div> <h3 id="函数上移-350"><a href="#函数上移-350" aria-hidden="true" class="header-anchor">#</a> <span id="s350">函数上移(350)</span></h3> <p>若重复的部份位于同一个超类的不同子类中，使用<code>函数上移</code>，避免两个子类之间互相调用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Salesman</span> expends Employee<span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Engineer</span> expends Employee<span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Salesman</span> expends Employee<span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Engineer</span> expends Employee<span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>系统内有相同的函数，就会面临修改其一，但另一各未能修改的风险。</p></div> <h2 id="_3-过长函数-long-function"><a href="#_3-过长函数-long-function" aria-hidden="true" class="header-anchor">#</a> 3. 过长函数 / Long Function</h2> <p>我们应该积极的分解函数，让函数变短，保持清晰。</p> <h3 id="提炼函数-106-2"><a href="#提炼函数-106-2" aria-hidden="true" class="header-anchor">#</a> 提炼函数(106)</h3> <p>99% 将函数变短，只需使用<code>提炼函数</code>。<br>
参考：<a href="#s106">重复代码 Duplicated Code | 提炼函数(106)</a></p> <h3 id="以查询取代临时变量-178"><a href="#以查询取代临时变量-178" aria-hidden="true" class="header-anchor">#</a> <span id="s178">以查询取代临时变量(178)</span></h3> <p>消除因<code>提炼函数</code>所造成的大量参数与临时变量。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> basePrice <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_quantity <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_itemPrice<span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>basePrice<span class="token operator">&gt;</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> basePrice <span class="token operator">*</span> <span class="token number">0.95</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> basePrice <span class="token operator">*</span> <span class="token number">0.98</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">get</span> <span class="token function">basePrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>_quantity <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_itemPrice<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token operator">...</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>basePrice<span class="token operator">&gt;</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>basePrice <span class="token operator">*</span> <span class="token number">0.95</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>basePrice <span class="token operator">*</span> <span class="token number">0.98</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>分解一个冗长的函数时，将变量提取到函数里能使过程更为简单，因为不需要将变量作为参数传给提炼出来得函数。良好效果表现在类别及嵌函数的使用上。</p></div> <h3 id="引入参数对象-140"><a href="#引入参数对象-140" aria-hidden="true" class="header-anchor">#</a> <span id="s140">引入参数对象(140)</span></h3> <p>可将过长得参数表变得更简洁。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">amountInvoiced</span><span class="token punctuation">(</span><span class="token parameter">startDate<span class="token punctuation">,</span>endDate</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">amountReceived</span><span class="token punctuation">(</span><span class="token parameter">startDate<span class="token punctuation">,</span>endDate</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">amountOverdue</span><span class="token punctuation">(</span><span class="token parameter">startDate<span class="token punctuation">,</span>endDate</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">amountInvoiced</span><span class="token punctuation">(</span><span class="token parameter">aDateRange</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">amountReceived</span><span class="token punctuation">(</span><span class="token parameter">aDateRange</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">amountOverdue</span><span class="token punctuation">(</span><span class="token parameter">aDateRange</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>将数据组成结构，可以避免众多函数参杂造成的<code>数据泥团</code>。</p></div> <h3 id="保持对象完整-319"><a href="#保持对象完整-319" aria-hidden="true" class="header-anchor">#</a> <span id="s319">保持对象完整(319)</span></h3> <p>可将过长得参数表变得更简洁。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> low <span class="token operator">=</span> aRoom<span class="token punctuation">.</span>daysTempRange<span class="token punctuation">.</span>low<span class="token punctuation">;</span>
<span class="token keyword">const</span> high <span class="token operator">=</span> aRoom<span class="token punctuation">.</span>daysTempRange<span class="token punctuation">.</span>high<span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>aPlan<span class="token punctuation">.</span><span class="token function">withRange</span><span class="token punctuation">(</span>low<span class="token punctuation">,</span>high<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span>aPlan<span class="token punctuation">.</span><span class="token function">withRange</span><span class="token punctuation">(</span>aRoom<span class="token punctuation">.</span>daysTempRange<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>如果从一个记录结构中取出几个值，然后把这几个值传递给一个函数，我会更倾向于将整个记录结构传给该参数，在函数内部导出所需要的值。</p></div> <h3 id="以命令取代函数-337"><a href="#以命令取代函数-337" aria-hidden="true" class="header-anchor">#</a> <span id="s337">以命令取代函数(337)</span></h3> <p>临时参数及变量的杀手。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">score</span><span class="token punctuation">(</span><span class="token parameter">candidate<span class="token punctuation">,</span>medicalExam<span class="token punctuation">,</span>scoringGuide</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> healthLevel <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token comment">// long body code</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Score</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">candidate<span class="token punctuation">,</span>medicalExam<span class="token punctuation">,</span>scoringGuide</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_canicate <span class="token operator">=</span> candidate<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_medicalExam<span class="token operator">=</span>medicalExam<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_scoringGuide<span class="token operator">=</span>scoringGuide<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_result<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_healthLevel<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">// long body code</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>将函数封装成对象，我们称为<strong>命令</strong>。大部分需求，函数即可达到(95%)，当函数无法到需求时，才会使用命令对象。</p></div> <h3 id="以查询取代参数-324"><a href="#以查询取代参数-324" aria-hidden="true" class="header-anchor">#</a> <span id="s324">以查询取代参数(324)</span></h3> <p>如果向某参数发起查询而获得另一个参数值，那就可采<code>以查询取代参数</code>，去掉第二个参数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">availableVacation</span><span class="token punctuation">(</span>anEmployee<span class="token punctuation">,</span>anEmployee<span class="token punctuation">.</span>grade<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">availableVacation</span><span class="token punctuation">(</span><span class="token parameter">anEmployee<span class="token punctuation">,</span>grade</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">availableVacation</span><span class="token punctuation">(</span>anEmployee<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">availableVacation</span><span class="token punctuation">(</span><span class="token parameter">anEmployee</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> grade <span class="token operator">=</span> anEmployee<span class="token punctuation">.</span>grade<span class="token punctuation">;</span>
  <span class="token comment">// calculate vacation</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>将获得正确参数值的责任转到函数本身。若移除参数会造成函数不必要的依赖关系或是引用透明性，则不使用。</p></div> <h3 id="分解条件表达式-260"><a href="#分解条件表达式-260" aria-hidden="true" class="header-anchor">#</a> <span id="s260">分解条件表达式(260)</span></h3> <p>提取条件表式和循环。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>aDate<span class="token punctuation">.</span><span class="token function">isBefore</span><span class="token punctuation">(</span>plan<span class="token punctuation">.</span>summerStart<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token operator">!</span>aDate<span class="token punctuation">.</span><span class="token function">isAfter</span><span class="token punctuation">(</span>plan<span class="token punctuation">.</span>summerEnd<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">summer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  charge <span class="token operator">=</span> <span class="token function">summerCharge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">else</span>
  charge <span class="token operator">=</span> <span class="token function">regularCharge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>复杂的条件逻辑是最常导致复杂度上升，以函数提炼复杂的判断条件。</p></div> <h3 id="以多态取代条件表达式-272"><a href="#以多态取代条件表达式-272" aria-hidden="true" class="header-anchor">#</a> <span id="s272">以多态取代条件表达式(272)</span></h3> <p>多个 switch 语句基于同一个条件进行分支选择，就该用<code>以多态取代条件表达式</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">switch</span><span class="token punctuation">(</span>bird<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">case</span> <span class="token string">'EuropenSwallow'</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">&quot;average&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">case</span> <span class="token string">'AfricanSwallow'</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>bird<span class="token punctuation">.</span>numberOfCoconuts<span class="token operator">&gt;</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">?</span><span class="token string">&quot;tired&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;average&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">case</span> <span class="token string">'NorwegianBlueParrot'</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>bird<span class="token punctuation">.</span>voltage <span class="token operator">&gt;</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">?</span><span class="token string">&quot;scorched&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;beautiful&quot;</span><span class="token punctuation">;</span>  
  <span class="token keyword">default</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">&quot;unknown&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">EuropenSwallow</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">plumage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;average&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">AfricanSwallow</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">plumage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>bird<span class="token punctuation">.</span>numberOfCoconuts<span class="token operator">&gt;</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">?</span><span class="token string">&quot;tired&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;average&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">NorwegianBlueParrot</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">plumage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>bird<span class="token punctuation">.</span>voltage <span class="token operator">&gt;</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">?</span><span class="token string">&quot;scorched&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;beautiful&quot;</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>复杂条件逻辑时，可采用多态來改善。</p></div> <h3 id="拆分循环-227"><a href="#拆分循环-227" aria-hidden="true" class="header-anchor">#</a> <span id="s227">拆分循环(227)</span></h3> <p>循环所提取出来的函数，如果还是做著多件事，会造成很难命名，此时需要<code>拆分循环</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> averageAge <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> totalSalary <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> p <span class="token keyword">of</span> people<span class="token punctuation">)</span><span class="token punctuation">{</span>
  averageAge <span class="token operator">+=</span> <span class="token constant">P</span><span class="token punctuation">.</span>page<span class="token punctuation">;</span>
  totalSalary <span class="token operator">+=</span> p<span class="token punctuation">.</span>salary<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
averageAge <span class="token operator">=</span> averageAge <span class="token operator">/</span> people<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> totalSalary <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> p <span class="token keyword">of</span> people<span class="token punctuation">)</span><span class="token punctuation">{</span>
  totalSalary <span class="token operator">+=</span> p<span class="token punctuation">.</span>salary<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> averageAge <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> p <span class="token keyword">of</span> people<span class="token punctuation">)</span><span class="token punctuation">{</span>
  averageAge <span class="token operator">+=</span> <span class="token constant">P</span><span class="token punctuation">.</span>page<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

averageAge <span class="token operator">=</span> averageAge <span class="token operator">/</span> people<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>将循环拆分，让一个循环只做一件事。</p></div> <h2 id="_4-过长参数列表-long-parameter-list"><a href="#_4-过长参数列表-long-parameter-list" aria-hidden="true" class="header-anchor">#</a> 4. 过长参数列表 / Long Parameter List</h2> <p>过长的参数列表，经常令人迷惑。</p> <h3 id="以查询取代参数-324-2"><a href="#以查询取代参数-324-2" aria-hidden="true" class="header-anchor">#</a> 以查询取代参数(324)</h3> <p>可向某个参数发起查询而获得另一个参数值，以去掉参数。<br>
参考：<a href="A">过长函数 Long Function ｜ 以查询取代参数(324)</a></p> <h3 id="保持对象完整-319-2"><a href="#保持对象完整-319-2" aria-hidden="true" class="header-anchor">#</a> 保持对象完整(319)</h3> <p>正从现有的数据结构中抽出很多数据项，可考虑使用<code>保持对象完整</code>，直接传入原来的数据结构。<br>
参考：<a href="#s319">过长函数 Long Function | 保持对象完整(319)</a></p> <h3 id="引入参数对象-140-2"><a href="#引入参数对象-140-2" aria-hidden="true" class="header-anchor">#</a> 引入参数对象(140)</h3> <p>可将多个参数合并成一个对象。<br>
参考：<a href="#s140">过长函数 Long Function | 引入参数对象(140)</a></p> <h3 id="移除标记参数-314"><a href="#移除标记参数-314" aria-hidden="true" class="header-anchor">#</a> <span id="s314">移除标记参数(314)</span></h3> <p>若参数被用作区别函数行为的标记</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">steDimension</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>name<span class="token operator">===</span><span class="token string">&quot;height&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token operator">=</span>value<span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>name<span class="token operator">===</span><span class="token string">&quot;width&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_width<span class="token operator">=</span>value<span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">setHeight</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token operator">=</span>value<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">setWidth</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>_width<span class="token operator">=</span>value<span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>当参数值会影响函数内部的控制流，我们才称为标记参数。标记参数让人难以理解哪些函数可以调用，该怎么调用。</p></div> <h3 id="函数组合成类-144"><a href="#函数组合成类-144" aria-hidden="true" class="header-anchor">#</a> <span id="s144">函数组合成类(144)</span></h3> <p>将共用参数变成类得共用字段。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">base</span><span class="token punctuation">(</span><span class="token parameter">aReading</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">taxableCharge</span><span class="token punctuation">(</span><span class="token parameter">aReading</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">calculateBaseCharge</span><span class="token punctuation">(</span><span class="token parameter">aReading</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Readng</span><span class="token punctuation">{</span>
  <span class="token function">base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">taxableCharge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">calculateBaseCharge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>当一组函数形影不离的操作著同一组数据，我们就可以建个类。</p></div> <h2 id="_5-全局数据-global-data"><a href="#_5-全局数据-global-data" aria-hidden="true" class="header-anchor">#</a> 5. 全局数据 / Global Data</h2> <p>全局变量在程式码内的每个角落沟可以修改它，可想出现 bug 时的追踪有多困难。</p> <h3 id="封装变量-132"><a href="#封装变量-132" aria-hidden="true" class="header-anchor">#</a> <span id="s132">封装变量(132)</span></h3> <p>首要得防御手段</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> defaultOwner <span class="token operator">=</span> <span class="token punctuation">{</span>firstName<span class="token punctuation">:</span><span class="token string">&quot;Martin&quot;</span><span class="token punctuation">,</span>lastName<span class="token punctuation">:</span><span class="token string">&quot;Flower&quot;</span><span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> defaultOwnerData <span class="token operator">=</span> <span class="token punctuation">{</span>firstName<span class="token punctuation">:</span><span class="token string">&quot;Martin&quot;</span><span class="token punctuation">,</span>lastName<span class="token punctuation">:</span><span class="token string">&quot;Flower&quot;</span><span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">defaultOwner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> defaultOwnerData<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">setDefaultOwner</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span>defaultOwnerData <span class="token operator">=</span> arg<span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>对所有可变的数据，只要作用域超过单个函数，就将其封装。</p></div> <h2 id="_6-可变数据-mutable-data"><a href="#_6-可变数据-mutable-data" aria-hidden="true" class="header-anchor">#</a> 6. 可变数据 / Mutable Data</h2> <p>对数据的修改，经常导致出乎意料的结果和难以发现的 bug。</p> <h3 id="封装变量-132-2"><a href="#封装变量-132-2" aria-hidden="true" class="header-anchor">#</a> 封装变量(132)</h3> <p>确保所有的数据更新都可够过特定的函数进行，更容易监控演进。<br>
参考：<a href="#s132">全局数据 Global Data｜ 封装变量(132)</a></p> <h3 id="拆分变量-240"><a href="#拆分变量-240" aria-hidden="true" class="header-anchor">#</a> <span id="s240">拆分变量(240)</span></h3> <p>如果一个变量不同时候被存储不同东西，可拆分各自不同用途的变量，变免危险的更新操作。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> temp <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>height <span class="token operator">+</span> width<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
temp <span class="token operator">=</span> height <span class="token operator">*</span> width<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> perimeter <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>height <span class="token operator">+</span> width<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>perimeter<span class="token punctuation">)</span>
<span class="token keyword">const</span> area <span class="token operator">=</span> height <span class="token operator">+</span> width<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>area<span class="token punctuation">)</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>每个变量只负责单一个责任。</p></div> <h3 id="移动语句-223-2"><a href="#移动语句-223-2" aria-hidden="true" class="header-anchor">#</a> 移动语句(223)</h3> <p>将没有副作用的代码跟执行数据更新的代码分开。<br>
参考：<a href="#s223">重复代码 Duplicated Code｜ 移动语句(223)</a></p> <h3 id="提炼函数-106-3"><a href="#提炼函数-106-3" aria-hidden="true" class="header-anchor">#</a> 提炼函数(106)</h3> <p>将没有副作用的代码跟执行数据更新的代码分开。<br>
参考：<a href="#s106">重复代码 Duplicated Code | 提炼函数(106)</a></p> <h3 id="将查询函数和修改函数分离-306"><a href="#将查询函数和修改函数分离-306" aria-hidden="true" class="header-anchor">#</a> <span id="s306">将查询函数和修改函数分离(306)</span></h3> <p>确保不会调用到有副作用的代码。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getTotalOutstandingAndSendBill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> customer<span class="token punctuation">.</span>invoices<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">total<span class="token punctuation">,</span>each</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> each<span class="token punctuation">.</span>amount <span class="token operator">+</span> total<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token function">sendBill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getTotalOutstandingAndSendBill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> customer<span class="token punctuation">.</span>invoices<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">total<span class="token punctuation">,</span>each</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> each<span class="token punctuation">.</span>amount <span class="token operator">+</span> total<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">sendBill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  emailGeteway<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token function">formatBill</span><span class="token punctuation">(</span>customer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>除去函数的副作用。<br>
函数副作用 指当调用函数时，除了返回函数值之外，还对主调用函数产生附加的影响。例如修改全局变量（函数外的变量）或修改参数。</p></div> <h3 id="移除预设函数-331"><a href="#移除预设函数-331" aria-hidden="true" class="header-anchor">#</a> <span id="s331">移除预设函数(331)</span></h3> <p>不需要更新的数据，请使用<code>移除预设函数</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">person</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token parameter">aString</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">person</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>不希望在对象创建后字段还有机会被改变，就不要提供设值函数。</p></div> <h3 id="以查询取代派生变量-248"><a href="#以查询取代派生变量-248" aria-hidden="true" class="header-anchor">#</a> <span id="s248">以查询取代派生变量(248)</span></h3> <p>避免捆扰、bug 和加班，别让可变数据的值可以在其他地方被计算出来。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">get</span> <span class="token function">discountedTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_discountedTotal<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">set</span> <span class="token function">discount</span><span class="token punctuation">(</span><span class="token parameter">aNumber</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> old <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_discount<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_discount<span class="token operator">=</span>aNumber<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_discountedTotal<span class="token operator">+=</span>old<span class="token operator">-</span>aNumber<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">get</span> <span class="token function">discountedTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_baseTotal<span class="token operator">-</span><span class="token keyword">this</span><span class="token punctuation">.</span>_discount<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">set</span> <span class="token function">discount</span><span class="token punctuation">(</span><span class="token parameter">aNumber</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_discount<span class="token operator">=</span>aNumber<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>避免一处修改数据，一處卻造成破壞，尽量把可变数据的作用限制在最小范围。</p></div> <h3 id="函数组合成类-144-2"><a href="#函数组合成类-144-2" aria-hidden="true" class="header-anchor">#</a> 函数组合成类(144)</h3> <p>限制对变量进行修改的代码量。<br>
参考：<a href="#s144">过长参数列表 Long Parameter List｜ 函数组合成类(144)</a></p> <h3 id="函数组合成变换-149"><a href="#函数组合成变换-149" aria-hidden="true" class="header-anchor">#</a> <span id="s149">函数组合成变换(149)</span></h3> <p>限制对变量进行修改的代码量。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">base</span><span class="token punctuation">(</span><span class="token parameter">aReading</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">taxableCharge</span><span class="token punctuation">(</span><span class="token parameter">aReading</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">enrichReading</span><span class="token punctuation">(</span><span class="token parameter">argReading</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> aReading <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">cloneDeep</span><span class="token punctuation">(</span>argReading<span class="token punctuation">)</span><span class="token punctuation">;</span>
  aReading<span class="token punctuation">.</span>baseCharge <span class="token operator">=</span> <span class="token function">base</span><span class="token punctuation">(</span>aReading<span class="token punctuation">)</span><span class="token punctuation">;</span>
  aReading<span class="token punctuation">.</span>taxableCharge <span class="token operator">=</span> <span class="token function">taxableCharge</span><span class="token punctuation">(</span>aReading<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> aReading<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>将所有的派生数据逻辑收拢到一处，这样始终可以在固定地方更新逻辑，也可避免重复。</p></div> <h3 id="将引用对象改成值对象-252"><a href="#将引用对象改成值对象-252" aria-hidden="true" class="header-anchor">#</a> <span id="s252">将引用对象改成值对象(252)</span></h3> <p>如果一个变量在其内部结构中包含了数据，请用<code>将引用对象改成值对象</code>替换整个数据结构。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Produt</span><span class="token punctuation">{</span>
  <span class="token function">applyDiscount</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_price<span class="token punctuation">.</span>amount <span class="token operator">-</span> <span class="token operator">=</span> arg<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Produt</span><span class="token punctuation">{</span>
  <span class="token function">applyDiscount</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>_price<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Money</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_price<span class="token punctuation">.</span>amount<span class="token operator">-</span>arg<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>_price_currency<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_7-发散式变化-divergent-change"><a href="#_7-发散式变化-divergent-change" aria-hidden="true" class="header-anchor">#</a> 7. 发散式变化 / Divergent Change</h2> <p>某个模块经常因为不同原因，在不同方向发生变化，便会出现发散式变化。每加入新需求变，需要更动两个以上地方，便是发散式变化的徵兆</p> <h3 id="拆分阶段-154"><a href="#拆分阶段-154" aria-hidden="true" class="header-anchor">#</a> <span id="s154">拆分阶段(154)</span></h3> <p>若发生变化的两个方向，有先后次序关系，我们可以用<code>拆分阶段</code>将两者拆开。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> orderData <span class="token operator">=</span> orderString<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/\s+/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> productPrice <span class="token operator">=</span> priceList<span class="token punctuation">[</span>orderData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">[</span><span class="token string">&quot;-&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> orderPrice <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>orderData<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> productPrice<span class="token punctuation">;</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> orderRecord <span class="token operator">=</span> <span class="token function">parseOrder</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> orderPrice <span class="token operator">=</span> <span class="token function">price</span><span class="token punctuation">(</span>orderRecord<span class="token punctuation">,</span>productList<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">parseOrder</span><span class="token punctuation">(</span><span class="token parameter">aString</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> values <span class="token operator">=</span> aString<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/\s+/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    productID<span class="token punctuation">:</span>values<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    quantity<span class="token punctuation">:</span><span class="token function">parseInt</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">price</span><span class="token punctuation">(</span><span class="token parameter">order<span class="token punctuation">,</span>priceList</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> order<span class="token punctuation">.</span>quantity <span class="token operator">*</span> priceList<span class="token punctuation">[</span>productID<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>将同时处理两件事的代码拆成各自独立的模块，避免修改时要同时理解两件事。类似编译器的例子，将任务拆解成一系列的动作，每一步都有明确得范围，我们可以聚焦其中一步，而不用思考其他步骤。</p></div> <h3 id="搬移函数-198"><a href="#搬移函数-198" aria-hidden="true" class="header-anchor">#</a> <span id="s198">搬移函数(198)</span></h3> <p>若两者方向间有更多的来回调用，需先创建模块，用<code>搬移函数</code>把处理逻辑分开。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Account</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">overdraftCharge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">AccountType</span>
  <span class="token keyword">get</span> <span class="token function">overdraftCharge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>当函数频繁的引用其他上下文中的元素，而对自身上下文元素却关心甚少。</p></div> <h3 id="提炼函数-106-4"><a href="#提炼函数-106-4" aria-hidden="true" class="header-anchor">#</a> 提炼函数(106)</h3> <p>函数内混合了两类的处理逻辑，需先提炼函数，再做搬移。<br>
参考：<a href="#s106">重复代码 Duplicated Code | 提炼函数(106)</a></p> <h3 id="提炼类-182"><a href="#提炼类-182" aria-hidden="true" class="header-anchor">#</a> <span id="s182">提炼类(182)</span></h3> <p>如果模块是以类形式定义，则用提炼类做拆分。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">officeAreaCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_officeAreaCode<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">officeNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_officeNumber<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">person</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">officeAreaCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_telephoneNumber<span class="token punctuation">.</span>areaCode<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">officeNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_telephoneNumber<span class="token punctuation">.</span>number<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">telephoneNumber</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">areaCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_areaCode<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_number<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>类随著功能不断叠加会，会越来越复杂，很快的就会一团乱，此时需要考虑哪些部分可以分离成一个独立类。</p></div> <h2 id="_8-散彈式修改-shotgun-surgery"><a href="#_8-散彈式修改-shotgun-surgery" aria-hidden="true" class="header-anchor">#</a> 8. 散彈式修改 / Shotgun Surgery</h2> <p>每遇到不同的变化，需要在不同的类内做修改，便是散彈式修改。</p> <h3 id="搬移函数-198-2"><a href="#搬移函数-198-2" aria-hidden="true" class="header-anchor">#</a> 搬移函数(198)</h3> <p>将需要修改的代码四处散落，很找得到它，<code>搬移函数</code>需要采用放进模块。<br>
参考：<a href="#s198">发散式变化 Divergent Change | 搬移函数(198)</a></p> <h3 id="搬移字段-207"><a href="#搬移字段-207" aria-hidden="true" class="header-anchor">#</a> <span id="s207">搬移字段(207)</span></h3> <p><code>搬移字段</code>配合<code>搬移函数</code>，将需要修改的代码放进模块。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Customer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">plan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plan<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">discountRate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_discountRate<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Customer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">plan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plan<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">discountRate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>plan<span class="token punctuation">.</span>discountRate<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>调整数据结构，保持意图清晰</p></div> <h3 id="函数组合成类-144-3"><a href="#函数组合成类-144-3" aria-hidden="true" class="header-anchor">#</a> 函数组合成类(144)</h3> <p>如果很多函数都在操作类似数据，使用<code>函数组合成类</code>。<br>
参考：<a href="#s144">过长参数列表 Long Parameter List｜ 函数组合成类(144)</a></p> <h3 id="函数组合成变换-149-2"><a href="#函数组合成变换-149-2" aria-hidden="true" class="header-anchor">#</a> 函数组合成变换(149)</h3> <p>函数的功能是转化或充实数据结构。<br>
参考：<a href="#s149">可变数据 Mutable Data | 函数组合成变换</a></p> <h3 id="拆分阶段-154-2"><a href="#拆分阶段-154-2" aria-hidden="true" class="header-anchor">#</a> 拆分阶段(154)</h3> <p>函数的输出组合用作其他委托者的计算逻辑,可时就需要将此处<code>拆分阶段</code>。<br>
参考：<a href="#s154">发散式变化 Divergent Change | 拆分阶段</a></p> <h3 id="内联函数-115"><a href="#内联函数-115" aria-hidden="true" class="header-anchor">#</a> 内联函数(115)</h3> <p>将不该分散的逻辑放回一块。<br>
参考：<a href="#s115">中間人 Middle Man | 内联函数(115)</a></p> <h3 id="内联类-116"><a href="#内联类-116" aria-hidden="true" class="header-anchor">#</a> 内联类(116)</h3> <p>将不该分散的逻辑放回一块。<br>
参考：<a href="#s186">夸夸其談通用性 Speculative Generality | 内联类(186)</a></p> <h2 id="_9-依戀情結-feature-envy"><a href="#_9-依戀情結-feature-envy" aria-hidden="true" class="header-anchor">#</a> 9. 依戀情結 / Feature Envy</h2> <p>模块，代码区分出区域，最大化区域的内部交互，最小化跨区域的交互。我们会发现一函数跟另一个模块或数据交流格外频繁，远胜于自己模块内部的交流。</p> <h3 id="搬移函数-198-3"><a href="#搬移函数-198-3" aria-hidden="true" class="header-anchor">#</a> 搬移函数(198)</h3> <p>从另一对象调用大半功能的函数，就让该函数跟数据在一起吧。<br>
参考：<a href="#s198"> 发散式变化 Divergent Change | 搬移函数(198)</a></p> <h3 id="提炼函数-106-5"><a href="#提炼函数-106-5" aria-hidden="true" class="header-anchor">#</a> 提炼函数(106)</h3> <p>函数内若只有一小部分有这苦，就先<code>提炼函数</code>，再<code>搬移函数</code>。<br>
参考：<a href="#s106">重复代码 Duplicated Code ｜ 提炼函数(106)</a></p> <h2 id="_10-數據泥團-data-clumps"><a href="#_10-數據泥團-data-clumps" aria-hidden="true" class="header-anchor">#</a> 10. 數據泥團 / Data Clumps</h2> <p>将散落在类中的数据字段和函数中的相同参数提炼到一个独立的对象中。</p> <h3 id="提炼类-182-2"><a href="#提炼类-182-2" aria-hidden="true" class="header-anchor">#</a> 提炼类(182)</h3> <p>找出这些数据以字段出现的地方，<code>提炼类</code>将它门移到独立对象中。<br>
参考：<a href="#s182">发散式变化 Divergent Change | 提炼类(182)</a></p> <h3 id="引入参数对象-140-3"><a href="#引入参数对象-140-3" aria-hidden="true" class="header-anchor">#</a> 引入参数对象(140)</h3> <p>将注意力放到函数签名(js 没有函数签名)上。js 作法是将函数参数列表缩短。<br>
参考：<a href="#s140">过长函数 Long Function | 引入参数对象(140)</a></p> <h3 id="保持对象完整-319-3"><a href="#保持对象完整-319-3" aria-hidden="true" class="header-anchor">#</a> 保持对象完整(319)</h3> <p>将注意力放到函数签名(js 没有函数签名)上。js 作法是将函数参数列表缩短。<br>
参考：<a href="#s319">过长函数 Long Function | 保持对象完整(319)</a></p> <h2 id="_11-基本類型偏執-primitive-obsession"><a href="#_11-基本類型偏執-primitive-obsession" aria-hidden="true" class="header-anchor">#</a> 11. 基本類型偏執 / Primitive Obsession</h2> <p>建立与问题域有用的基本类型</p> <h3 id="以对象取代基本类型-174"><a href="#以对象取代基本类型-174" aria-hidden="true" class="header-anchor">#</a> <span id="s174">以对象取代基本类型(174)</span></h3> <p>以<code>以对象取代基本类型</code>将单独存在的数据值替换成对象。</p> <div class="language-js extra-class"><pre class="language-js"><code>order<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token operator">=&gt;</span><span class="token string">&quot;heigh&quot;</span><span class="token operator">===</span>o<span class="token punctuation">.</span>priority <span class="token operator">||</span> <span class="token string">&quot;rush&quot;</span><span class="token operator">===</span>o<span class="token punctuation">.</span>priority<span class="token punctuation">)</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code>order<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token operator">=&gt;</span>o<span class="token punctuation">.</span>priority<span class="token punctuation">.</span><span class="token function">higherThan</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Priority</span><span class="token punctuation">(</span><span class="token string">&quot;normal&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>一开始的开发，对数据的需求可能仅是简单型态，随著业务的变化，数据的使用型态也会改变。</p></div> <h3 id="以子类取代类型码-362-以多态取代条件表达式-272"><a href="#以子类取代类型码-362-以多态取代条件表达式-272" aria-hidden="true" class="header-anchor">#</a> 以子类取代类型码(362) + 以多态取代条件表达式(272)</h3> <p>如果欲替换的数据值是控制条件的类型码，则可用<code>以子类取代类型码</code>＋<code>以多态取代条件表达式</code>。<br>
参考：<a href="#s362">過大的類 Large Class | 以子类取代类型码(362)</a><br>
参考：<a href="#s272">过长函数 Long Function ｜ 以多态取代条件表达式(272)</a></p> <h3 id="提炼类-182-引入参数对象-140"><a href="#提炼类-182-引入参数对象-140" aria-hidden="true" class="header-anchor">#</a> 提炼类(182) + 引入参数对象(140)</h3> <p>如果有一组总是出现的基本类型数据。可用<code>提炼类</code>+ <code>引入参数对象</code>，移除数据泥团。<br>
参考：<a href="#s182">发散式变化 Divergent Change | 提炼类(182)</a><br>
参考：<a href="#s140">过长函数 Long Function | 引入参数对象(140)</a></p> <h2 id="_12-重複的-switch-repeated-switches"><a href="#_12-重複的-switch-repeated-switches" aria-hidden="true" class="header-anchor">#</a> 12. 重複的 switch / Repeated Switches</h2> <p>重复 Switch 的问题在于，每当想增加一个选择分支时，必须找到所有的 switch。使用多态。</p> <h3 id="以多态取代条件表达式-272-2"><a href="#以多态取代条件表达式-272-2" aria-hidden="true" class="header-anchor">#</a> 以多态取代条件表达式(272)</h3> <p>把 switch 以多态取代。<br>
参考：<a href="#s272">过长函数 Long Function ｜ 以多态取代条件表达式(272)</a></p> <h2 id="_13-循環語句-loops"><a href="#_13-循環語句-loops" aria-hidden="true" class="header-anchor">#</a> 13. 循環語句 / loops</h2> <p>以 pipline 来取代循环语句，可以让程式的意图更清楚。</p> <h3 id="以管道取代循环-231"><a href="#以管道取代循环-231" aria-hidden="true" class="header-anchor">#</a> <span id="s231">以管道取代循环(231)</span></h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> i <span class="token keyword">of</span> input<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>job<span class="token operator">===</span><span class="token string">&quot;programmer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    names<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> names<span class="token operator">=</span>input
  <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token operator">=&gt;</span>i<span class="token punctuation">.</span>job<span class="token operator">===</span><span class="token string">&quot;programmer&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token operator">=&gt;</span>i<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>如今越来越多的编程语言提供更好的语言结构来处理迭代过程，称集合管道(collection pipeline)。</p></div> <h2 id="_14-冗贅的元素-lazy-element"><a href="#_14-冗贅的元素-lazy-element" aria-hidden="true" class="header-anchor">#</a> 14. 冗贅的元素 / Lazy Element</h2> <p>别高估了此前类或函数的能力，设想未来它会变大变复杂，有时他只是个简单的功能。</p> <h3 id="内联函数-115-2"><a href="#内联函数-115-2" aria-hidden="true" class="header-anchor">#</a> 内联函数(115)</h3> <p>参考：<a href="#s115">中間人 Middle Man | 内联函数(115)</a></p> <h3 id="内联类-186"><a href="#内联类-186" aria-hidden="true" class="header-anchor">#</a> 内联类(186)</h3> <p>参考：<a href="#s186">夸夸其談通用性 Speculative Generality | 内联类(186)</a></p> <h3 id="摺叠继承系统-380"><a href="#摺叠继承系统-380" aria-hidden="true" class="header-anchor">#</a> 摺叠继承系统(380)</h3> <p>若处于一个继承体系，可用<code>摺叠继承系统</code>。<br>
参考：<a href="#s380">夸夸其談通用性 Speculative Generality | 摺叠继承系统(380)</a></p> <h2 id="_15-夸夸其談通用性-speculative-generality"><a href="#_15-夸夸其談通用性-speculative-generality" aria-hidden="true" class="header-anchor">#</a> 15. 夸夸其談通用性 / Speculative Generality</h2> <p>企图以各式各样的钩子和特殊情况来处理非必要的事情。用不到的就移除它，别去假设未到的场景而增加不必要的弹性。</p> <h3 id="摺叠继承系统-380-2"><a href="#摺叠继承系统-380-2" aria-hidden="true" class="header-anchor">#</a> <span id="s380">摺叠继承系统(380)</span></h3> <p>某个抽象类没太大作用，请<code>摺叠继承系统</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Salesman</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>随著继承演化，重构继承体系时，会发现某些类已和超类没差别，这时就会将子类和超类合并。</p></div> <h3 id="内联函数-115-3"><a href="#内联函数-115-3" aria-hidden="true" class="header-anchor">#</a> 内联函数(115)</h3> <p><code>内联函数</code>除去不必要的委托。<br>
参考：<a href="#s115">中間人 Middle Man | 内联函数(115)</a></p> <h3 id="内联类-186-2"><a href="#内联类-186-2" aria-hidden="true" class="header-anchor">#</a> <span id="s186">内联类(186)</span></h3> <p><code>内联类</code>除去不必要的委托。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">person</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">officeAreaCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_telephoneNumber<span class="token punctuation">.</span>areaCode<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">officeNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_telephoneNumber<span class="token punctuation">.</span>number<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">telephoneNumber</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">areaCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_areaCode<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_number<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">officeAreaCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_officeAreaCode<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">officeNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_officeNumber<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>与<code>[提炼类(182)](#s182)</code>作用相反。一个类不再有存在的理由，便可使其&quot;萎缩&quot;,塞进另一个类中。</p></div> <h3 id="改变函数声明-124-2"><a href="#改变函数声明-124-2" aria-hidden="true" class="header-anchor">#</a> 改变函数声明(124)</h3> <p>若函数的某些参数未被用上,<code>改变函数声明</code>，去掉参数。<br>
参考：<a href="#s124">神秘命名 Mysterious Name | 改变函数声明(124)</a></p> <h3 id="移除死代码-237"><a href="#移除死代码-237" aria-hidden="true" class="header-anchor">#</a> 移除死代码(237)</h3> <p>若函数或类只供测试用例使用，先删掉测试用例，再<code>移除死代码</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">doSomethingThatUseToMatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>一段代码不再被使用，应立刻消灭它，避免日后花更高的成本去理解这样一个不会被用到代码。勿用注解方式。</p></div> <h2 id="_16-臨時字段-temporary-field"><a href="#_16-臨時字段-temporary-field" aria-hidden="true" class="header-anchor">#</a> 16. 臨時字段 Temporary Field</h2> <p>避免发生猜测，请将仅为特定情况使用到的代码独立出去。</p> <h3 id="提炼类-182-3"><a href="#提炼类-182-3" aria-hidden="true" class="header-anchor">#</a> 提炼类(182)</h3> <p>为孤儿造一个家。<br>
参考：<a href="#s182">发散式变化 Divergent Change | 提炼类(182)</a></p> <h3 id="搬移函数-198-4"><a href="#搬移函数-198-4" aria-hidden="true" class="header-anchor">#</a> 搬移函数(198)</h3> <p>将相关的代码都放进新家吧<br>
参考：<a href="#s198"> 发散式变化 Divergent Change | 搬移函数(198)</a></p> <h3 id="引入特例-289"><a href="#引入特例-289" aria-hidden="true" class="header-anchor">#</a> <span id="s289">引入特例(289)</span></h3> <p>变量不合法时创一个替代对象。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span>aCustomer <span class="token operator">===</span> <span class="token string">&quot;unknown&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span> customerName <span class="token operator">=</span> <span class="token string">&quot;occupant&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">customerName</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;occupant&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>代码中某段常被呼叫，用来检查某个特殊值。创建一个特例元素，用来处理共用处理。特例可以一个字面量对象、含有行为的对象或类</p></div> <h2 id="_17-過長的消息鏈-message-chains"><a href="#_17-過長的消息鏈-message-chains" aria-hidden="true" class="header-anchor">#</a> 17. 過長的消息鏈 / Message Chains</h2> <p>当请求动作表现出来的是一连串的依赖，我们就需要去思考最终所得对象是用来干什么的。</p> <h3 id="隐藏委托关系-189"><a href="#隐藏委托关系-189" aria-hidden="true" class="header-anchor">#</a> 隐藏委托关系(189)</h3> <p>可以在消息链的不同位置使用<code>隐藏委托关系</code>。<br>
参考：<a href="#s198">內幕交易 Insider Trading | 隐藏委托关系(189)</a></p> <h3 id="提炼函数-106-6"><a href="#提炼函数-106-6" aria-hidden="true" class="header-anchor">#</a> 提炼函数(106)</h3> <p>再找出最终得到的对象是用来作什么的，将带马蹄练到一个函数中。<br>
参考：<a href="#s106">重复代码 Duplicated Code ｜ 提炼函数(106)</a></p> <h3 id="搬移函数-198-5"><a href="#搬移函数-198-5" aria-hidden="true" class="header-anchor">#</a> 搬移函数(198)</h3> <p>再将函数推入消息链。若还有其他客户端代码需要访问链上的其他对象，同样再添加一个函数来完事。<br>
参考：<a href="#s198"> 发散式变化 Divergent Change | 搬移函数(198)</a></p> <h2 id="_18-中間人-middle-man"><a href="#_18-中間人-middle-man" aria-hidden="true" class="header-anchor">#</a> 18. 中間人 / Middle Man</h2> <p>某个类中的接口中有一半以上的函数都委托给其他类，这就发生了过度委托</p> <h3 id="移除中间人-192"><a href="#移除中间人-192" aria-hidden="true" class="header-anchor">#</a> <span id="s192">移除中间人(192)</span></h3> <p>直接和负责的对象打交道。</p> <div class="language-js extra-class"><pre class="language-js"><code>manager <span class="token operator">=</span> aPersion<span class="token punctuation">.</span>manager<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">manager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Department<span class="token punctuation">.</span>manager<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code>manager <span class="token operator">=</span> aPersion<span class="token punctuation">.</span>department<span class="token punctuation">.</span>manager<span class="token punctuation">;</span>
</code></pre></div><h3 id="内联函数-115-4"><a href="#内联函数-115-4" aria-hidden="true" class="header-anchor">#</a> <span id="s115">内联函数(115)</span></h3> <p>把不做正事的函数放进调用端。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getRating</span><span class="token punctuation">(</span><span class="token parameter">driver</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">moreThanFiveLateDeliveries</span><span class="token punctuation">(</span>driver<span class="token punctuation">)</span><span class="token operator">?</span> <span class="token number">2</span> <span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">moreThanFiveLateDeliveries</span><span class="token punctuation">(</span><span class="token parameter">driver</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> driver<span class="token punctuation">.</span>numberOfLateDeliveries <span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getRating</span><span class="token punctuation">(</span><span class="token parameter">driver</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>driver<span class="token punctuation">.</span>numberOfLateDeliveries <span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token number">2</span> <span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="以委托取代超类-399"><a href="#以委托取代超类-399" aria-hidden="true" class="header-anchor">#</a> 以委托取代超类(399)</h3> <p>若中间人还也其他动作，可将动作提取为真正对象。<br>
参考：<a href="#s381">被拒絕的遺贈 Refused Bequest | 以委托取代超类(399)</a></p> <h3 id="以委托取代子类-381"><a href="#以委托取代子类-381" aria-hidden="true" class="header-anchor">#</a> 以委托取代子类(381)</h3> <p>若中间人还也其他动作，可将动作提取为真正对象。<br>
参考：<a href="#s381">被拒絕的遺贈 Refused Bequest | 以委托取代子类(381)</a></p> <h2 id="_19-內幕交易-insider-trading"><a href="#_19-內幕交易-insider-trading" aria-hidden="true" class="header-anchor">#</a> 19. 內幕交易 /  Insider Trading</h2> <p>模块之间一定的数据交换是不可避免的，但我们还是会尽量避免这情况，将交换都放道明面上来。</p> <h3 id="搬移函数-198-6"><a href="#搬移函数-198-6" aria-hidden="true" class="header-anchor">#</a> 搬移函数(198)</h3> <p>使用<code>搬移函数</code>吧，可减模块间的窃窃私语。<br>
参考：<a href="#s198"> 发散式变化 Divergent Change | 搬移函数(198)</a></p> <h3 id="搬移字段-207-2"><a href="#搬移字段-207-2" aria-hidden="true" class="header-anchor">#</a> 搬移字段(207)</h3> <p>加上<code>搬移字段</code>，可减模块间的窃窃私语。<br>
参考：<a href="#s207">散彈式修改 Shotgun Surgery ｜ 搬移字段(207)</a></p> <h3 id="隐藏委托关系-189-2"><a href="#隐藏委托关系-189-2" aria-hidden="true" class="header-anchor">#</a> <span id="s189">隐藏委托关系(189)</span></h3> <p>将另一个模块变成两者的中介</p> <div class="language-js extra-class"><pre class="language-js"><code>manager<span class="token operator">=</span>aPerson<span class="token punctuation">.</span>department<span class="token punctuation">.</span>manager<span class="token punctuation">;</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code>manager<span class="token operator">=</span>aPerson<span class="token punctuation">.</span>manager<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token keyword">get</span> <span class="token function">manager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>department<span class="token punctuation">.</span>manager<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>透过 建立委托函数 manager，隐藏了 department 的工作原理。</p></div> <h3 id="以委托取代子类-381-2"><a href="#以委托取代子类-381-2" aria-hidden="true" class="header-anchor">#</a> 以委托取代子类(381)</h3> <p>参考：<a href="#s381">被拒絕的遺贈 Refused Bequest | 以委托取代子类(381)</a></p> <h3 id="以委托取代超类-399-2"><a href="#以委托取代超类-399-2" aria-hidden="true" class="header-anchor">#</a> 以委托取代超类(399)</h3> <p>参考：<a href="#s381">被拒絕的遺贈 Refused Bequest | 以委托取代超类(399)</a></p> <h2 id="_20-過大的類-large-class"><a href="#_20-過大的類-large-class" aria-hidden="true" class="header-anchor">#</a> 20. 過大的類 / Large Class</h2> <p>想利用一个类就把所有的事情做完，往往重复代码的情况就会接踵而至。</p> <h3 id="提炼类-182-4"><a href="#提炼类-182-4" aria-hidden="true" class="header-anchor">#</a> 提炼类(182)</h3> <p>彼此相关的变数应该放在一起，可先利用<code>提炼类</code>，将代码练到新类。<br>
参考：<a href="#s182">发散式变化 Divergent Change | 提炼类(182)</a></p> <h3 id="提炼超类-375"><a href="#提炼超类-375" aria-hidden="true" class="header-anchor">#</a> 提炼超类(375)</h3> <p>如组件适合做成一个类，可使用<code>提炼超类</code>。<br>
参考：<a href="#s375">異曲同工的類 Alternative Classes with Different Interfaces | 提炼超类(375)</a></p> <h3 id="以子类取代类型码-362"><a href="#以子类取代类型码-362" aria-hidden="true" class="header-anchor">#</a> <span id="s362">以子类取代类型码(362)</span></h3> <p>如组件适合做成一个类，也可使用<code>以子类取代类型码</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createEmployee</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>type</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>type<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createEmployee</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>type</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&quot;engineer&quot;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Engineer</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&quot;salesman&quot;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Salesman</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&quot;manager&quot;</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Manager</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>可将类型码传入类别，使用多态来管理</p></div> <h2 id="_21-異曲同工的類-alternative-classes-with-different-interfaces"><a href="#_21-異曲同工的類-alternative-classes-with-different-interfaces" aria-hidden="true" class="header-anchor">#</a> 21. 異曲同工的類 / Alternative Classes with Different Interfaces</h2> <p>使用类的好处，即可以在需要时进行替换。 我们需要做..</p> <h3 id="改变函数声明-124-3"><a href="#改变函数声明-124-3" aria-hidden="true" class="header-anchor">#</a> 改变函数声明(124)</h3> <p>1.两个接口一致才能替换，所以我们需要先使用<code>改变函数声明</code>，将函数签名变得一致。<br>
参考：<a href="#s124">神秘命名 Mysterious Name | 改变函数声明(124)</a></p> <h3 id="搬移函数-198-7"><a href="#搬移函数-198-7" aria-hidden="true" class="header-anchor">#</a> 搬移函数(198)</h3> <p>2.反覆<code>搬移函数</code>，将行为移入类，直到两者协议一致。<br>
参考：<a href="#s198"> 发散式变化 Divergent Change | 搬移函数(198)</a></p> <h3 id="提炼超类-375-2"><a href="#提炼超类-375-2" aria-hidden="true" class="header-anchor">#</a> <span id="s375">提炼超类(375)</span></h3> <p>如果搬移过程造成代码重复，适时使用<code>提取超类</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Development</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">totalAnnualCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">headCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">annualCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Party</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">annualCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Department</span> <span class="token keyword">extends</span> <span class="token class-name">Party</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">annualCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">headCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token keyword">extends</span> <span class="token class-name">Party</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">annualCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>看到两个类在做相同的事情，可以利用基本的继承机制将相似之处提取到超类。</p></div> <h2 id="_22-純數據類-data-class"><a href="#_22-純數據類-data-class" aria-hidden="true" class="header-anchor">#</a> 22. 純數據類 / Data class</h2> <p>仅拥有一些字段，及用于访问这些字段的函数。没其他的了。</p> <h3 id="封装记录-162"><a href="#封装记录-162" aria-hidden="true" class="header-anchor">#</a> <span id="s162">封装记录(162)</span></h3> <p>若常被操控著，请尽早封装。不需修改的数据无需封装。</p> <div class="language-js extra-class"><pre class="language-js"><code>organization <span class="token operator">=</span> <span class="token punctuation">{</span>
  mame<span class="token punctuation">:</span><span class="token string">&quot;Acme Gooseberries&quot;</span><span class="token punctuation">,</span>
  country<span class="token punctuation">:</span><span class="token string">&quot;GB&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">organization</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_name <span class="token operator">=</span> data<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_country <span class="token operator">=</span> data<span class="token punctuation">.</span>country<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">set</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>_name <span class="token operator">=</span> arg<span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">country</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_country<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">set</span> <span class="token function">country</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>_country <span class="token operator">=</span> arg<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>将记录型结构的<code>可变数据</code>以<code>类对象</code>储存，类对象可以隐藏细节，不必追究储存的细节和计算的过程。</p></div> <h3 id="移除预设函数-331-2"><a href="#移除预设函数-331-2" aria-hidden="true" class="header-anchor">#</a> 移除预设函数(331)</h3> <p>不需异动的数据，就别让它被异动<br>
参考：<a href="#s331">可变数据 Mutable Data ｜ 移除预设函数(331)</a></p> <h3 id="搬移函数-198-8"><a href="#搬移函数-198-8" aria-hidden="true" class="header-anchor">#</a> 搬移函数(198)</h3> <p>将操控著此处数据的调用者找出，<code>搬移函数</code>，将调用行为搬到该类来。<br>
参考：<a href="#s198">可变数据 Mutable Data ｜ 搬移函数(198)</a></p> <h3 id="提炼函数-106-7"><a href="#提炼函数-106-7" aria-hidden="true" class="header-anchor">#</a> 提炼函数(106)</h3> <p>若无法搬移整个函数，就请<code>提炼函数</code>，产生可被搬移的函数。<br>
参考：<a href="#s106">重复代码 Duplicated Code ｜ 提炼函数(106)</a></p> <h3 id="拆分阶段-154-3"><a href="#拆分阶段-154-3" aria-hidden="true" class="header-anchor">#</a> 拆分阶段(154)</h3> <p>纯数据调用对象，被用作函数的返回结果，得到中转数据结构。<br>
参考：<a href="#s154">发散式变化 Divergent Change | 拆分阶段</a></p> <h2 id="_23-被拒絕的遺贈-refused-bequest"><a href="#_23-被拒絕的遺贈-refused-bequest" aria-hidden="true" class="header-anchor">#</a> 23. 被拒絕的遺贈 / Refused Bequest</h2> <p>子类应该依照真实需求去复用超类的的行为，若用不到超类的功能，就别去继承。</p> <h3 id="函数下移-359"><a href="#函数下移-359" aria-hidden="true" class="header-anchor">#</a> <span id="s359">函数下移(359)</span></h3> <p>继承的超类里，用不到的函数，就移到独立的新子类里去。如此超类便只持有所有子类共享的东西。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">quota</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">engineer</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">salesman</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">engineer</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">salesman</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">quota</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>如果超类内的某个函数，只与一个子类有关，那么最好将其移走，挪到子类去。</p></div> <h3 id="字段下移"><a href="#字段下移" aria-hidden="true" class="header-anchor">#</a> 字段下移</h3> <p>继承的超类里，用不到的字段，就移到独立的新子类里去。如此超类便只持有所有子类共享的东西。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>
  <span class="token keyword">private</span> String quota<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">engineer</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">salesman</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">engineer</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">salesman</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>
  <span class="token keyword">private</span> String quota<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>如果字段只被子类使用，便从超类移到子类去。</p></div> <h3 id="以委托取代子类-381-3"><a href="#以委托取代子类-381-3" aria-hidden="true" class="header-anchor">#</a> <span id="s381">以委托取代子类(381)</span></h3> <p>继承关系遇到问题时，<code>以委托取代子类</code>是常见情况。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Order</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">daysToShip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_warehouse<span class="token punctuation">.</span>daysToShip<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">PriorityOrder</span> <span class="token keyword">extends</span> <span class="token class-name">Order</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">daysToShip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_priorityPlan<span class="token punctuation">.</span>daysToShip<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Order</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">daysToShip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_priorityOrderDelegate<span class="token punctuation">)</span>
      <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_priorityDelegate<span class="token punctuation">.</span>daysToShip
      <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_warehouse<span class="token punctuation">.</span>daysToShip<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">PriorityOrderDelegate</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">daysToShip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_priorityPlan<span class="token punctuation">.</span>daysToShip<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="以委托取代超类-399-3"><a href="#以委托取代超类-399-3" aria-hidden="true" class="header-anchor">#</a> <span id="s399">以委托取代超类(399)</span></h3> <p>继承关系遇到问题时，<code>以委托取代超类</code>是常见情况。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">List</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">stack</span> <span class="token keyword">extends</span> <span class="token class-name">List</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">stack</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_storage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">List</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">List</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>如果超类的一些函数对子类并不适用，就说明我们不应该通过继承来获得超类得功能。改用委托。</p></div> <h2 id="_24-注释-comments"><a href="#_24-注释-comments" aria-hidden="true" class="header-anchor">#</a> 24. 注释 / Comments</h2> <p>此处不是否定注解的功用。而是留心省思我们代理里下注解的地方，是不是有前面提到的坏味道。代码中有注解的地方，是我们对传达没法握，觉得该处没法清楚让未来的修改者理解。试著让注释变得多馀看看。</p> <h3 id="提炼函数-106-8"><a href="#提炼函数-106-8" aria-hidden="true" class="header-anchor">#</a> 提炼函数(106)</h3> <p>若需要注释来解释代码块，请先试试<code>提炼函数</code>。<br>
参考：<a href="#s106">重复代码 Duplicated Code | 提炼函数(106)</a></p> <h3 id="改变函数声明-124-4"><a href="#改变函数声明-124-4" aria-hidden="true" class="header-anchor">#</a> 改变函数声明(124)</h3> <p>好的函数命名可以一眼看出函数用途，不必查看代码。函数的参数亦是。<br>
参考：<a href="#s124">神秘命名 Mysterious Name | 改变函数声明(124)</a></p> <h3 id="引入断言-302"><a href="#引入断言-302" aria-hidden="true" class="header-anchor">#</a> 引入断言(302)</h3> <p>以断言来说明程式码规格需求。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>discountRate<span class="token punctuation">)</span><span class="token punctuation">{</span>
  base<span class="token operator">=</span>base<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>discountRate<span class="token operator">*</span>base<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">assert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>discountRate<span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>discountRate<span class="token punctuation">)</span><span class="token punctuation">{</span>
  base<span class="token operator">=</span>base<span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>discountRate<span class="token operator">*</span>base<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>当某个条件为真时，某段代码才能正常运行。断言对于交流很有帮助，可以告诉阅读者，程式执行道该处时，对当前状态做了何种假设。</p></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2019-8-13 19:57:02</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/workflow/performance/" class="prev">
          性能测试
        </a></span> <span class="next"><a href="/workflow/refactor/refactor.html">
          重構
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/workflow/assets/js/app.21f02376.js" defer></script><script src="/workflow/assets/js/29.5466dfa8.js" defer></script>
  </body>
</html>
