<!DOCTYPE html>
<html lang="zh-Hans">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>搬移 | 前端学习</title>
    <meta name="description" content="工作流">
    <link rel="manifest" href="/workflow/manifest.json">
  <link rel="apple-touch-icon" href="/workflow/img/logo.png">
    
    <link rel="preload" href="/workflow/assets/css/0.styles.89c56574.css" as="style"><link rel="preload" href="/workflow/assets/js/app.21f02376.js" as="script"><link rel="preload" href="/workflow/assets/js/34.3796137b.js" as="script"><link rel="prefetch" href="/workflow/assets/js/10.21852b11.js"><link rel="prefetch" href="/workflow/assets/js/11.f64d45b2.js"><link rel="prefetch" href="/workflow/assets/js/12.9586b2eb.js"><link rel="prefetch" href="/workflow/assets/js/13.362695f8.js"><link rel="prefetch" href="/workflow/assets/js/14.5011e510.js"><link rel="prefetch" href="/workflow/assets/js/15.602ee5a0.js"><link rel="prefetch" href="/workflow/assets/js/16.f76b32cd.js"><link rel="prefetch" href="/workflow/assets/js/17.12a6afbb.js"><link rel="prefetch" href="/workflow/assets/js/18.eab1da27.js"><link rel="prefetch" href="/workflow/assets/js/19.2b640b10.js"><link rel="prefetch" href="/workflow/assets/js/2.d5709b3c.js"><link rel="prefetch" href="/workflow/assets/js/20.3398b7c2.js"><link rel="prefetch" href="/workflow/assets/js/21.c325b732.js"><link rel="prefetch" href="/workflow/assets/js/22.c3df5e1b.js"><link rel="prefetch" href="/workflow/assets/js/23.898e6112.js"><link rel="prefetch" href="/workflow/assets/js/24.051a0bbc.js"><link rel="prefetch" href="/workflow/assets/js/25.554600d3.js"><link rel="prefetch" href="/workflow/assets/js/26.16320fe2.js"><link rel="prefetch" href="/workflow/assets/js/27.512eede4.js"><link rel="prefetch" href="/workflow/assets/js/28.3e0725db.js"><link rel="prefetch" href="/workflow/assets/js/29.5466dfa8.js"><link rel="prefetch" href="/workflow/assets/js/3.0689ac69.js"><link rel="prefetch" href="/workflow/assets/js/30.cd41e5b5.js"><link rel="prefetch" href="/workflow/assets/js/31.002ecbd9.js"><link rel="prefetch" href="/workflow/assets/js/32.a705fe0e.js"><link rel="prefetch" href="/workflow/assets/js/33.97b79008.js"><link rel="prefetch" href="/workflow/assets/js/35.0b4e016b.js"><link rel="prefetch" href="/workflow/assets/js/36.dd2588d5.js"><link rel="prefetch" href="/workflow/assets/js/37.b7cf03a2.js"><link rel="prefetch" href="/workflow/assets/js/38.8e43f6aa.js"><link rel="prefetch" href="/workflow/assets/js/39.2fd073aa.js"><link rel="prefetch" href="/workflow/assets/js/4.1d131f68.js"><link rel="prefetch" href="/workflow/assets/js/40.739236ee.js"><link rel="prefetch" href="/workflow/assets/js/41.77a6a6db.js"><link rel="prefetch" href="/workflow/assets/js/42.147c2537.js"><link rel="prefetch" href="/workflow/assets/js/43.98113f75.js"><link rel="prefetch" href="/workflow/assets/js/44.7e138f8f.js"><link rel="prefetch" href="/workflow/assets/js/45.18960dae.js"><link rel="prefetch" href="/workflow/assets/js/46.5facf218.js"><link rel="prefetch" href="/workflow/assets/js/47.80ebf3e6.js"><link rel="prefetch" href="/workflow/assets/js/5.cb412c95.js"><link rel="prefetch" href="/workflow/assets/js/6.59392cf1.js"><link rel="prefetch" href="/workflow/assets/js/7.62b86de1.js"><link rel="prefetch" href="/workflow/assets/js/8.455db33c.js"><link rel="prefetch" href="/workflow/assets/js/9.eab8be47.js">
    <link rel="stylesheet" href="/workflow/assets/css/0.styles.89c56574.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/workflow/" class="home-link router-link-active"><!----> <span class="site-name">前端学习</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/workflow/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://confluence.shinho.net.cn/pages/viewpage.action?pageId=17127648" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Activo
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/telliex/telliex.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/workflow/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://confluence.shinho.net.cn/pages/viewpage.action?pageId=17127648" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Activo
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/telliex/telliex.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/workflow/work/" class="sidebar-link">工作流</a></li><li><a href="/workflow/demand/" class="sidebar-link">需求分析</a></li><li><a href="/workflow/task/" class="sidebar-link">任务拆解</a></li><li><a href="/workflow/user-story/" class="sidebar-link">使用者故事</a></li><li><a href="/workflow/test-strategy/" class="sidebar-link">测试策略</a></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>TDD</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/tdd/" class="sidebar-link">认识 TDD</a></li><li><a href="/workflow/tdd/TDD-touch.html" class="sidebar-link">TDD 轻体验</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>单元测试</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/ut/" class="sidebar-link">单元测试</a></li><li><a href="/workflow/ut/ut-vue.html" class="sidebar-link">Vue 单元测试</a></li><li><a href="/workflow/ut/jest.html" class="sidebar-link">Jest</a></li><li><a href="/workflow/ut/vue-jest-callback-functions.html" class="sidebar-link">异步调用</a></li><li><a href="/workflow/ut/vue-jest-mock.html" class="sidebar-link">Mock</a></li><li><a href="/workflow/ut/vue-jest-template1.html" class="sidebar-link">Jest 实战范例 1</a></li><li><a href="/workflow/ut/vue-jest-template2.html" class="sidebar-link">Jest 实战范例 2</a></li><li><a href="/workflow/ut/vue-jest-template3.html" class="sidebar-link">Jest 实战范例 3</a></li><li><a href="/workflow/ut/vue-jest-template4.html" class="sidebar-link">Jest 实战范例 4</a></li><li><a href="/workflow/ut/vue-jest-tools.html" class="sidebar-link">工具</a></li><li><a href="/workflow/ut/ut-doit.html" class="sidebar-link">实作</a></li><li><a href="/workflow/ut/ut-question.html" class="sidebar-link">问题</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>BDD 测试</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/vue-bdd-test/" class="sidebar-link">Vue BDD 测试</a></li><li><a href="/workflow/vue-bdd-test/bdd-cucumber.html" class="sidebar-link">Cucumber</a></li><li><a href="/workflow/vue-bdd-test/bdd-nightwatch.html" class="sidebar-link">Nightwatch</a></li><li><a href="/workflow/vue-bdd-test/bdd-cuketest.html" class="sidebar-link">Cuketest</a></li><li><a href="/workflow/vue-bdd-test/bdd-report.html" class="sidebar-link">bdd report</a></li><li><a href="/workflow/vue-bdd-test/bdd-doit.html" class="sidebar-link">实作 1</a></li><li><a href="/workflow/vue-bdd-test/bdd-doit-2.html" class="sidebar-link">实作 2</a></li></ul></div></li><li><a href="/workflow/performance/" class="sidebar-link">性能测试</a></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>重构</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/refactor/" class="sidebar-link">代码坏味道</a></li><li><a href="/workflow/refactor/refactor.html" class="sidebar-link">重構</a></li><li><a href="/workflow/refactor/encapsulate.html" class="sidebar-link">封装</a></li><li><a href="/workflow/refactor/move.html" class="active sidebar-link">搬移</a></li><li><a href="/workflow/refactor/anew.html" class="sidebar-link">重新组织数据</a></li><li><a href="/workflow/refactor/simplify.html" class="sidebar-link">简化条件逻辑</a></li><li><a href="/workflow/refactor/api.html" class="sidebar-link">重构API</a></li><li><a href="/workflow/refactor/inherit.html" class="sidebar-link">处理继承关系</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>设计模式</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/designpattern/" class="sidebar-link">设计模式</a></li></ul></div></li><li><a href="/workflow/function/" class="sidebar-link">函数式编程</a></li><li><a href="/workflow/explanation/" class="sidebar-link">名词解释</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="搬移"><a href="#搬移" aria-hidden="true" class="header-anchor">#</a> 搬移</h1> <ul><li><a href="#s198">(198)搬移函数</a></li> <li><a href="#s207">(207)搬移字段 / Move Field</a></li> <li><a href="#s213">(213)搬移语句到函数 / Move Statements into Function</a></li> <li><a href="#s217">(217)搬移语句到调用者 / Move Statements to Callers</a></li> <li><a href="#s222">(222)以函数调用取代内联代码 / Replace Inline Code with Function Call</a></li> <li><a href="#s223">(223)移动语句 / Slide Statements</a></li> <li><a href="#s227">(227)拆分循环 / Split Loop</a></li> <li><a href="#s231">(231)以管道取代循环 / Replace Loop with Pipeline</a></li> <li><a href="#s237">(237)移除死代码 / Remove Dead Code</a></li></ul> <h2 id="_198-搬移函数"><a href="#_198-搬移函数" aria-hidden="true" class="header-anchor">#</a> <span id="s198">(198)搬移函数</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Account</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">overdraftChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">AccountType</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">overdraftChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ul><li>搬移函数最直接的一个动因是，它频繁引用其他上下文中的元素，而对自身上下文中的元素却关心甚少。</li> <li>搬移函数后有了新的上下文，记得需重新命名。</li> <li>如果函数拥有一些子函数，且是该函数是这些子函数唯一的调用者，可先将函数内联进来,搬移后再重新提炼出子函数。</li></ul></div> <h2 id="_207-搬移字段-move-field"><a href="#_207-搬移字段-move-field" aria-hidden="true" class="header-anchor">#</a> <span id="s207">(207)搬移字段 / Move Field</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Customer</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">plan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plan<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">discountRate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_discountRate<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Customer</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">plan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plan<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">discountRate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>plan<span class="token punctuation">.</span>discountRate<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>如果修改一条记录时，总是需要更动条记录，那么说明很可能字段放错了位置。</li> <li>如果更新一字段时，需要同时在多个结构中做出修改，表明该字段需要备搬移到一个集中的地点。</li> <li>类的实例函数确实简化了搬移数据的操作，因为它已经将数据的存取封装到访问函数中。</li> <li>如果要搬移的字段是裸记录，并且被许多函数直接访问，可以先为记录建立相应的<code>访问函数</code>。</li></ol></div> <h3 id="完整范例"><a href="#完整范例" aria-hidden="true" class="header-anchor">#</a> 完整范例</h3> <p>调整代码顺序，将类似的代码放一起</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Customer</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>discountRate</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token operator">=</span>name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_discountRate<span class="token operator">=</span>discountRate<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_contract<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">CustomerContract</span><span class="token punctuation">(</span><span class="token function">dateToday</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">discountRate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_discountRate<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">becomePreferred</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_discountRate <span class="token operator">+=</span><span class="token number">0.03</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">applyDiscount</span><span class="token punctuation">(</span><span class="token parameter">amount</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> amount<span class="token punctuation">.</span><span class="token function">subtract</span><span class="token punctuation">(</span>amount<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_discountRate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">CustomerContract</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">startDate</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_startDate<span class="token operator">=</span>startDate<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Customer</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>discountRate</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token operator">=</span>name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_setDiscountRate</span><span class="token punctuation">(</span>discountRate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_contract<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">CustomerContract</span><span class="token punctuation">(</span><span class="token function">dateToday</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">discountRate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_contract<span class="token punctuation">.</span>discountRate<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">_setDiscountRate</span><span class="token punctuation">(</span><span class="token parameter">aNumber</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_contract<span class="token punctuation">.</span>discountRate<span class="token operator">=</span>aNumber<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">becomePreferred</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_setDiscountRate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>discountRate <span class="token operator">+</span> <span class="token number">0.03</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">applyDiscount</span><span class="token punctuation">(</span><span class="token parameter">amount</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> amount<span class="token punctuation">.</span><span class="token function">subtract</span><span class="token punctuation">(</span>amount<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>discountRate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">CustomerContract</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">startDate<span class="token punctuation">,</span>discountRate</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_startDate<span class="token operator">=</span>startSate<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_discountRate<span class="token operator">=</span>discountRate<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">discountRate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_discountRate<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">set</span> <span class="token function">discountRate</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_discountRate<span class="token operator">=</span>arg<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>搬移裸记录</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">class</span> <span class="token class-name">Account</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">number<span class="token punctuation">,</span>type<span class="token punctuation">,</span>interestRate</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token operator">=</span>number<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_type<span class="token operator">=</span>type<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_interestRate<span class="token operator">=</span>interestRate<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">interestRate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_interestRate<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">AccountType</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">nameString</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token operator">=</span>nameString<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Account</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">number<span class="token punctuation">,</span>type<span class="token punctuation">,</span>interestRate</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token operator">=</span>number<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_type<span class="token operator">=</span>type<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">interestRate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type<span class="token punctuation">.</span>interestRate<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">AccountType</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">nameString<span class="token punctuation">,</span>interestRate</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token operator">=</span>nameString<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_interestRate<span class="token operator">=</span>interestRate<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
   <span class="token keyword">get</span> <span class="token function">interestRate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_interestRate<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_213-搬移语句到函数-move-statements-into-function"><a href="#_213-搬移语句到函数-move-statements-into-function" aria-hidden="true" class="header-anchor">#</a> <span id="s213">(213)搬移语句到函数 / Move Statements into Function</span></h2> <p>反向重构：<a href="#s217">搬移语句到调用者(217))</a></p> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code>
result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;p&gt;title:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>person<span class="token punctuation">.</span>photo<span class="token punctuation">.</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
result<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">photoData</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>photo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">photoData</span><span class="token punctuation">(</span><span class="token parameter">aPhoto</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token template-string"><span class="token string">`&lt;p&gt;location:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>aPhoto<span class="token punctuation">.</span>location<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;`</span></span><span class="token punctuation">,</span>
    <span class="token template-string"><span class="token string">`&lt;p&gt;date:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>aPhoto<span class="token punctuation">.</span>date<span class="token punctuation">.</span><span class="token function">toDateString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;`</span></span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code>result<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">photoData</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>photo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">photoData</span><span class="token punctuation">(</span><span class="token parameter">aPhoto</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token template-string"><span class="token string">`&lt;p&gt;title:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>aPhoto<span class="token punctuation">.</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;`</span></span><span class="token punctuation">,</span>
    <span class="token template-string"><span class="token string">`&lt;p&gt;location:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>aPhoto<span class="token punctuation">.</span>location<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;`</span></span><span class="token punctuation">,</span>
    <span class="token template-string"><span class="token string">`&lt;p&gt;date:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>aPhoto<span class="token punctuation">.</span>date<span class="token punctuation">.</span><span class="token function">toDateString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;`</span></span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>要维护代码库的健康发展，最重要的是<code>消除重复</code>。</li> <li>如果某些语句与一个函数放在一起更像是一整体，并有助于理解，那就应该毫不犹豫的将语句搬移到函数里去。</li></ol></div> <h2 id="_217-搬移语句到调用者-move-statements-to-callers"><a href="#_217-搬移语句到调用者-move-statements-to-callers" aria-hidden="true" class="header-anchor">#</a> <span id="s217">(217)搬移语句到调用者 / Move Statements to Callers</span></h2> <p>反向重构：<a href="#s213">搬移语句到函数(213))</a></p> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">emitPhotoData</span><span class="token punctuation">(</span>outStream<span class="token punctuation">,</span>person<span class="token punctuation">.</span>photo<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">emitPhotoData</span><span class="token punctuation">(</span><span class="token parameter">outStream<span class="token punctuation">,</span>photo</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  outStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;p&gt;title:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>photo<span class="token punctuation">.</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;\n`</span></span><span class="token punctuation">)</span>
  outStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;p&gt;location:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>photo<span class="token punctuation">.</span>location<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;\n`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">emitPhotoData</span><span class="token punctuation">(</span>outStream<span class="token punctuation">,</span>person<span class="token punctuation">.</span>photo<span class="token punctuation">)</span><span class="token punctuation">;</span>
outStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;p&gt;location:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>person<span class="token punctuation">.</span>photo<span class="token punctuation">.</span>location<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;\n`</span></span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">emitPhotoData</span><span class="token punctuation">(</span><span class="token parameter">outStream<span class="token punctuation">,</span>photo</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  outStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;p&gt;title:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>photo<span class="token punctuation">.</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;\n`</span></span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>函数边界发生偏移的一个徵兆是，以往在许多地方共用的行为，如今需要在某些调用点面前表现出不同的行为。需将表现不同的行为从函数里挪出，并搬移到其他调用处。</li></ol></div> <h3 id="完整范例-2"><a href="#完整范例-2" aria-hidden="true" class="header-anchor">#</a> 完整范例</h3> <p>需求：支持 listRecentPhotos 函数以不同方式渲染相片的 location 信息，而 renderPerson 的行为则保持不变。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">renderPerson</span><span class="token punctuation">(</span><span class="token parameter">outStream<span class="token punctuation">,</span>person</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  outStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;p&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>person<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">renderPhoto</span><span class="token punctuation">(</span>outStream<span class="token punctuation">,</span>person<span class="token punctuation">.</span>photo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">emitPhotoData</span><span class="token punctuation">(</span>outStream<span class="token punctuation">,</span>person<span class="token punctuation">.</span>photo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">listRecentPhotos</span><span class="token punctuation">(</span><span class="token parameter">outStream<span class="token punctuation">,</span>photos</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  photos
    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token operator">=&gt;</span>p<span class="token punctuation">.</span>date <span class="token operator">&gt;</span> <span class="token function">recentDateCutoff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      outStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;div&gt;\n`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">emitPhotoData</span><span class="token punctuation">(</span>outStream<span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
      outStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;/div&gt;\n`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">emitPhotoData</span><span class="token punctuation">(</span><span class="token parameter">outStream<span class="token punctuation">,</span>photo</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  outStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;p&gt;title:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>photo<span class="token punctuation">.</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;\n`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  outStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;p&gt;date:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>photo<span class="token punctuation">.</span>date<span class="token punctuation">.</span><span class="token function">toDateString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;\n`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  outStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;p&gt;location:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>photo<span class="token punctuation">.</span>location<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;\n`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">function</span> <span class="token function">renderPerson</span><span class="token punctuation">(</span><span class="token parameter">outStream<span class="token punctuation">,</span>person</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  outStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;p&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>person<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">renderPhoto</span><span class="token punctuation">(</span>outStream<span class="token punctuation">,</span>person<span class="token punctuation">.</span>photo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">emitPhotoData</span><span class="token punctuation">(</span>outStream<span class="token punctuation">,</span>person<span class="token punctuation">.</span>photo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  outStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;p&gt;location:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>person<span class="token punctuation">.</span>photo<span class="token punctuation">.</span>location<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;\n`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">listRecentPhotos</span><span class="token punctuation">(</span><span class="token parameter">outStream<span class="token punctuation">,</span>photos</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  photos
    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token operator">=&gt;</span>p<span class="token punctuation">.</span>date <span class="token operator">&gt;</span> <span class="token function">recentDateCutoff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      outStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;div&gt;\n`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">emitPhotoData</span><span class="token punctuation">(</span>outStream<span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
      outStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;p&gt;location: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>p<span class="token punctuation">.</span>location<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;\n`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      outStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;/div&gt;\n`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">emitPhotoData</span><span class="token punctuation">(</span><span class="token parameter">outStream<span class="token punctuation">,</span>photo</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  outStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;p&gt;title:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>photo<span class="token punctuation">.</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;\n`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  outStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;p&gt;date:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>photo<span class="token punctuation">.</span>date<span class="token punctuation">.</span><span class="token function">toDateString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;\n`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="_222-以函数调用取代内联代码-replace-inline-code-with-function-call"><a href="#_222-以函数调用取代内联代码-replace-inline-code-with-function-call" aria-hidden="true" class="header-anchor">#</a> <span id="s222">(222)以函数调用取代内联代码 / Replace Inline Code with Function Call</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> appliesToMass<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> s <span class="token keyword">of</span> states<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>s<span class="token operator">===</span><span class="token string">&quot;MA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    appliesToMass<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code>appliesToMass<span class="token operator">=</span>states<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;MA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>一些内联代码，它门做的事情已经有函数可替代，通常会以函数调用取代内联代码。</li></ol></div> <blockquote><p>for-of 几个特征</p> <ul><li>这是最简洁、最直接的遍历数组元素的语法。</li> <li>这个方法避开了 for-in 循环的所有缺陷。</li> <li>与 forEach 不同的是，它可以正确响应 break、continue 和 return 语句。</li> <li>其不仅可以遍历数组，还可以遍历类数组对象和其他可迭代对象。</li></ul> <p>for-of 循环不支持普通对象，但如果你想迭代一个对象的属性，你可以用 for-in 循环（这也是它的本职工作）。</p></blockquote> <h2 id="_223-移动语句-slide-statements"><a href="#_223-移动语句-slide-statements" aria-hidden="true" class="header-anchor">#</a> <span id="s223">(223)移动语句 / Slide Statements</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> pricingPlan<span class="token operator">=</span><span class="token function">retrievePricingPlan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> order<span class="token operator">=</span><span class="token function">retreiveOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> charge<span class="token punctuation">;</span>
<span class="token keyword">const</span> chargePerUnit<span class="token operator">=</span>pricingPlan<span class="token punctuation">.</span>unit<span class="token punctuation">;</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> pricingPlan<span class="token operator">=</span><span class="token function">retrievePricingPlan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> chargePerUnit<span class="token operator">=</span>pricingPlan<span class="token punctuation">.</span>unit<span class="token punctuation">;</span>
<span class="token keyword">const</span> order<span class="token operator">=</span><span class="token function">retreiveOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> charge<span class="token punctuation">;</span>

</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>有几行代码取用一个数据结构，那么最好是让它们一起出现，雸不是夹杂在取用其他数据结构的代码中间。</li> <li>要判断依次语句移动是否安全，就得真正的理解代码的工作原理，以及运算符之间的组合方式等。</li> <li>如果待移动的代码本身有副作用，或者需要跨越的代码存在副作用，移动代码时就需要加倍小心。</li></ol></div> <h3 id="完整范例-3"><a href="#完整范例-3" aria-hidden="true" class="header-anchor">#</a> 完整范例</h3> <p>调整代码顺序，将类似的代码放一起</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> pricingPlan<span class="token operator">=</span><span class="token function">retrievePricingPlan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> order<span class="token operator">=</span><span class="token function">retreiveOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> baseCharge<span class="token operator">=</span>pricingPlan<span class="token punctuation">.</span>base<span class="token punctuation">;</span>
<span class="token keyword">let</span> charge<span class="token punctuation">;</span>
<span class="token keyword">const</span> chargePerUnit<span class="token operator">=</span>pricingPlan<span class="token punctuation">.</span>unit<span class="token punctuation">;</span>
<span class="token keyword">const</span> units<span class="token operator">=</span>order<span class="token punctuation">.</span>units<span class="token punctuation">;</span>
<span class="token keyword">let</span> discount<span class="token punctuation">;</span>
charge<span class="token operator">=</span>baseCharge <span class="token operator">+</span> units <span class="token operator">*</span> chargePerUnit<span class="token punctuation">;</span>
<span class="token keyword">let</span> discountableUnits<span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>units<span class="token operator">-</span>pricingPlan<span class="token punctuation">.</span>discountThreshold<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
discount <span class="token operator">=</span> discountableUnits <span class="token operator">*</span> pricingPlan<span class="token punctuation">.</span>discountFactor<span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span>isRepeat<span class="token punctuation">)</span> discount <span class="token operator">+=</span><span class="token number">20</span><span class="token punctuation">;</span>
charge <span class="token operator">=</span> charge<span class="token operator">-</span>discount<span class="token punctuation">;</span>
<span class="token function">chargeOrder</span><span class="token punctuation">(</span>charge<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> pricingPlan<span class="token operator">=</span><span class="token function">retrievePricingPlan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> baseCharge<span class="token operator">=</span>pricingPlan<span class="token punctuation">.</span>base<span class="token punctuation">;</span>
<span class="token keyword">let</span> charge<span class="token punctuation">;</span>
<span class="token keyword">const</span> chargePerUnit<span class="token operator">=</span>pricingPlan<span class="token punctuation">.</span>unit<span class="token punctuation">;</span>
<span class="token keyword">const</span> order<span class="token operator">=</span><span class="token function">retreiveOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> units<span class="token operator">=</span>order<span class="token punctuation">.</span>units<span class="token punctuation">;</span>
charge<span class="token operator">=</span>baseCharge <span class="token operator">+</span> units <span class="token operator">*</span> chargePerUnit<span class="token punctuation">;</span>
<span class="token keyword">let</span> discountableUnits<span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>units<span class="token operator">-</span>pricingPlan<span class="token punctuation">.</span>discountThreshold<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> discount<span class="token punctuation">;</span>
discount <span class="token operator">=</span> discountableUnits <span class="token operator">*</span> pricingPlan<span class="token punctuation">.</span>discountFactor<span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span>isRepeat<span class="token punctuation">)</span> discount <span class="token operator">+=</span><span class="token number">20</span><span class="token punctuation">;</span>
charge <span class="token operator">=</span> charge<span class="token operator">-</span>discount<span class="token punctuation">;</span>
<span class="token function">chargeOrder</span><span class="token punctuation">(</span>charge<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="_227-拆分循环-split-loop"><a href="#_227-拆分循环-split-loop" aria-hidden="true" class="header-anchor">#</a> <span id="s227">(227)拆分循环 / Split Loop</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> averageAge<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> totalSalary<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> p <span class="token keyword">of</span> people<span class="token punctuation">)</span><span class="token punctuation">{</span>
  averageAge <span class="token operator">+=</span>p<span class="token punctuation">.</span>age<span class="token punctuation">;</span>
  totalSalary <span class="token operator">+=</span>p<span class="token punctuation">.</span>salary<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
averageAge<span class="token operator">=</span>averageAge <span class="token operator">/</span> people<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> totalSalary<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> p <span class="token keyword">of</span> people<span class="token punctuation">)</span><span class="token punctuation">{</span>
  totalSalary <span class="token operator">+=</span>p<span class="token punctuation">.</span>salary<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> averageAge<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> p <span class="token keyword">of</span> people<span class="token punctuation">)</span><span class="token punctuation">{</span>
  averageAge <span class="token operator">+=</span>p<span class="token punctuation">.</span>age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
averageAge<span class="token operator">=</span>averageAge <span class="token operator">/</span> people<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>将循环拆分，让一个循环只做一件事，就能确保每次修改时只需要理解要修改那块代码行为即可。</li> <li>多个循环一开始或许会让人不安，但要知道，必须先进行重构，才能再进行优化。</li></ol></div> <h2 id="_231-以管道取代循环-replace-loop-with-pipeline"><a href="#_231-以管道取代循环-replace-loop-with-pipeline" aria-hidden="true" class="header-anchor">#</a> <span id="s231">(231)以管道取代循环 / Replace Loop with Pipeline</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> name<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> i <span class="token keyword">of</span> input<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>job <span class="token operator">===</span> <span class="token string">&quot;programmer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    names<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> name<span class="token operator">=</span>input<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token operator">=&gt;</span>i<span class="token punctuation">.</span>job<span class="token operator">===</span><span class="token string">&quot;programmer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token operator">=&gt;</span>i<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>越来越多的编成语言提供更好的语言结构来处理迭代过程，這种结构称为<code>集合管道 (collection pipeline)</code></li></ol></div> <h3 id="完整范例-4"><a href="#完整范例-4" aria-hidden="true" class="header-anchor">#</a> 完整范例</h3> <p>筛选出印度办公室</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> a<span class="token operator">=</span><span class="token template-string"><span class="token string">`office, country, telephone
Chicago,USA,+1 312 373 1000
Beijing,China,+86 4008 900 505
Bangalore,India,+91 80 4064 9570
Porto Alegre,Brazil,+55 51 3079 3550
Chennai,India,+91 44 660 44766`</span></span><span class="token punctuation">;</span>

</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">acquireData</span><span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> lines<span class="token operator">=</span>input<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> firstLine<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> result<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> line <span class="token keyword">of</span> lines<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>firstLine<span class="token punctuation">)</span><span class="token punctuation">{</span>
      firstLine<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token keyword">continue</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> record<span class="token operator">=</span>line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>record<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token string">&quot;India&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>city<span class="token punctuation">:</span>record<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>phone<span class="token punctuation">:</span>record<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">acquireData</span><span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> lines<span class="token operator">=</span>input<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> lines
        <span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  
        <span class="token comment">/*
        [&quot;Chicago,USA,+1 312 373 1000&quot;, 
         &quot;Beijing,China,+86 4008 900 505&quot;, 
         &quot;Bangalore,India,+91 80 4064 9570&quot;, 
         &quot;Porto Alegre,Brazil,+55 51 3079 3550&quot;, 
         &quot;Chennai,India,+91 44 660 44766&quot;, 
         &quot;&quot;]
        */</span>
        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">line</span><span class="token operator">=&gt;</span>line<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> 
        <span class="token comment">/* 
        [&quot;Chicago,USA,+1 312 373 1000&quot;, 
         &quot;Beijing,China,+86 4008 900 505&quot;, 
         &quot;Bangalore,India,+91 80 4064 9570&quot;, 
         &quot;Porto Alegre,Brazil,+55 51 3079 3550&quot;, 
         &quot;Chennai,India,+91 44 660 44766&quot;]
        */</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">line</span><span class="token operator">=&gt;</span>line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
        <span class="token comment">/* 
        [
          [&quot;Chicago&quot;, &quot;USA&quot;, &quot;+1 312 373 1000&quot;], 
          [&quot;Beijing&quot;, &quot;China&quot;, &quot;+86 4008 900 505&quot;], 
          [&quot;Bangalore&quot;, &quot;India&quot;, &quot;+91 80 4064 9570&quot;], 
          [&quot;Porto Alegre&quot;, &quot;Brazil&quot;, &quot;+55 51 3079 3550&quot;], 
          [&quot;Chennai&quot;, &quot;India&quot;, &quot;+91 44 660 44766&quot;]
        ]
        */</span>
        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">fields</span><span class="token operator">=&gt;</span>fields<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token string">&quot;India&quot;</span><span class="token punctuation">)</span>
        <span class="token comment">/*
        [
          [&quot;Bangalore&quot;, &quot;India&quot;, &quot;+91 80 4064 9570&quot;], 
          [&quot;Chennai&quot;, &quot;India&quot;, &quot;+91 44 660 44766&quot;]
        ]
        */</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fields</span><span class="token operator">=&gt;</span><span class="token punctuation">(</span><span class="token punctuation">{</span>city<span class="token punctuation">:</span>fields<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>phone<span class="token punctuation">:</span>fields<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">;</span>
<span class="token punctuation">}</span>


</code></pre></div><h2 id="_237-移除死代码-remove-dead-code"><a href="#_237-移除死代码-remove-dead-code" aria-hidden="true" class="header-anchor">#</a> <span id="s237">(237)移除死代码 / Remove Dead Code</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">doSomethingThatUsedToMatter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>无用代码周围没有任何警示或标记告诉程序员，让他们可以放心忽略段代码，因为已经没有任何地方使用它。</li> <li>当程序员花许多时间，尝试理解无用代码的工作原理时，却发现怎么修改这段代码都无法得到预期的输出，导致成本上升。</li> <li>无用得代码请立刻删除，且用版控来处理未来需要找回时的可能情况。</li></ol></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/workflow/refactor/encapsulate.html" class="prev">
          封装
        </a></span> <span class="next"><a href="/workflow/refactor/anew.html">
          重新组织数据
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/workflow/assets/js/app.21f02376.js" defer></script><script src="/workflow/assets/js/34.3796137b.js" defer></script>
  </body>
</html>
