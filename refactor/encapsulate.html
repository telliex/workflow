<!DOCTYPE html>
<html lang="zh-Hans">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>封装 | 前端学习</title>
    <meta name="description" content="工作流">
    <link rel="manifest" href="/workflow/manifest.json">
  <link rel="apple-touch-icon" href="/workflow/img/logo.png">
    
    <link rel="preload" href="/workflow/assets/css/0.styles.89c56574.css" as="style"><link rel="preload" href="/workflow/assets/js/app.21f02376.js" as="script"><link rel="preload" href="/workflow/assets/js/32.a705fe0e.js" as="script"><link rel="prefetch" href="/workflow/assets/js/10.21852b11.js"><link rel="prefetch" href="/workflow/assets/js/11.f64d45b2.js"><link rel="prefetch" href="/workflow/assets/js/12.9586b2eb.js"><link rel="prefetch" href="/workflow/assets/js/13.362695f8.js"><link rel="prefetch" href="/workflow/assets/js/14.5011e510.js"><link rel="prefetch" href="/workflow/assets/js/15.602ee5a0.js"><link rel="prefetch" href="/workflow/assets/js/16.f76b32cd.js"><link rel="prefetch" href="/workflow/assets/js/17.12a6afbb.js"><link rel="prefetch" href="/workflow/assets/js/18.eab1da27.js"><link rel="prefetch" href="/workflow/assets/js/19.2b640b10.js"><link rel="prefetch" href="/workflow/assets/js/2.d5709b3c.js"><link rel="prefetch" href="/workflow/assets/js/20.3398b7c2.js"><link rel="prefetch" href="/workflow/assets/js/21.c325b732.js"><link rel="prefetch" href="/workflow/assets/js/22.c3df5e1b.js"><link rel="prefetch" href="/workflow/assets/js/23.898e6112.js"><link rel="prefetch" href="/workflow/assets/js/24.051a0bbc.js"><link rel="prefetch" href="/workflow/assets/js/25.554600d3.js"><link rel="prefetch" href="/workflow/assets/js/26.16320fe2.js"><link rel="prefetch" href="/workflow/assets/js/27.512eede4.js"><link rel="prefetch" href="/workflow/assets/js/28.3e0725db.js"><link rel="prefetch" href="/workflow/assets/js/29.5466dfa8.js"><link rel="prefetch" href="/workflow/assets/js/3.0689ac69.js"><link rel="prefetch" href="/workflow/assets/js/30.cd41e5b5.js"><link rel="prefetch" href="/workflow/assets/js/31.002ecbd9.js"><link rel="prefetch" href="/workflow/assets/js/33.97b79008.js"><link rel="prefetch" href="/workflow/assets/js/34.3796137b.js"><link rel="prefetch" href="/workflow/assets/js/35.0b4e016b.js"><link rel="prefetch" href="/workflow/assets/js/36.dd2588d5.js"><link rel="prefetch" href="/workflow/assets/js/37.b7cf03a2.js"><link rel="prefetch" href="/workflow/assets/js/38.8e43f6aa.js"><link rel="prefetch" href="/workflow/assets/js/39.2fd073aa.js"><link rel="prefetch" href="/workflow/assets/js/4.1d131f68.js"><link rel="prefetch" href="/workflow/assets/js/40.739236ee.js"><link rel="prefetch" href="/workflow/assets/js/41.77a6a6db.js"><link rel="prefetch" href="/workflow/assets/js/42.147c2537.js"><link rel="prefetch" href="/workflow/assets/js/43.98113f75.js"><link rel="prefetch" href="/workflow/assets/js/44.7e138f8f.js"><link rel="prefetch" href="/workflow/assets/js/45.18960dae.js"><link rel="prefetch" href="/workflow/assets/js/46.5facf218.js"><link rel="prefetch" href="/workflow/assets/js/47.80ebf3e6.js"><link rel="prefetch" href="/workflow/assets/js/5.cb412c95.js"><link rel="prefetch" href="/workflow/assets/js/6.59392cf1.js"><link rel="prefetch" href="/workflow/assets/js/7.62b86de1.js"><link rel="prefetch" href="/workflow/assets/js/8.455db33c.js"><link rel="prefetch" href="/workflow/assets/js/9.eab8be47.js">
    <link rel="stylesheet" href="/workflow/assets/css/0.styles.89c56574.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/workflow/" class="home-link router-link-active"><!----> <span class="site-name">前端学习</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/workflow/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://confluence.shinho.net.cn/pages/viewpage.action?pageId=17127648" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Activo
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/telliex/telliex.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/workflow/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://confluence.shinho.net.cn/pages/viewpage.action?pageId=17127648" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Activo
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/telliex/telliex.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/workflow/work/" class="sidebar-link">工作流</a></li><li><a href="/workflow/demand/" class="sidebar-link">需求分析</a></li><li><a href="/workflow/task/" class="sidebar-link">任务拆解</a></li><li><a href="/workflow/user-story/" class="sidebar-link">使用者故事</a></li><li><a href="/workflow/test-strategy/" class="sidebar-link">测试策略</a></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>TDD</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/tdd/" class="sidebar-link">认识 TDD</a></li><li><a href="/workflow/tdd/TDD-touch.html" class="sidebar-link">TDD 轻体验</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>单元测试</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/ut/" class="sidebar-link">单元测试</a></li><li><a href="/workflow/ut/ut-vue.html" class="sidebar-link">Vue 单元测试</a></li><li><a href="/workflow/ut/jest.html" class="sidebar-link">Jest</a></li><li><a href="/workflow/ut/vue-jest-callback-functions.html" class="sidebar-link">异步调用</a></li><li><a href="/workflow/ut/vue-jest-mock.html" class="sidebar-link">Mock</a></li><li><a href="/workflow/ut/vue-jest-template1.html" class="sidebar-link">Jest 实战范例 1</a></li><li><a href="/workflow/ut/vue-jest-template2.html" class="sidebar-link">Jest 实战范例 2</a></li><li><a href="/workflow/ut/vue-jest-template3.html" class="sidebar-link">Jest 实战范例 3</a></li><li><a href="/workflow/ut/vue-jest-template4.html" class="sidebar-link">Jest 实战范例 4</a></li><li><a href="/workflow/ut/vue-jest-tools.html" class="sidebar-link">工具</a></li><li><a href="/workflow/ut/ut-doit.html" class="sidebar-link">实作</a></li><li><a href="/workflow/ut/ut-question.html" class="sidebar-link">问题</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>BDD 测试</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/vue-bdd-test/" class="sidebar-link">Vue BDD 测试</a></li><li><a href="/workflow/vue-bdd-test/bdd-cucumber.html" class="sidebar-link">Cucumber</a></li><li><a href="/workflow/vue-bdd-test/bdd-nightwatch.html" class="sidebar-link">Nightwatch</a></li><li><a href="/workflow/vue-bdd-test/bdd-cuketest.html" class="sidebar-link">Cuketest</a></li><li><a href="/workflow/vue-bdd-test/bdd-report.html" class="sidebar-link">bdd report</a></li><li><a href="/workflow/vue-bdd-test/bdd-doit.html" class="sidebar-link">实作 1</a></li><li><a href="/workflow/vue-bdd-test/bdd-doit-2.html" class="sidebar-link">实作 2</a></li></ul></div></li><li><a href="/workflow/performance/" class="sidebar-link">性能测试</a></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>重构</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/refactor/" class="sidebar-link">代码坏味道</a></li><li><a href="/workflow/refactor/refactor.html" class="sidebar-link">重構</a></li><li><a href="/workflow/refactor/encapsulate.html" class="active sidebar-link">封装</a></li><li><a href="/workflow/refactor/move.html" class="sidebar-link">搬移</a></li><li><a href="/workflow/refactor/anew.html" class="sidebar-link">重新组织数据</a></li><li><a href="/workflow/refactor/simplify.html" class="sidebar-link">简化条件逻辑</a></li><li><a href="/workflow/refactor/api.html" class="sidebar-link">重构API</a></li><li><a href="/workflow/refactor/inherit.html" class="sidebar-link">处理继承关系</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>设计模式</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/designpattern/" class="sidebar-link">设计模式</a></li></ul></div></li><li><a href="/workflow/function/" class="sidebar-link">函数式编程</a></li><li><a href="/workflow/explanation/" class="sidebar-link">名词解释</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="封装"><a href="#封装" aria-hidden="true" class="header-anchor">#</a> 封装</h1> <ul><li><a href="#s162">(162)封装记录 / Encapsulate Record</a></li> <li><a href="#s170">(170)封装集合 / Encapsulate Collection</a></li> <li><a href="#s174">(174)以对象取代基本类型 / Replace Primitive with Object</a></li> <li><a href="#s178">(178)以查询取代临时变量 / Replace Temp with Query</a></li> <li><a href="#s182">(182)提炼类 / Extract Class</a></li> <li><a href="#s186">(186)内联类 / Inline Class</a></li> <li><a href="#s189">(189)隐藏委托关系 / Hide Delegate</a></li> <li><a href="#s192">(192)移除中间人 / Remove Middle Man</a></li> <li><a href="#s195">(195)替换算法 / Substitute Algorithm</a></li></ul> <h2 id="_162-封装记录-encapsulate-record"><a href="#_162-封装记录-encapsulate-record" aria-hidden="true" class="header-anchor">#</a> <span id="s162">(162)封装记录 / Encapsulate Record</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code>organization<span class="token operator">=</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&quot;Acme Gooseherries&quot;</span><span class="token punctuation">,</span> country<span class="token punctuation">:</span><span class="token string">&quot;GB&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Organization</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token operator">=</span>data<span class="token punctuation">.</span>neme<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_country<span class="token operator">=</span>data<span class="token punctuation">.</span>country<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">set</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token parameter">sString</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token operator">=</span>sString<span class="token punctuation">;</span><span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">country</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_country<span class="token punctuation">;</span><span class="token punctuation">}</span>
  <span class="token keyword">set</span> <span class="token function">country</span><span class="token punctuation">(</span><span class="token parameter">aCountryCode</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_country<span class="token operator">=</span>aCountryCode<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ul><li>对于<code>可变数据</code>，通常偏好使用类对象而非记录。对象可以隐藏结构的细节。</li> <li>若数据不可变，大可直接将数据保存在记录里。</li> <li>封装记录意味著，仅仅替换变量还不够，还要设想控制的使用方法。而使用类替代记录，</li></ul></div> <h3 id="完整范例-将记录的浅复制展开到对象"><a href="#完整范例-将记录的浅复制展开到对象" aria-hidden="true" class="header-anchor">#</a> 完整范例 - 将记录的<code>浅复制</code>展开到对象</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Organization</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token operator">=</span>data<span class="token punctuation">.</span>neme<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_country<span class="token operator">=</span>data<span class="token punctuation">.</span>country<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">set</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token parameter">sString</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_data<span class="token punctuation">.</span>name<span class="token operator">=</span>sString<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_data<span class="token punctuation">.</span>name<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">country</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_country<span class="token punctuation">;</span><span class="token punctuation">}</span>
  <span class="token keyword">set</span> <span class="token function">country</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_country<span class="token operator">=</span>arg<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 先进进行封装变量(132)</span>
<span class="token keyword">const</span> orgnization<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Organization</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&quot;Acme Gooseherries&quot;</span><span class="token punctuation">,</span> country<span class="token punctuation">:</span><span class="token string">&quot;GB&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">getOrganization</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> organization<span class="token punctuation">;</span> <span class="token punctuation">}</span>

</code></pre></div><h3 id="完整范例-来自-json-的深层嵌套数据"><a href="#完整范例-来自-json-的深层嵌套数据" aria-hidden="true" class="header-anchor">#</a> 完整范例 - 来自 JSON 的<code>深层嵌套</code>数据</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> customData<span class="token operator">=</span><span class="token punctuation">{</span>
  <span class="token string">&quot;1920&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span><span class="token string">&quot;martin&quot;</span><span class="token punctuation">,</span>
    id<span class="token punctuation">:</span><span class="token string">&quot;1920&quot;</span><span class="token punctuation">,</span>
    usages<span class="token punctuation">:</span><span class="token punctuation">{</span>
      <span class="token string">&quot;2016&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span>
        <span class="token string">&quot;1&quot;</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">,</span>
        <span class="token string">&quot;2&quot;</span><span class="token punctuation">:</span><span class="token number">55</span><span class="token punctuation">,</span>
        <span class="token comment">// remaining months of the year</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">&quot;2015&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span>
        <span class="token string">&quot;1&quot;</span><span class="token punctuation">:</span><span class="token number">70</span><span class="token punctuation">,</span>
        <span class="token string">&quot;2&quot;</span><span class="token punctuation">:</span><span class="token number">63</span><span class="token punctuation">,</span>
        <span class="token comment">// remaining months of the year</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;38637&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span><span class="token string">&quot;neal&quot;</span><span class="token punctuation">,</span>
    id<span class="token punctuation">:</span><span class="token string">&quot;38637&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// more customers in a similar form</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 先进进行封装变量(132)</span>
<span class="token keyword">function</span> <span class="token function">getRawDataOfCustomers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> customerData<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">setRawDataOfCustomers</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span>customerData<span class="token operator">=</span>arg<span class="token punctuation">;</span><span class="token punctuation">}</span>

<span class="token comment">// 更新的例子</span>
<span class="token function">getRawDataOfCustomers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>customerID<span class="token punctuation">]</span><span class="token punctuation">.</span>usage<span class="token punctuation">[</span>year<span class="token punctuation">]</span><span class="token punctuation">[</span>month<span class="token punctuation">]</span><span class="token operator">=</span>amount<span class="token punctuation">;</span>

<span class="token comment">// 读取的例子</span>
<span class="token keyword">function</span> <span class="token function">compareUsage</span><span class="token punctuation">(</span><span class="token parameter">customerID<span class="token punctuation">,</span>laterYear<span class="token punctuation">,</span>month</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> later <span class="token operator">=</span> <span class="token function">getRawDataOfCustomer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>cusromerID<span class="token punctuation">]</span><span class="token punctuation">.</span>usages<span class="token punctuation">[</span>laterYear<span class="token punctuation">]</span><span class="token punctuation">[</span>month<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> earlier<span class="token operator">=</span> <span class="token function">getRawDataOfCustomer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>cusromerID<span class="token punctuation">]</span><span class="token punctuation">.</span>usages<span class="token punctuation">[</span>laterYear<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>month<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>lateAmount<span class="token punctuation">;</span>later<span class="token punctuation">,</span>chage<span class="token punctuation">:</span>later<span class="token operator">-</span>earlier<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">CustomerData</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_data<span class="token operator">=</span>data<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">setUsage</span><span class="token punctuation">(</span><span class="token parameter">customerID<span class="token punctuation">,</span>year<span class="token punctuation">,</span>month<span class="token punctuation">,</span>amount</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span>customerID<span class="token punctuation">]</span><span class="token punctuation">.</span>usages<span class="token punctuation">[</span>year<span class="token punctuation">]</span><span class="token punctuation">[</span>mount<span class="token punctuation">]</span><span class="token operator">=</span>amount<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">rawData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    _<span class="token punctuation">.</span><span class="token function">cloneDeep</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">usage</span><span class="token punctuation">(</span><span class="token parameter">customerID<span class="token punctuation">,</span>year<span class="token punctuation">,</span>month</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_data<span class="token punctuation">[</span>customerID<span class="token punctuation">]</span><span class="token punctuation">.</span>usages<span class="token punctuation">[</span>year<span class="token punctuation">]</span><span class="token punctuation">[</span>mount<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getCustomerData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> customerData<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">getRawDataOfCustomers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> customerData<span class="token punctuation">.</span>rawData<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">setRawDataOfCustomers</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span>customerData<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">CustomerData</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>

<span class="token comment">// 读取的例子 - 以副本方式</span>
<span class="token keyword">function</span> <span class="token function">compareUsage</span><span class="token punctuation">(</span><span class="token parameter">customerID<span class="token punctuation">,</span>laterYear<span class="token punctuation">,</span>month</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> later <span class="token operator">=</span> <span class="token function">getRawDataOfCustomer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">usages</span><span class="token punctuation">(</span>customerID<span class="token punctuation">,</span>laterYear<span class="token punctuation">,</span>month<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> earlier<span class="token operator">=</span> <span class="token function">getRawDataOfCustomer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">usages</span><span class="token punctuation">(</span>customerID<span class="token punctuation">,</span>laterYear<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>month<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>lateAmount<span class="token punctuation">;</span>later<span class="token punctuation">,</span>chage<span class="token punctuation">:</span>later<span class="token operator">-</span>earlier<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_170-封装集合-encapsulate-collection"><a href="#_170-封装集合-encapsulate-collection" aria-hidden="true" class="header-anchor">#</a> <span id="s170">(170)封装集合 / Encapsulate Collection</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">courses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_courses<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">set</span> <span class="token function">courses</span><span class="token punctuation">(</span><span class="token parameter">aList</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_courses<span class="token operator">=</span>aList<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">courses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_courses<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token function">addCourse</span><span class="token punctuation">(</span><span class="token parameter">aCourse</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
  <span class="token function">removeCourse</span><span class="token punctuation">(</span><span class="token parameter">aCourse</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ul><li>封装集合时常常会犯一个错误，只对集合变量的访问进行封装，但依然取值函数返回集合本身。这使得集合的成员变量可以直接被修改，而封装它的类全然不知，无法介入。</li> <li>不要让集合的取值函数返回原始集合，可避免客户端的意外修改。</li> <li>负责集合管理的类都应该总是返回数据副本。</li></ul></div> <h2 id="_174-以对象取代基本类型-replace-primitive-with-object"><a href="#_174-以对象取代基本类型-replace-primitive-with-object" aria-hidden="true" class="header-anchor">#</a> <span id="s174">(174)以对象取代基本类型 / Replace Primitive with Object</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code>orders<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span> <span class="token parameter">o</span><span class="token operator">=&gt;</span><span class="token string">&quot;high&quot;</span> <span class="token operator">===</span>o<span class="token punctuation">.</span>priority <span class="token operator">||</span> <span class="token string">&quot;rush&quot;</span> <span class="token operator">===</span>o<span class="token punctuation">.</span>priority <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code>orders<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span> <span class="token parameter">o</span><span class="token operator">=&gt;</span> o<span class="token punctuation">.</span>priority<span class="token punctuation">.</span><span class="token function">higherThan</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Priority</span><span class="token punctuation">(</span><span class="token string">&quot;normal&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ul><li>一旦发现某个数据的操作不再局限原来的用途，就可以为它创见一个新类。日后添加的业务逻辑就有地方可以放置。</li></ul></div> <h3 id="完整范例"><a href="#完整范例" aria-hidden="true" class="header-anchor">#</a> 完整范例</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Order</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>priority<span class="token operator">=</span>data<span class="token punctuation">.</span>priority<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_priority<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> 
  <span class="token keyword">get</span> <span class="token function">priority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_priority<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">priorityString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_priority<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> 
  <span class="token keyword">set</span> <span class="token function">priority</span><span class="token punctuation">(</span><span class="token parameter">aString</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_priority<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Priority</span><span class="token punctuation">(</span>aString<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Priority</span><span class="token punctuation">{</span>
  <span class="token function">condtructor</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Priority</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>Priority<span class="token punctuation">.</span><span class="token function">legalValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_value<span class="token operator">=</span>value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is invalid for Priority&gt;`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> 
  <span class="token punctuation">}</span>
  <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">_index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> Priority<span class="token punctuation">.</span><span class="token function">legalValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token operator">=&gt;</span>s<span class="token operator">===</span><span class="token keyword">this</span><span class="token punctuation">.</span>_value<span class="token punctuation">;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">static</span> <span class="token function">legalValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'low'</span><span class="token punctuation">,</span><span class="token string">'normal'</span><span class="token punctuation">,</span><span class="token string">'high'</span><span class="token punctuation">,</span><span class="token string">'rush'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

  <span class="token function">equals</span><span class="token punctuation">(</span><span class="token parameter">other</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_index<span class="token operator">===</span>other<span class="token punctuation">.</span>_index<span class="token punctuation">;</span><span class="token punctuation">}</span>
  <span class="token function">higherThan</span><span class="token punctuation">(</span><span class="token parameter">other</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_index<span class="token operator">&gt;</span>other<span class="token punctuation">.</span>_index<span class="token punctuation">;</span><span class="token punctuation">}</span>
  <span class="token function">lowerThan</span><span class="token punctuation">(</span><span class="token parameter">other</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_index<span class="token operator">&lt;</span>other<span class="token punctuation">.</span>_index<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 客户端呼叫</span>
hightPriorityCount<span class="token operator">=</span> orders<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token operator">=&gt;</span>o<span class="token punctuation">.</span>priority<span class="token punctuation">.</span><span class="token function">higherThan</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Priority</span><span class="token punctuation">(</span><span class="token string">&quot;normal&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>

</code></pre></div><h2 id="_178-以查询取代临时变量-replace-temp-with-query"><a href="#_178-以查询取代临时变量-replace-temp-with-query" aria-hidden="true" class="header-anchor">#</a> <span id="s178">(178)以查询取代临时变量 / Replace Temp with Query</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> basePrice <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_quantity <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_itemPrice<span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>basePrice <span class="token operator">&gt;</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> basePrice <span class="token operator">*</span> <span class="token number">0.95</span><span class="token punctuation">;</span>
<span class="token keyword">else</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> basePrice <span class="token operator">*</span> <span class="token number">0.98</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">get</span> <span class="token function">basePrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_quantity <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_itemPrice<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token operator">...</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>basePrice <span class="token operator">&gt;</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>basePrice <span class="token operator">*</span> <span class="token number">0.95</span><span class="token punctuation">;</span>
<span class="token keyword">else</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>basePrice <span class="token operator">*</span> <span class="token number">0.98</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ul><li>除去不必要的临时变量。</li> <li>如果正在分解一个冗长的函数，将变量抽取到函数里能使函数分解过程更简单，因为就不需要将变量作为参数传递给提炼出来的小函数。</li> <li><code>此重构手法只适用于某些类型的临时变量</code>(那些只被执行计算一次且以后不再被修改的变量)，对于快照用途的变量就不适用此重构法。</li></ul></div> <h3 id="完整范例-2"><a href="#完整范例-2" aria-hidden="true" class="header-anchor">#</a> 完整范例</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// class order</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">quantity<span class="token punctuation">,</span>item</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_quantity<span class="token operator">=</span>quantity<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_item<span class="token operator">=</span>item<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">get</span> <span class="token function">price</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

  <span class="token comment">// 将 basePrice ＆ discountFactor 两临时变量变成函数</span>
  <span class="token keyword">var</span> basePrice<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>_quantity<span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">.</span>_item<span class="token punctuation">.</span>price<span class="token punctuation">;</span>

  <span class="token keyword">var</span> discountFactor<span class="token operator">=</span><span class="token number">0.98</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>basePrice <span class="token operator">&gt;</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    discountFactor <span class="token operator">-=</span><span class="token number">0.03</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> basePrice<span class="token operator">*</span>discountFactor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">quantity<span class="token punctuation">,</span>item</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_quantity<span class="token operator">=</span>quantity<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_item<span class="token operator">=</span>item<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">get</span> <span class="token function">price</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>basePrice<span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">.</span>discountFactor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">get</span> <span class="token function">basePrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_quantity<span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">.</span>_item<span class="token punctuation">.</span>price
<span class="token punctuation">}</span>
<span class="token keyword">get</span> <span class="token function">discountFactor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> discountFactor<span class="token operator">=</span><span class="token number">0.98</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>basePrice <span class="token operator">&gt;</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    discountFactor <span class="token operator">-=</span><span class="token number">0.03</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> discountFactor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_182-提炼类-extract-class"><a href="#_182-提炼类-extract-class" aria-hidden="true" class="header-anchor">#</a> <span id="s182">(182)提炼类 / Extract Class</span></h2> <p>反向重构：<a href="#s186">(186)内联类 / Inline Class</a></p> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Persion</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">officeAreaCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_officeAreaCode<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">officeNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_officeNumber<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Persion</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">officeAreaCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_telephoneNumber<span class="token punctuation">.</span>areaCode<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">officeNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_telephoneNumber<span class="token punctuation">.</span>number<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">TelephoneNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">areaCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_areaCode<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_number<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ul><li>设想你有一个维护大量函数和数据的类。这样的类往往因为太大而不易了解。此时你需要考虑哪些类可以分离出去，并将他们分离到一个独立的类中。</li> <li>开发后期往往会出现类的某些功能特性需要以另一种方式来子类化，则需分解原来的类。</li></ul></div> <h3 id="完整范例-3"><a href="#完整范例-3" aria-hidden="true" class="header-anchor">#</a> 完整范例</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token operator">=</span>data<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_officeAreaCode<span class="token operator">=</span>data<span class="token punctuation">.</span>officeAreaCode<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_officeNumber<span class="token operator">=</span>data<span class="token punctuation">.</span>officeNumber<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token punctuation">;</span><span class="token punctuation">}</span>
  <span class="token keyword">set</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token operator">=</span>arg<span class="token punctuation">;</span><span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">telephoneNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>officeAreaCode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>officeNumber<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">officeAreaCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_officeAreaCode<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">set</span> <span class="token function">officeAreaCode</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_officeAreaCode<span class="token operator">=</span>arg<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">officeNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_officeNumber<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">set</span> <span class="token function">officeNumber</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_officeNumber<span class="token operator">=</span>arg<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token operator">=</span>data<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token comment">// (2) this._officeAreaCode=data.officeAreaCode;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_officeNumber<span class="token operator">=</span>data<span class="token punctuation">.</span>officeNumber<span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>_telephoneNumber<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">TelephoneNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (1)</span>

  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token punctuation">;</span><span class="token punctuation">}</span>
  <span class="token keyword">set</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token operator">=</span>arg<span class="token punctuation">;</span><span class="token punctuation">}</span>
  <span class="token comment">// (8) get telephoneNumber() { return `(${this.officeAreaCode}) ${this.officeNumber}`; }</span>
  <span class="token keyword">get</span> <span class="token function">telephoneNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_telephoneNumber<span class="token punctuation">.</span>telephoneNumber<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// (8)</span>
  <span class="token comment">// (4) get officeAreaCode(){ return this._officeAreaCode; } </span>
  <span class="token keyword">get</span> <span class="token function">officeAreaCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_telephoneNumber<span class="token punctuation">.</span>officeAreaCode<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// (4)</span>
  <span class="token comment">// (4) set officeAreaCode(arg){ this._officeAreaCode=arg; } </span>
  <span class="token keyword">set</span> <span class="token function">officeAreaCode</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_telephoneNumber<span class="token punctuation">.</span>officeAreaCode<span class="token operator">=</span>arg<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// (4)</span>
  <span class="token comment">// (6) get officeNumber(){ return this._officeNumber; }</span>
  <span class="token keyword">get</span> <span class="token function">officeNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_telephoneNumber<span class="token punctuation">.</span>officeNumber<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// (6)</span>
  <span class="token comment">// (6) set officeNumber(arg){ this._officeNumber=arg; }</span>
  <span class="token keyword">set</span> <span class="token function">officeNumber</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_telephoneNumber<span class="token punctuation">.</span>officeNumber<span class="token operator">=</span>arg<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// (6)</span>

<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">TelephoneNumber</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_officeAreaCode<span class="token punctuation">;</span> <span class="token comment">// (3)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_officeNumber<span class="token punctuation">;</span> <span class="token comment">// (5)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">officeAreaCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_officeAreaCode<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// (3)</span>
  <span class="token keyword">set</span> <span class="token function">officeAreaCode</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_officeAreaCode<span class="token operator">=</span>arg<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// (3)</span>

  <span class="token keyword">get</span> <span class="token function">officeNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_officeNumber<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// (5)</span>
  <span class="token keyword">set</span> <span class="token function">officeNumber</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_officeNumber<span class="token operator">=</span>arg<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// (5)</span>

  <span class="token keyword">get</span> <span class="token function">telephoneNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>officeAreaCode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>officeNumber<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// (7)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>改名</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token operator">=</span>data<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_officeNumber<span class="token operator">=</span>data<span class="token punctuation">.</span>officeNumber<span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>_telephoneNumber<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">TelephoneNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token punctuation">;</span><span class="token punctuation">}</span>
  <span class="token keyword">set</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token operator">=</span>arg<span class="token punctuation">;</span><span class="token punctuation">}</span>
 
  <span class="token keyword">get</span> <span class="token function">telephoneNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_telephoneNumber<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> 
  <span class="token keyword">get</span> <span class="token function">officeAreaCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_telephoneNumber<span class="token punctuation">.</span>areaCode<span class="token punctuation">;</span> <span class="token punctuation">}</span> 
  <span class="token keyword">set</span> <span class="token function">officeAreaCode</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_telephoneNumber<span class="token punctuation">.</span>areaCode<span class="token operator">=</span>arg<span class="token punctuation">;</span> <span class="token punctuation">}</span> 
  <span class="token keyword">get</span> <span class="token function">officeNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_telephoneNumber<span class="token punctuation">.</span>number<span class="token punctuation">;</span> <span class="token punctuation">}</span> 
  <span class="token keyword">set</span> <span class="token function">officeNumber</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_telephoneNumber<span class="token punctuation">.</span>number<span class="token operator">=</span>arg<span class="token punctuation">;</span> <span class="token punctuation">}</span> 

<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">TelephoneNumber</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_areaCode<span class="token punctuation">;</span> 
    <span class="token keyword">this</span><span class="token punctuation">.</span>_number<span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">areaCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_areaCode<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">set</span> <span class="token function">areaCode</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_areaCode<span class="token operator">=</span>arg<span class="token punctuation">;</span> <span class="token punctuation">}</span>

  <span class="token keyword">get</span> <span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_number<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">set</span> <span class="token function">number</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_number<span class="token operator">=</span>arg<span class="token punctuation">;</span> <span class="token punctuation">}</span>

  <span class="token keyword">get</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>areaCode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>number<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_186-内联类-inline-class"><a href="#_186-内联类-inline-class" aria-hidden="true" class="header-anchor">#</a> <span id="s186">(186)内联类 / Inline Class</span></h2> <p>反向重构：<a href="#s182">(182)提炼类 / Extract Class</a></p> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Persion</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">officeAreaCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_telephoneNumber<span class="token punctuation">.</span>areaCode<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">officeNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_telephoneNumber<span class="token punctuation">.</span>number<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">TelephoneNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">areaCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_areaCode<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_number<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Persion</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">officeAreaCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_officeAreaCode<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">officeNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_officeNumber<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ul><li>**<a href="#s186">内联类(186)</a><strong>正好与</strong><a href="#s182">提炼类(182)</a>**相反。如果一个类不再承担足够责任，不再有单独存在的理由，找出这一&quot;萎缩类&quot;最频繁的呼叫者，将这&quot;萎缩类&quot;塞进另一个类中。</li> <li>另一使用时机是，今有两个类，想重构内容，一般我们也会先使用<code>内联类</code>进行原始码重整，再使用<code>提炼类</code>。</li></ul></div> <h3 id="完整范例-4"><a href="#完整范例-4" aria-hidden="true" class="header-anchor">#</a> 完整范例</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">TrackingInformation</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_shippingCompany<span class="token operator">=</span>data<span class="token punctuation">.</span>shippingCompany<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_trackingNumber<span class="token operator">=</span>data<span class="token punctuation">.</span>trackingNumber<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">shippingCompany</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_shippingCompany<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">set</span> <span class="token function">shippingCompany</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_shippingCompany <span class="token operator">=</span> arg<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">trackingNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_trackingNumber<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">set</span> <span class="token function">trackingNumber</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_trackingNumber <span class="token operator">=</span> arg<span class="token punctuation">;</span><span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>shippingCompany<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>trackingNumber<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Shipment</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_trackingInformation<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">TrackingInformation</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">trackingInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_trackingInformation<span class="token punctuation">.</span>display<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">trackingInformation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_trackingInformation<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">set</span> <span class="token function">trackingInformation</span><span class="token punctuation">(</span><span class="token parameter">aTrackingInformation</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_trackInformation<span class="token operator">=</span>aTrackingInformation<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Shipment</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// (1) this._trackingInformation=new TrackingInformation(data);</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_shippingCompany<span class="token operator">=</span>data<span class="token punctuation">.</span>shippingCompany<span class="token punctuation">;</span> <span class="token comment">// (2)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_trackingNumber<span class="token operator">=</span>trackingNumber<span class="token punctuation">;</span> <span class="token comment">// (4)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">trackingInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// (5) return this._trackingInformation.display;</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>shippingCompany<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>trackingNumber<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span> <span class="token comment">// (5)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//  (6) get trackingInformation(){ return this._trackingInformation; } </span>
  <span class="token comment">//  (6) set trackingInformation(aTrackingInformation){this._trackInformation=aTrackingInformation;}</span>

  <span class="token comment">// modify</span>
  <span class="token keyword">get</span> <span class="token function">shippingCompany</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_shippingCompany<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// (1)</span>
  <span class="token keyword">set</span> <span class="token function">shippingCompany</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>_shippingCompany<span class="token operator">=</span>arg<span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token comment">// (1)</span>
  <span class="token keyword">get</span> <span class="token function">trackingNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_trackingNumber<span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">// (3)</span>
  <span class="token keyword">set</span> <span class="token function">trackingNumber</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_trackingNumber <span class="token operator">=</span> arg<span class="token punctuation">;</span><span class="token punctuation">}</span>  <span class="token comment">// (3)</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="_189-隐藏委托关系-hide-delegate"><a href="#_189-隐藏委托关系-hide-delegate" aria-hidden="true" class="header-anchor">#</a> <span id="s189">(189)隐藏委托关系 / Hide Delegate</span></h2> <p>反向重构：<a href="#s192">移除中间人(192)</a></p> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code>manager<span class="token operator">=</span> aPerson<span class="token punctuation">.</span>department<span class="token punctuation">.</span>manager<span class="token punctuation">;</span> <span class="token comment">// 透漏出 department 负责追踪 manager 信息</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code>manager<span class="token operator">=</span> aPerson<span class="token punctuation">.</span>manager<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token operator">=</span>name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_department<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Department</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 委托函数</span>
  <span class="token keyword">get</span> <span class="token function">manager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_department<span class="token punctuation">.</span>manager<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// get department(){</span>
  <span class="token comment">//   return this._department;</span>
  <span class="token comment">// }</span>
  <span class="token comment">// set department(arg){</span>
  <span class="token comment">//   this._department=arg;</span>
  <span class="token comment">// }</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Department</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_manager<span class="token operator">=</span><span class="token string">&quot;John&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">manager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_manager<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">set</span> <span class="token function">nanager</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_manager<span class="token operator">=</span>arg<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ul><li>客户端先通过服务对象的字段得到另一对象(受托类)，然后调用此类的函数，我们就必须知晓这一层关系。某日受托类修改了接口，影响会波使用服务对象的客户端。可以在服务对象上放置一个简单的<code>委托函数</code>，将委托关系隐藏，去除依赖，避免影响所有客户端。</li></ul></div> <h2 id="_192-移除中间人-remove-middle-man"><a href="#_192-移除中间人-remove-middle-man" aria-hidden="true" class="header-anchor">#</a> <span id="s192">(192)移除中间人 / Remove Middle Man</span></h2> <p>反向重构：<a href="#s189">隐藏委托关系(189)</a></p> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code>manager<span class="token operator">=</span> aPerson<span class="token punctuation">.</span>manager<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_department<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Department</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">manager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_department<span class="token punctuation">.</span>manager<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Department</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">manager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_manager<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code>manager<span class="token operator">=</span> aPerson<span class="token punctuation">.</span>department<span class="token punctuation">.</span>manager<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_department<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Department</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// # 已建立 department()，可将此 manager() 函数移除</span>
  <span class="token comment">// get manager(){</span>
  <span class="token comment">//   return this._department.manager;</span>
  <span class="token comment">// }</span>

  <span class="token keyword">get</span> <span class="token function">department</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_department<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Department</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">manager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_manager<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ul><li>当受托对象太过，太多的<code>转发函数</code>会使人烦躁，此时就要反向除去一些，寻求合适的隐藏程度。</li> <li>很难说怎样程度的隐藏是适合的，随著代码的变化，<code>合适的隐藏程度</code>这尺度也应随之变化，<code>隐藏委托关系</code>和<code>删除中间人</code>会不断的交替使用。</li></ul></div> <h2 id="_195-替换算法-substitute-algorithm"><a href="#_195-替换算法-substitute-algorithm" aria-hidden="true" class="header-anchor">#</a> <span id="s195">(195)替换算法 / Substitute Algorithm</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foundPerson</span><span class="token punctuation">(</span><span class="token parameter">people</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>people<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>people<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">===</span><span class="token string">&quot;Don&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">&quot;Don&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>people<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">===</span><span class="token string">&quot;John&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>people<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">===</span><span class="token string">&quot;Kent&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">&quot;Kent&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foundPerson</span><span class="token punctuation">(</span><span class="token parameter">people</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> cadidates<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;Don&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Kent&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> people<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token operator">=&gt;</span>cadidates<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ul><li>重构可以把一些复杂的代码分解为简单的小块，但有时必须要壮士断腕的删掉整个算法，代之比较简单的算法。</li></ul></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/workflow/refactor/refactor.html" class="prev">
          重構
        </a></span> <span class="next"><a href="/workflow/refactor/move.html">
          搬移
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/workflow/assets/js/app.21f02376.js" defer></script><script src="/workflow/assets/js/32.a705fe0e.js" defer></script>
  </body>
</html>
