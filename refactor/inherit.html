<!DOCTYPE html>
<html lang="zh-Hans">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>处理继承关系 | 前端学习</title>
    <meta name="description" content="工作流">
    <link rel="manifest" href="/workflow/manifest.json">
  <link rel="apple-touch-icon" href="/workflow/img/logo.png">
    
    <link rel="preload" href="/workflow/assets/css/0.styles.89c56574.css" as="style"><link rel="preload" href="/workflow/assets/js/app.21f02376.js" as="script"><link rel="preload" href="/workflow/assets/js/33.97b79008.js" as="script"><link rel="prefetch" href="/workflow/assets/js/10.21852b11.js"><link rel="prefetch" href="/workflow/assets/js/11.f64d45b2.js"><link rel="prefetch" href="/workflow/assets/js/12.9586b2eb.js"><link rel="prefetch" href="/workflow/assets/js/13.362695f8.js"><link rel="prefetch" href="/workflow/assets/js/14.5011e510.js"><link rel="prefetch" href="/workflow/assets/js/15.602ee5a0.js"><link rel="prefetch" href="/workflow/assets/js/16.f76b32cd.js"><link rel="prefetch" href="/workflow/assets/js/17.12a6afbb.js"><link rel="prefetch" href="/workflow/assets/js/18.eab1da27.js"><link rel="prefetch" href="/workflow/assets/js/19.2b640b10.js"><link rel="prefetch" href="/workflow/assets/js/2.d5709b3c.js"><link rel="prefetch" href="/workflow/assets/js/20.3398b7c2.js"><link rel="prefetch" href="/workflow/assets/js/21.c325b732.js"><link rel="prefetch" href="/workflow/assets/js/22.c3df5e1b.js"><link rel="prefetch" href="/workflow/assets/js/23.898e6112.js"><link rel="prefetch" href="/workflow/assets/js/24.051a0bbc.js"><link rel="prefetch" href="/workflow/assets/js/25.554600d3.js"><link rel="prefetch" href="/workflow/assets/js/26.16320fe2.js"><link rel="prefetch" href="/workflow/assets/js/27.512eede4.js"><link rel="prefetch" href="/workflow/assets/js/28.3e0725db.js"><link rel="prefetch" href="/workflow/assets/js/29.5466dfa8.js"><link rel="prefetch" href="/workflow/assets/js/3.0689ac69.js"><link rel="prefetch" href="/workflow/assets/js/30.cd41e5b5.js"><link rel="prefetch" href="/workflow/assets/js/31.002ecbd9.js"><link rel="prefetch" href="/workflow/assets/js/32.a705fe0e.js"><link rel="prefetch" href="/workflow/assets/js/34.3796137b.js"><link rel="prefetch" href="/workflow/assets/js/35.0b4e016b.js"><link rel="prefetch" href="/workflow/assets/js/36.dd2588d5.js"><link rel="prefetch" href="/workflow/assets/js/37.b7cf03a2.js"><link rel="prefetch" href="/workflow/assets/js/38.8e43f6aa.js"><link rel="prefetch" href="/workflow/assets/js/39.2fd073aa.js"><link rel="prefetch" href="/workflow/assets/js/4.1d131f68.js"><link rel="prefetch" href="/workflow/assets/js/40.739236ee.js"><link rel="prefetch" href="/workflow/assets/js/41.77a6a6db.js"><link rel="prefetch" href="/workflow/assets/js/42.147c2537.js"><link rel="prefetch" href="/workflow/assets/js/43.98113f75.js"><link rel="prefetch" href="/workflow/assets/js/44.7e138f8f.js"><link rel="prefetch" href="/workflow/assets/js/45.18960dae.js"><link rel="prefetch" href="/workflow/assets/js/46.5facf218.js"><link rel="prefetch" href="/workflow/assets/js/47.80ebf3e6.js"><link rel="prefetch" href="/workflow/assets/js/5.cb412c95.js"><link rel="prefetch" href="/workflow/assets/js/6.59392cf1.js"><link rel="prefetch" href="/workflow/assets/js/7.62b86de1.js"><link rel="prefetch" href="/workflow/assets/js/8.455db33c.js"><link rel="prefetch" href="/workflow/assets/js/9.eab8be47.js">
    <link rel="stylesheet" href="/workflow/assets/css/0.styles.89c56574.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/workflow/" class="home-link router-link-active"><!----> <span class="site-name">前端学习</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/workflow/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://confluence.shinho.net.cn/pages/viewpage.action?pageId=17127648" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Activo
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/telliex/telliex.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/workflow/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://confluence.shinho.net.cn/pages/viewpage.action?pageId=17127648" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Activo
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/telliex/telliex.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/workflow/work/" class="sidebar-link">工作流</a></li><li><a href="/workflow/demand/" class="sidebar-link">需求分析</a></li><li><a href="/workflow/task/" class="sidebar-link">任务拆解</a></li><li><a href="/workflow/user-story/" class="sidebar-link">使用者故事</a></li><li><a href="/workflow/test-strategy/" class="sidebar-link">测试策略</a></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>TDD</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/tdd/" class="sidebar-link">认识 TDD</a></li><li><a href="/workflow/tdd/TDD-touch.html" class="sidebar-link">TDD 轻体验</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>单元测试</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/ut/" class="sidebar-link">单元测试</a></li><li><a href="/workflow/ut/ut-vue.html" class="sidebar-link">Vue 单元测试</a></li><li><a href="/workflow/ut/jest.html" class="sidebar-link">Jest</a></li><li><a href="/workflow/ut/vue-jest-callback-functions.html" class="sidebar-link">异步调用</a></li><li><a href="/workflow/ut/vue-jest-mock.html" class="sidebar-link">Mock</a></li><li><a href="/workflow/ut/vue-jest-template1.html" class="sidebar-link">Jest 实战范例 1</a></li><li><a href="/workflow/ut/vue-jest-template2.html" class="sidebar-link">Jest 实战范例 2</a></li><li><a href="/workflow/ut/vue-jest-template3.html" class="sidebar-link">Jest 实战范例 3</a></li><li><a href="/workflow/ut/vue-jest-template4.html" class="sidebar-link">Jest 实战范例 4</a></li><li><a href="/workflow/ut/vue-jest-tools.html" class="sidebar-link">工具</a></li><li><a href="/workflow/ut/ut-doit.html" class="sidebar-link">实作</a></li><li><a href="/workflow/ut/ut-question.html" class="sidebar-link">问题</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>BDD 测试</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/vue-bdd-test/" class="sidebar-link">Vue BDD 测试</a></li><li><a href="/workflow/vue-bdd-test/bdd-cucumber.html" class="sidebar-link">Cucumber</a></li><li><a href="/workflow/vue-bdd-test/bdd-nightwatch.html" class="sidebar-link">Nightwatch</a></li><li><a href="/workflow/vue-bdd-test/bdd-cuketest.html" class="sidebar-link">Cuketest</a></li><li><a href="/workflow/vue-bdd-test/bdd-report.html" class="sidebar-link">bdd report</a></li><li><a href="/workflow/vue-bdd-test/bdd-doit.html" class="sidebar-link">实作 1</a></li><li><a href="/workflow/vue-bdd-test/bdd-doit-2.html" class="sidebar-link">实作 2</a></li></ul></div></li><li><a href="/workflow/performance/" class="sidebar-link">性能测试</a></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>重构</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/refactor/" class="sidebar-link">代码坏味道</a></li><li><a href="/workflow/refactor/refactor.html" class="sidebar-link">重構</a></li><li><a href="/workflow/refactor/encapsulate.html" class="sidebar-link">封装</a></li><li><a href="/workflow/refactor/move.html" class="sidebar-link">搬移</a></li><li><a href="/workflow/refactor/anew.html" class="sidebar-link">重新组织数据</a></li><li><a href="/workflow/refactor/simplify.html" class="sidebar-link">简化条件逻辑</a></li><li><a href="/workflow/refactor/api.html" class="sidebar-link">重构API</a></li><li><a href="/workflow/refactor/inherit.html" class="active sidebar-link">处理继承关系</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>设计模式</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/designpattern/" class="sidebar-link">设计模式</a></li></ul></div></li><li><a href="/workflow/function/" class="sidebar-link">函数式编程</a></li><li><a href="/workflow/explanation/" class="sidebar-link">名词解释</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="处理继承关系"><a href="#处理继承关系" aria-hidden="true" class="header-anchor">#</a> 处理继承关系</h1> <ul><li><a href="#s350">(350)函数上移 / Pull Up Method</a></li> <li><a href="#s353">(353)字段上移 / Pull Up Field</a></li> <li><a href="#s355">(355)构造函数本体上移 / Pull Up Constructor Body</a></li> <li><a href="#s359">(359)函数下移 / Push Down Method</a></li> <li><a href="#s361">(361)字段下移 / Push Down Field</a></li> <li><a href="#s362">(362)以子类取代类型码 / Replace Type Code with Subclasses</a></li> <li><a href="#s369">(369)移除子类 / Remove Subclass</a></li> <li><a href="#s375">(375)提炼超类 / Extract Superclass</a></li> <li><a href="#s380">(380)折叠继承体系 / Collapse Hierarchy</a></li> <li><a href="#s381">(381)以委托取代子类 / Replace Subclass with Delegate</a></li> <li><a href="#s399">(399)以委托取代超类 / Replace Superclass with Delegate</a></li></ul> <h2 id="_350-函数上移-pull-up-method"><a href="#_350-函数上移-pull-up-method" aria-hidden="true" class="header-anchor">#</a> <span id="s350">(350)函数上移 / Pull Up Method</span></h2> <p>反向重构：<a href="#359">(359)函数下移 / Push Down Method</a></p> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Salesman</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">nameA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>monthlyCost <span class="token operator">*</span><span class="token number">12</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Engineer</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">nameB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>monthlyCost <span class="token operator">*</span><span class="token number">12</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>monthlyCost <span class="token operator">*</span><span class="token number">12</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Salesman</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Engineer</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>重复的两个函数也许能正常工作，但假以时日却是 bug 产生的温床，会有<code>修改其一却未能修改另一</code>的风险。</li> <li>某个函数在个子类中的函数体都相同，这便是显而易见的此重构使用场合。</li> <li><code>函数上移</code>常会紧随其他重构被使用。</li></ol></div> <h2 id="_353-字段上移-pull-up-field"><a href="#_353-字段上移-pull-up-field" aria-hidden="true" class="header-anchor">#</a> <span id="s353">(353)字段上移 / Pull Up Field</span></h2> <p>反向重构：<a href="#361">(361)字段下移 / Push Down Field</a></p> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// java</span>
<span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Salesman</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Engineer</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Salesman</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Engineer</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>如个子类是分别开发的，或是重构过程中组合起来的，常会发现它门拥有重复特性，特别是字段的重复，观察函数是如合适用它门，如果相似，就可以它们移到超类去。</li></ol></div> <h2 id="_355-构造函数本体上移-pull-up-constructor-body"><a href="#_355-构造函数本体上移-pull-up-constructor-body" aria-hidden="true" class="header-anchor">#</a> <span id="s355">(355)构造函数本体上移 / Pull Up Constructor Body</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Party</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token keyword">extends</span> <span class="token class-name">Party</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>id<span class="token punctuation">,</span>monthlyCost</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_id<span class="token operator">=</span>id<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token operator">=</span>name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_monthlyCost<span class="token operator">=</span>monthlyCost<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Party</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token operator">=</span>name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token keyword">extends</span> <span class="token class-name">Party</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>id<span class="token punctuation">,</span>monthlyCost</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_id<span class="token operator">=</span>id<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_monthlyCost<span class="token operator">=</span>monthlyCost<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>子类内的共同行为若是在建构函数内，作法就较特殊些。含有特殊的规则及限制。</li></ol></div> <h3 id="完整范例"><a href="#完整范例" aria-hidden="true" class="header-anchor">#</a> 完整范例</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">isPrivileged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
  <span class="token function">assignCar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Manager</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>
  <span class="token function">consturctor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>grade</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_grade<span class="token operator">=</span>grade<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isPrivileged<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">assignCar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ever sunclass does this</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">isPrivileged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_grade<span class="token operator">&gt;</span><span class="token number">4</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">isPrivileged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
  <span class="token function">assignCar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>

  <span class="token function">finishConstruction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isPrivileged<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">assignCar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Manager</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>
  <span class="token function">consturctor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>grade</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_grade<span class="token operator">=</span>grade<span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">finishConstruction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">isPrivileged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_grade<span class="token operator">&gt;</span><span class="token number">4</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_359-函数下移-push-down-method"><a href="#_359-函数下移-push-down-method" aria-hidden="true" class="header-anchor">#</a> <span id="s359">(359)函数下移 / Push Down Method</span></h2> <p>反向重构：<a href="#359">(359)函数上移 / Pull Up Method</a></p> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> quota<span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Engineer</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">salemans</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Engineer</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">salemans</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>
   <span class="token keyword">get</span> quota<span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>如果超类中的某个函数只与一子类有关，那最好将其从超类中挪走，放到真正关心它的子类。</li></ol></div> <h2 id="_361-字段下移-push-down-field"><a href="#_361-字段下移-push-down-field" aria-hidden="true" class="header-anchor">#</a> <span id="s361">(361)字段下移 / Push Down Field</span></h2> <p>反向重构：<a href="#353">(353)字段上移 / Pull Up Field</a></p> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Salesman</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Engineer</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Salesman</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Engineer</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>如果某个字段只被一个子类用到，那就将其搬移到需要该字段的子类去。</li></ol></div> <h2 id="_362-以子类取代类型码-replace-type-code-with-subclasses"><a href="#_362-以子类取代类型码-replace-type-code-with-subclasses" aria-hidden="true" class="header-anchor">#</a> <span id="s362">(362)以子类取代类型码 / Replace Type Code with Subclasses</span></h2> <p>反向重构：<a href="#369">(369)移除子类 / Remove Subclass</a></p> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createEmployee</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>type</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createEmployee</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>type</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'engineer'</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Engineer</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'salemans'</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">salemans</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'manager'</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">manager</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>软件系统经常要表现<code>相似但又不同的东西</code>,表现分类关系的工具是<code>类型码字段(枚举、符号、字符串、数字)</code>。</li> <li>我们可以引入子类概念，用<code>多态</code>来处理条件逻辑。</li></ol></div> <h3 id="完整范例-2"><a href="#完整范例-2" aria-hidden="true" class="header-anchor">#</a> 完整范例</h3> <h4 id="使用直接继承"><a href="#使用直接继承" aria-hidden="true" class="header-anchor">#</a> 使用直接继承</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>type</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">validateType</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token operator">=</span>name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_type<span class="token operator">=</span>type<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">validateType</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token string">'engineer'</span><span class="token punctuation">,</span><span class="token string">'manager'</span><span class="token punctuation">,</span><span class="token string">'saleman'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">include</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Employee cannot be type </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>arg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>_type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token operator">=</span>name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Engineer</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">'engineer'</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Manager</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">'manager'</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Saleman</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">'saleman'</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">function</span> <span class="token function">creatEmployee</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>type</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'enhineer'</span> <span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Engineer</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'manager'</span> <span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Manager</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'saleman'</span> <span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Saleman</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Employee cannot be type </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="使用间接继承"><a href="#使用间接继承" aria-hidden="true" class="header-anchor">#</a> 使用间接继承</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>type</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">validateType</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token operator">=</span>name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_type<span class="token operator">=</span>type<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">validateType</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token string">'engineer'</span><span class="token punctuation">,</span><span class="token string">'manager'</span><span class="token punctuation">,</span><span class="token string">'saleman'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">include</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Employee cannot be type </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>arg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">typeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_type<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_type<span class="token punctuation">;</span><span class="token punctuation">}</span>
  <span class="token keyword">set</span> <span class="token function">type</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_type <span class="token operator">=</span>Employee<span class="token punctuation">.</span><span class="token function">creatEmployeeType</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">}</span>

  <span class="token comment">// get capitalizedType(){</span>
  <span class="token comment">//     return this.typeString.charAt(0).toUpperCase()+this.typeString.substr(1).toLowerCase();</span>
  <span class="token comment">// }</span>

  <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>capitalizeName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token function">creatEmployeeType</span><span class="token punctuation">(</span><span class="token parameter">aString</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>aString<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">'enhineer'</span> <span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Engineer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">'manager'</span> <span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Manager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">'saleman'</span> <span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Saleman</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span>  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Employee cannot be type </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>aString<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">EmployeeType</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">aString</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_value<span class="token operator">=</span>aString<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_value<span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">get</span> <span class="token function">capitalizedName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>toString<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>toString<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">class</span> <span class="token class-name">Engineer</span> <span class="token keyword">extends</span> <span class="token class-name">EmployeeType</span><span class="token punctuation">{</span>
    <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">'engineer'</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Manager</span> <span class="token keyword">extends</span> <span class="token class-name">EmployeeType</span><span class="token punctuation">{</span>
    <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">'manager'</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Saleman</span> <span class="token keyword">extends</span> <span class="token class-name">EmployeeType</span><span class="token punctuation">{</span>
    <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">'saleman'</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre></div><h2 id="_369-移除子类-remove-subclass"><a href="#_369-移除子类-remove-subclass" aria-hidden="true" class="header-anchor">#</a> <span id="s369">(369)移除子类 / Remove Subclass</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">genderCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'X'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Male</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">genderCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'M'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Female</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">genderCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'F'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">genderCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_genderCode<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>时间久了，当初规划的子类就有成本，阅读者要花心思去理解它的用途，如果用途太少，便不值得存在。最好的选择是移除子类，替换上超类中的一个字段。</li></ol></div> <h3 id="完整范例-3"><a href="#完整范例-3" aria-hidden="true" class="header-anchor">#</a> 完整范例</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token operator">=</span>name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">genderCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">'X'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Male</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">genderCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'M'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">FeMale</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">genderCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'F'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">loadFromInput</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> result<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">aRecord</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> p<span class="token punctuation">;</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>aRecord<span class="token punctuation">.</span>gender<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">'M'</span><span class="token punctuation">:</span> p<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Male</span><span class="token punctuation">(</span>aRecord<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">'F'</span><span class="token punctuation">:</span> p<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Female</span><span class="token punctuation">(</span>aRecord<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> p<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>aRecord<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 客户端</span>
<span class="token keyword">const</span> numberOfMales<span class="token operator">=</span>people<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token operator">=&gt;</span>p <span class="token keyword">instanceof</span> <span class="token class-name">Male</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length

</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>genderCode</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token operator">=</span>name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_genderCode<span class="token operator">=</span>genderCode <span class="token operator">||</span> <span class="token string">'X'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">genderCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_genderCode<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">isMale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Male</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">loadFromInput</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">aRecord</span><span class="token operator">=&gt;</span><span class="token function">createPerson</span><span class="token punctuation">(</span>aRecord<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">createPerson</span><span class="token punctuation">(</span><span class="token parameter">aRecord</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  
  <span class="token keyword">switch</span><span class="token punctuation">(</span>aRecord<span class="token punctuation">.</span>gender<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'M'</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Male</span><span class="token punctuation">(</span>aRecord<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'F'</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Female</span><span class="token punctuation">(</span>aRecord<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>aRecord<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token comment">// 客户端</span>
<span class="token keyword">const</span> numberOfMales<span class="token operator">=</span>people<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token operator">=&gt;</span>p<span class="token punctuation">.</span>isMale<span class="token punctuation">)</span><span class="token punctuation">.</span>length

</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>genderCode</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token operator">=</span>name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_genderCode<span class="token operator">=</span>genderCode<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">genderCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_genderCode<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">isMale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Male</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">loadFromInput</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">aRecord</span><span class="token operator">=&gt;</span><span class="token function">createPerson</span><span class="token punctuation">(</span>aRecord<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">createPerson</span><span class="token punctuation">(</span><span class="token parameter">aRecord</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  
  <span class="token keyword">switch</span><span class="token punctuation">(</span>aRecord<span class="token punctuation">.</span>gender<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'M'</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>aRecord<span class="token punctuation">.</span>name<span class="token punctuation">,</span><span class="token string">'M'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'F'</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>aRecord<span class="token punctuation">.</span>name<span class="token punctuation">,</span><span class="token string">'F'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>aRecord<span class="token punctuation">.</span>name<span class="token punctuation">,</span><span class="token string">'X'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token comment">// 客户端</span>
<span class="token keyword">const</span> numberOfMales<span class="token operator">=</span>people<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token operator">=&gt;</span>p<span class="token punctuation">.</span>isMale<span class="token punctuation">)</span><span class="token punctuation">.</span>length

</code></pre></div><h2 id="_375-提炼超类-extract-superclass"><a href="#_375-提炼超类-extract-superclass" aria-hidden="true" class="header-anchor">#</a> <span id="s375">(375)提炼超类 / Extract Superclass</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Department</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">totalAnnualCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">headCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">annualCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Patry</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">annualCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Department</span> <span class="token keyword">extends</span> <span class="token class-name">Party</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">annualCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">headCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token keyword">extends</span> <span class="token class-name">Party</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">annualCost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>两个类在做相似的事，可以利用基本的继承机制把它们相似之处提炼到超类。</li> <li>除了使用<code>字段上移</code>和<code>函数上移</code>等重构手法搬移相同行为外，可使用<code>提炼类</code>。</li></ol></div> <h2 id="_380-折叠继承体系-collapse-hierarchy"><a href="#_380-折叠继承体系-collapse-hierarchy" aria-hidden="true" class="header-anchor">#</a> <span id="s380">(380)折叠继承体系 / Collapse Hierarchy</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Salesman</span> <span class="token keyword">extends</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>随著继承体系的演化，我们会发现一个类与其超类已经没有多大差别，不值得再作为独立类存在，我们就可以将超类与子类合并。</li></ol></div> <h2 id="_381-以委托取代子类-replace-subclass-with-delegate"><a href="#_381-以委托取代子类-replace-subclass-with-delegate" aria-hidden="true" class="header-anchor">#</a> <span id="s381">(381)以委托取代子类 / Replace Subclass with Delegate</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Order</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">daysToShip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_warehouse<span class="token punctuation">.</span>daysToShip<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">PriorityOrder</span> <span class="token keyword">extends</span> <span class="token class-name">Order</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">daysToShip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_priorityPlan<span class="token punctuation">.</span>daysToShip<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Order</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">daysToShip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_priorityDelegate<span class="token punctuation">)</span>
            <span class="token operator">?</span><span class="token keyword">this</span><span class="token punctuation">.</span>_priorityDelegate<span class="token punctuation">.</span>daysToShip
            <span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>_warehouse<span class="token punctuation">.</span>daysToShip<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">PriorityOrder</span> <span class="token keyword">extends</span> <span class="token class-name">Order</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">daysToShip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_priorityPlan<span class="token punctuation">.</span>daysToShip<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>超类的修改会影响子类，这时若以<code>以委托取代子类</code>来重构，可解决。</li> <li>与继承关系相比，使用委托关系时接口更清晰，耦合更少。</li> <li>继承是一种很有价值的机制，大部分时候能达到效果，不会带来问题。若开始出现问题，再转以使用委托。</li></ol></div> <h3 id="完整范例-4"><a href="#完整范例-4" aria-hidden="true" class="header-anchor">#</a> 完整范例</h3> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">// 一般服务</span>
<span class="token keyword">class</span> <span class="token class-name">Booking</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">show<span class="token punctuation">,</span>date</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_show<span class="token operator">=</span>show<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_date<span class="token operator">=</span>date<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">isPeakDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">hasTalkback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_show<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'talkback'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isPeakDay<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">basePrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> result<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>_show<span class="token punctuation">.</span>price<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isPeakDay<span class="token punctuation">)</span> result <span class="token operator">+=</span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>result <span class="token operator">*</span> <span class="token number">0.15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 加值服务</span>
<span class="token keyword">class</span> <span class="token class-name">PremiumBooking</span> <span class="token keyword">extends</span> <span class="token class-name">Booking</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">show<span class="token punctuation">,</span>date<span class="token punctuation">,</span>extras</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>show<span class="token punctuation">,</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_extras<span class="token operator">=</span>extras<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">isPeakDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">hasTalkback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_show<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'talkback'</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">basePrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token keyword">super</span><span class="token punctuation">.</span>basePrice <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_extras<span class="token punctuation">.</span>premiunFee<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">hasDinner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_extras<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'dinner'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isPeakDay<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 普通预定客户端</span>
<span class="token keyword">let</span> aBooking<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Booking</span><span class="token punctuation">(</span>show<span class="token punctuation">,</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 高级预定客户端</span>
<span class="token keyword">let</span> aBooking<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">PremiumBooking</span><span class="token punctuation">(</span>show<span class="token punctuation">,</span>date<span class="token punctuation">.</span>extras<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Booking</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">show<span class="token punctuation">,</span>date<span class="token punctuation">,</span>extras</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_show<span class="token operator">=</span>show<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_date<span class="token operator">=</span>date<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">isPeakDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">hasTalkback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_premiumDelegate<span class="token punctuation">)</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_premiumDelegate<span class="token punctuation">.</span>hasTalkback <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_show<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'talkback'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isPeakDay<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">basePrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> result<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>_show<span class="token punctuation">.</span>price<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isPeakDay<span class="token punctuation">)</span> result <span class="token operator">+=</span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>result <span class="token operator">*</span> <span class="token number">0.15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_premiumDelegate<span class="token punctuation">)</span><span class="token operator">?</span><span class="token keyword">this</span><span class="token punctuation">.</span>_premiumDelegate<span class="token punctuation">.</span><span class="token function">extendBasePrice</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">:</span>result<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 
  <span class="token keyword">get</span> <span class="token function">_bePremium</span><span class="token punctuation">(</span><span class="token parameter">extras</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>_premiumDelegate<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">PremiumBookingDelegate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>extras<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 
  <span class="token keyword">get</span> <span class="token function">hasDinner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_premiumDelegate<span class="token punctuation">)</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_premiumDelegate<span class="token punctuation">.</span>hasDinner<span class="token punctuation">:</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">createBooking</span><span class="token punctuation">(</span><span class="token parameter">show<span class="token punctuation">,</span>date</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Booking</span><span class="token punctuation">(</span>show<span class="token punctuation">,</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">createPremiumBooking</span><span class="token punctuation">(</span><span class="token parameter">show<span class="token punctuation">,</span>date<span class="token punctuation">,</span>extras</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> result<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Booking</span><span class="token punctuation">(</span>show<span class="token punctuation">,</span>date<span class="token punctuation">,</span>extras<span class="token punctuation">)</span><span class="token punctuation">;</span>
  result<span class="token punctuation">.</span><span class="token function">_bePremium</span><span class="token punctuation">(</span>extras<span class="token punctuation">)</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 建立委托类</span>
<span class="token keyword">class</span> <span class="token class-name">PremiumBookingDelegate</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">hostBooking<span class="token punctuation">,</span>extras</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_host<span class="token operator">=</span>hostBooking<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_extras<span class="token operator">=</span>extras<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">hasTalkback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_host<span class="token punctuation">.</span>_show<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'talkback'</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">basePrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_host<span class="token punctuation">.</span>privateBasePrice <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_extras<span class="token punctuation">.</span>premiunFee<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">extendBasePrice</span><span class="token punctuation">(</span><span class="token parameter">base</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>base<span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>_extras<span class="token punctuation">.</span>premiumFee<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">hasDinner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_extras<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'dinner'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_host<span class="token punctuation">.</span>isPeakDay<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>



<span class="token comment">// 普通预定客户端</span>
<span class="token keyword">let</span> aBooking<span class="token operator">=</span><span class="token function">createBooking</span><span class="token punctuation">(</span>show<span class="token punctuation">,</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 高级预定客户端</span>
<span class="token keyword">let</span> aBooking<span class="token operator">=</span><span class="token function">createPremiumBooking</span><span class="token punctuation">(</span>show<span class="token punctuation">,</span>date<span class="token punctuation">.</span>extras<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_399-以委托取代超类-replace-superclass-with-delegate"><a href="#_399-以委托取代超类-replace-superclass-with-delegate" aria-hidden="true" class="header-anchor">#</a> <span id="s399">(399)以委托取代超类 / Replace Superclass with Delegate</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">List</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Stack</span> <span class="token keyword">extends</span> <span class="token class-name">List</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">List</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Stack</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_storage<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">List</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>继承关系最简洁又高效的复用，即超类的所有方法都适于子类，子类的所有实例都是超类的实例。</li> <li>如果超类的一些函数对子类并不适用，就说明不应该通过继承来获得超类功能。</li> <li>有问题的继承招致了混乱和错误，如果把继承关系改为将部分职能委托给另一对象，那这些混乱和错误是可以轻松避免。</li></ol></div> <h3 id="完整范例-5"><a href="#完整范例-5" aria-hidden="true" class="header-anchor">#</a> 完整范例</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">CatalogItem</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span>title<span class="token punctuation">,</span>tags</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_id<span class="token operator">=</span>id<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token operator">=</span>title<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_tags<span class="token operator">=</span>tags<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">get</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_id <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">title</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_title <span class="token punctuation">}</span>
  <span class="token function">hasTag</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_tags<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Scroll</span> <span class="token keyword">extends</span> <span class="token class-name">CatalogLtem</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span>title<span class="token punctuation">,</span>tags<span class="token punctuation">,</span>dateLastCleaned</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>title<span class="token punctuation">,</span>tags<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_lastCleaned<span class="token operator">=</span>dateLastCleaned<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">needsCleaning</span><span class="token punctuation">(</span><span class="token parameter">targetDate</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> threshold<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hasTag</span><span class="token punctuation">(</span><span class="token string">'revered'</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">700</span><span class="token punctuation">:</span><span class="token number">1500</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">daysSinceLastCleaning</span><span class="token punctuation">(</span>targetDate<span class="token punctuation">)</span><span class="token operator">&gt;</span>threshold<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">daysSinceLastCleaning</span><span class="token punctuation">(</span><span class="token parameter">targetDate</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_lastCleaned<span class="token punctuation">.</span><span class="token function">untile</span><span class="token punctuation">(</span>targetDate<span class="token punctuation">,</span>ChronoUnit<span class="token punctuation">.</span><span class="token constant">DAYS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">CatalogItem</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span>title<span class="token punctuation">,</span>tags</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_id<span class="token operator">=</span>id<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token operator">=</span>title<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_tags<span class="token operator">=</span>tags<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">get</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_id <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">title</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_title <span class="token punctuation">}</span>
  <span class="token function">hasTag</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_tags<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Scroll</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span>title<span class="token punctuation">,</span>tags<span class="token punctuation">,</span>dateLastCleaned</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_catalogItem<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">CatalogItem</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>title<span class="token punctuation">,</span>tags<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_lastCleaned<span class="token operator">=</span>dateLastCleaned<span class="token punctuation">;</span>

  <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_catalogItem<span class="token punctuation">.</span>id <span class="token punctuation">}</span>
  <span class="token keyword">get</span> <span class="token function">title</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_catalogItem<span class="token punctuation">.</span>title <span class="token punctuation">}</span>
  <span class="token function">hasTag</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_catalogItem<span class="token punctuation">.</span><span class="token function">hasTag</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

  <span class="token function">needsCleaning</span><span class="token punctuation">(</span><span class="token parameter">targetDate</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> threshold<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hasTag</span><span class="token punctuation">(</span><span class="token string">'revered'</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token number">700</span><span class="token punctuation">:</span><span class="token number">1500</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">daysSinceLastCleaning</span><span class="token punctuation">(</span>targetDate<span class="token punctuation">)</span><span class="token operator">&gt;</span>threshold<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">daysSinceLastCleaning</span><span class="token punctuation">(</span><span class="token parameter">targetDate</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_lastCleaned<span class="token punctuation">.</span><span class="token function">untile</span><span class="token punctuation">(</span>targetDate<span class="token punctuation">,</span>ChronoUnit<span class="token punctuation">.</span><span class="token constant">DAYS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/workflow/refactor/api.html" class="prev">
          重构API
        </a></span> <span class="next"><a href="/workflow/designpattern/">
          设计模式
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/workflow/assets/js/app.21f02376.js" defer></script><script src="/workflow/assets/js/33.97b79008.js" defer></script>
  </body>
</html>
