<!DOCTYPE html>
<html lang="zh-Hans">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>重构 API | 前端学习</title>
    <meta name="description" content="工作流">
    <link rel="manifest" href="/workflow/manifest.json">
  <link rel="apple-touch-icon" href="/workflow/img/logo.png">
    
    <link rel="preload" href="/workflow/assets/css/0.styles.89c56574.css" as="style"><link rel="preload" href="/workflow/assets/js/app.21f02376.js" as="script"><link rel="preload" href="/workflow/assets/js/31.002ecbd9.js" as="script"><link rel="prefetch" href="/workflow/assets/js/10.21852b11.js"><link rel="prefetch" href="/workflow/assets/js/11.f64d45b2.js"><link rel="prefetch" href="/workflow/assets/js/12.9586b2eb.js"><link rel="prefetch" href="/workflow/assets/js/13.362695f8.js"><link rel="prefetch" href="/workflow/assets/js/14.5011e510.js"><link rel="prefetch" href="/workflow/assets/js/15.602ee5a0.js"><link rel="prefetch" href="/workflow/assets/js/16.f76b32cd.js"><link rel="prefetch" href="/workflow/assets/js/17.12a6afbb.js"><link rel="prefetch" href="/workflow/assets/js/18.eab1da27.js"><link rel="prefetch" href="/workflow/assets/js/19.2b640b10.js"><link rel="prefetch" href="/workflow/assets/js/2.d5709b3c.js"><link rel="prefetch" href="/workflow/assets/js/20.3398b7c2.js"><link rel="prefetch" href="/workflow/assets/js/21.c325b732.js"><link rel="prefetch" href="/workflow/assets/js/22.c3df5e1b.js"><link rel="prefetch" href="/workflow/assets/js/23.898e6112.js"><link rel="prefetch" href="/workflow/assets/js/24.051a0bbc.js"><link rel="prefetch" href="/workflow/assets/js/25.554600d3.js"><link rel="prefetch" href="/workflow/assets/js/26.16320fe2.js"><link rel="prefetch" href="/workflow/assets/js/27.512eede4.js"><link rel="prefetch" href="/workflow/assets/js/28.3e0725db.js"><link rel="prefetch" href="/workflow/assets/js/29.5466dfa8.js"><link rel="prefetch" href="/workflow/assets/js/3.0689ac69.js"><link rel="prefetch" href="/workflow/assets/js/30.cd41e5b5.js"><link rel="prefetch" href="/workflow/assets/js/32.a705fe0e.js"><link rel="prefetch" href="/workflow/assets/js/33.97b79008.js"><link rel="prefetch" href="/workflow/assets/js/34.3796137b.js"><link rel="prefetch" href="/workflow/assets/js/35.0b4e016b.js"><link rel="prefetch" href="/workflow/assets/js/36.dd2588d5.js"><link rel="prefetch" href="/workflow/assets/js/37.b7cf03a2.js"><link rel="prefetch" href="/workflow/assets/js/38.8e43f6aa.js"><link rel="prefetch" href="/workflow/assets/js/39.2fd073aa.js"><link rel="prefetch" href="/workflow/assets/js/4.1d131f68.js"><link rel="prefetch" href="/workflow/assets/js/40.739236ee.js"><link rel="prefetch" href="/workflow/assets/js/41.77a6a6db.js"><link rel="prefetch" href="/workflow/assets/js/42.147c2537.js"><link rel="prefetch" href="/workflow/assets/js/43.98113f75.js"><link rel="prefetch" href="/workflow/assets/js/44.7e138f8f.js"><link rel="prefetch" href="/workflow/assets/js/45.18960dae.js"><link rel="prefetch" href="/workflow/assets/js/46.5facf218.js"><link rel="prefetch" href="/workflow/assets/js/47.80ebf3e6.js"><link rel="prefetch" href="/workflow/assets/js/5.cb412c95.js"><link rel="prefetch" href="/workflow/assets/js/6.59392cf1.js"><link rel="prefetch" href="/workflow/assets/js/7.62b86de1.js"><link rel="prefetch" href="/workflow/assets/js/8.455db33c.js"><link rel="prefetch" href="/workflow/assets/js/9.eab8be47.js">
    <link rel="stylesheet" href="/workflow/assets/css/0.styles.89c56574.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/workflow/" class="home-link router-link-active"><!----> <span class="site-name">前端学习</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/workflow/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://confluence.shinho.net.cn/pages/viewpage.action?pageId=17127648" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Activo
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/telliex/telliex.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/workflow/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://confluence.shinho.net.cn/pages/viewpage.action?pageId=17127648" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Activo
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/telliex/telliex.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/workflow/work/" class="sidebar-link">工作流</a></li><li><a href="/workflow/demand/" class="sidebar-link">需求分析</a></li><li><a href="/workflow/task/" class="sidebar-link">任务拆解</a></li><li><a href="/workflow/user-story/" class="sidebar-link">使用者故事</a></li><li><a href="/workflow/test-strategy/" class="sidebar-link">测试策略</a></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>TDD</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/tdd/" class="sidebar-link">认识 TDD</a></li><li><a href="/workflow/tdd/TDD-touch.html" class="sidebar-link">TDD 轻体验</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>单元测试</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/ut/" class="sidebar-link">单元测试</a></li><li><a href="/workflow/ut/ut-vue.html" class="sidebar-link">Vue 单元测试</a></li><li><a href="/workflow/ut/jest.html" class="sidebar-link">Jest</a></li><li><a href="/workflow/ut/vue-jest-callback-functions.html" class="sidebar-link">异步调用</a></li><li><a href="/workflow/ut/vue-jest-mock.html" class="sidebar-link">Mock</a></li><li><a href="/workflow/ut/vue-jest-template1.html" class="sidebar-link">Jest 实战范例 1</a></li><li><a href="/workflow/ut/vue-jest-template2.html" class="sidebar-link">Jest 实战范例 2</a></li><li><a href="/workflow/ut/vue-jest-template3.html" class="sidebar-link">Jest 实战范例 3</a></li><li><a href="/workflow/ut/vue-jest-template4.html" class="sidebar-link">Jest 实战范例 4</a></li><li><a href="/workflow/ut/vue-jest-tools.html" class="sidebar-link">工具</a></li><li><a href="/workflow/ut/ut-doit.html" class="sidebar-link">实作</a></li><li><a href="/workflow/ut/ut-question.html" class="sidebar-link">问题</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>BDD 测试</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/vue-bdd-test/" class="sidebar-link">Vue BDD 测试</a></li><li><a href="/workflow/vue-bdd-test/bdd-cucumber.html" class="sidebar-link">Cucumber</a></li><li><a href="/workflow/vue-bdd-test/bdd-nightwatch.html" class="sidebar-link">Nightwatch</a></li><li><a href="/workflow/vue-bdd-test/bdd-cuketest.html" class="sidebar-link">Cuketest</a></li><li><a href="/workflow/vue-bdd-test/bdd-report.html" class="sidebar-link">bdd report</a></li><li><a href="/workflow/vue-bdd-test/bdd-doit.html" class="sidebar-link">实作 1</a></li><li><a href="/workflow/vue-bdd-test/bdd-doit-2.html" class="sidebar-link">实作 2</a></li></ul></div></li><li><a href="/workflow/performance/" class="sidebar-link">性能测试</a></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>重构</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/refactor/" class="sidebar-link">代码坏味道</a></li><li><a href="/workflow/refactor/refactor.html" class="sidebar-link">重構</a></li><li><a href="/workflow/refactor/encapsulate.html" class="sidebar-link">封装</a></li><li><a href="/workflow/refactor/move.html" class="sidebar-link">搬移</a></li><li><a href="/workflow/refactor/anew.html" class="sidebar-link">重新组织数据</a></li><li><a href="/workflow/refactor/simplify.html" class="sidebar-link">简化条件逻辑</a></li><li><a href="/workflow/refactor/api.html" class="active sidebar-link">重构API</a></li><li><a href="/workflow/refactor/inherit.html" class="sidebar-link">处理继承关系</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>设计模式</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/designpattern/" class="sidebar-link">设计模式</a></li></ul></div></li><li><a href="/workflow/function/" class="sidebar-link">函数式编程</a></li><li><a href="/workflow/explanation/" class="sidebar-link">名词解释</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="重构-api"><a href="#重构-api" aria-hidden="true" class="header-anchor">#</a> 重构 API</h1> <ul><li><a href="#s306">(306)将查询函数和修改函数分离 / Separate Query from Modifier</a></li> <li><a href="#s310">(310)函数参数化 / Parameterize Function</a></li> <li><a href="#s314">(314)移除标记参数 / Remove Flag Argument</a></li> <li><a href="#s319">(319)保持对象完整 / Preserve Whole Object</a></li> <li><a href="#s324">(324)以查询取代参数 / Replace Parameter with Query</a></li> <li><a href="#s327">(327)以参数取代查询 / Replace Query with Parameter</a></li> <li><a href="#s331">(331)移除设值函数 / Remove Setting Method</a></li> <li><a href="#s334">(334)以工厂函数取代构造函数 / Replace Constructor with Factory Function</a></li> <li><a href="#s337">(337)以命令取代函数 / Replace Function with Command</a></li> <li><a href="#s344">(344)以函数取代命令 / Replace Command with Function</a></li></ul> <h2 id="_306-将查询函数和修改函数分离-separate-query-from-modifier"><a href="#_306-将查询函数和修改函数分离-separate-query-from-modifier" aria-hidden="true" class="header-anchor">#</a> <span id="s360">(306)将查询函数和修改函数分离 / Separate Query from Modifier</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getTotalOutstandingAndSendBill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> result<span class="token operator">=</span>customer<span class="token punctuation">.</span>invoices<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">total<span class="token punctuation">,</span>each</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>each<span class="token punctuation">.</span>amount<span class="token operator">+</span>total<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">sendBill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">totalOutstanding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> customer<span class="token punctuation">.</span>invoices<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">total<span class="token punctuation">,</span>each</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>each<span class="token punctuation">.</span>amount<span class="token operator">+</span>total<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">sendBill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  emailGateway<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token function">formatBill</span><span class="token punctuation">(</span>customer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>任何有返回值的函数，都不应该看到命令和查询分离的副作用。</li> <li>如果遇到一个<code>既有返回值又有副作用</code>的函数，试著将查询动作从修改动作中分离出来。</li></ol></div> <blockquote><p>函数副作用指当调用函数时，除了返回函数值之外，还对主调用函数产生附加的影响。例如修改全局变量（函数外的变量），修改参数或改变外部存储。</p></blockquote> <h3 id="完整范例"><a href="#完整范例" aria-hidden="true" class="header-anchor">#</a> 完整范例</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> found<span class="token operator">=</span><span class="token function">alertForMiscreant</span><span class="token punctuation">(</span>people<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">alertForMiscreant</span><span class="token punctuation">(</span><span class="token parameter">people</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> p <span class="token keyword">of</span> people<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">===</span><span class="token string">'Don'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">setOffAlarms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token string">'Don'</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">===</span><span class="token string">'John'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">setOffAlarms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token string">'John'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> found<span class="token operator">=</span><span class="token function">findMiscreant</span><span class="token punctuation">(</span>people<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alertForMiscreant</span><span class="token punctuation">(</span>people<span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">alertForMiscreant</span><span class="token punctuation">(</span><span class="token parameter">people</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">findMiscreant</span><span class="token punctuation">(</span>people<span class="token punctuation">)</span><span class="token operator">!==</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token function">setOffAlarms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">findMiscreant</span><span class="token punctuation">(</span><span class="token parameter">people</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> p <span class="token keyword">of</span> people<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">===</span><span class="token string">'Don'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">'Don'</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">===</span><span class="token string">'John'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">'John'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="_310-函数参数化-parameterize-function"><a href="#_310-函数参数化-parameterize-function" aria-hidden="true" class="header-anchor">#</a> <span id="s310">(310)函数参数化 / Parameterize Function</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">tenPercentRaise</span><span class="token punctuation">(</span><span class="token parameter">aPerson</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  aPerson<span class="token punctuation">.</span>salary<span class="token operator">=</span>aPerson<span class="token punctuation">.</span>salary<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token number">1.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">fivePercentRaise</span><span class="token punctuation">(</span><span class="token parameter">aPerson</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  aPerson<span class="token punctuation">.</span>salary<span class="token operator">=</span>aPerson<span class="token punctuation">.</span>salary<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token number">1.05</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code>finction <span class="token function">raise</span><span class="token punctuation">(</span><span class="token parameter">aPerson<span class="token punctuation">,</span>factor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  aPerson<span class="token punctuation">.</span>salary<span class="token operator">=</span>aPerson<span class="token punctuation">.</span>salary<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>factor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>如果发现两个涮得逻辑非常接近，只有一些字面量值不同，可以将其合并成一函数，以参数的形式传入不同值，从而消除重复。</li></ol></div> <h2 id="_314-移除标记参数-remove-flag-argument"><a href="#_314-移除标记参数-remove-flag-argument" aria-hidden="true" class="header-anchor">#</a> <span id="s314">(314)移除标记参数 / Remove Flag Argument</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">setDimension</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>name<span class="token operator">===</span><span class="token string">'height'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token operator">=</span>value<span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>name<span class="token operator">===</span><span class="token string">'width'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_width<span class="token operator">=</span>value<span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">setHeight</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>_height<span class="token operator">=</span>value<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">setWidth</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>_width<span class="token operator">=</span>value<span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li><code>标记参数</code>，让人难以理解倒底有哪些函数可以调用，该怎么调用。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">bookConcert</span><span class="token punctuation">(</span>aCustomer<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">bookConcert</span><span class="token punctuation">(</span>aCustomer<span class="token punctuation">,</span>CustomerType<span class="token punctuation">.</span><span class="token constant">PREMIUM</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">bookConcert</span><span class="token punctuation">(</span>aCustomer<span class="token punctuation">,</span><span class="token string">'premium'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>并非所有类似这样引用的参数都是标记参数，如果传入的是程序中流动的数据，此参数不算<code>标记参数</code>，只有调用者直接传入字面量值，才是<code>标记参数</code>。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> isRush<span class="token operator">=</span><span class="token function">determineIfRush</span><span class="token punctuation">(</span>anOrder<span class="token punctuation">)</span><span class="token punctuation">;</span>
aShipment<span class="token punctuation">.</span>deliveryDate<span class="token operator">=</span><span class="token function">deliveryDate</span><span class="token punctuation">(</span>anOrder<span class="token punctuation">,</span>isRush<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <h2 id="_319-保持对象完整-preserve-whole-object"><a href="#_319-保持对象完整-preserve-whole-object" aria-hidden="true" class="header-anchor">#</a> <span id="s319">(319)保持对象完整 / Preserve Whole Object</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> low<span class="token operator">=</span>aRoom<span class="token punctuation">.</span>daysTempRange<span class="token punctuation">.</span>low<span class="token punctuation">;</span>
<span class="token keyword">const</span> high<span class="token operator">=</span>aRoom<span class="token punctuation">.</span>daysTempRange<span class="token punctuation">.</span>high<span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>aPlan<span class="token punctuation">.</span><span class="token function">withinRange</span><span class="token punctuation">(</span>low<span class="token punctuation">,</span>high<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span>aPlan<span class="token punctuation">.</span><span class="token function">withinRange</span><span class="token punctuation">(</span>aRoom<span class="token punctuation">.</span>daysTempRange8<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>代码从一个记录结构中导出几个值，然后这几个值一起传递给一个函数，我们会更愿意将整个记录传给这函数，在函数内部导出所需的值。</li></ol></div> <h2 id="_324-以查询取代参数-replace-parameter-with-query"><a href="#_324-以查询取代参数-replace-parameter-with-query" aria-hidden="true" class="header-anchor">#</a> <span id="s324">(324)以查询取代参数 / Replace Parameter with Query</span></h2> <p>反向重构：<a href="#s327">(327)以参数取代查询 / Replace Query with Parameter</a></p> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">availableVacation</span><span class="token punctuation">(</span>anEmployee<span class="token punctuation">,</span>anEmployee<span class="token punctuation">.</span>grade<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">availableVacation</span><span class="token punctuation">(</span><span class="token parameter">anEmployee<span class="token punctuation">,</span>grade</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">availableVacation</span><span class="token punctuation">(</span>anEmployee<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">availableVacation</span><span class="token punctuation">(</span><span class="token parameter">anEmployee<span class="token punctuation">,</span>grade</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> grade<span class="token operator">=</span>anEmployee<span class="token punctuation">.</span>grade<span class="token punctuation">;</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>函数的参数列表和代码中的语句一样，应该避免重复，并且参数列表越短越容易理解。</li> <li><span style="color:red;">为了除去一个参数，而需要在函数体内调用一个有问题的函数，或是从一个对象中获取某些原本想要剥离出去的数据，这种情况下就应该慎重使用此重构方法。</span></li> <li>如果想要去除的参数值只需要像另一个参数查询就可以得到，这就是使用此重构法最好时机。</li> <li>如果可以从一个参数推导出另一个参数，那就几乎没有任何理由同时传递两个参数。</li></ol></div> <h2 id="_327-以参数取代查询-replace-query-with-parameter"><a href="#_327-以参数取代查询-replace-query-with-parameter" aria-hidden="true" class="header-anchor">#</a> <span id="s327">(327)以参数取代查询 / Replace Query with Parameter</span></h2> <p>反向重构：<a href="#s324">(324)以查询取代参数 / Replace Parameter with Query</a></p> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">targetTemperature</span><span class="token punctuation">(</span>aPlan<span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">targetTemperature</span><span class="token punctuation">(</span><span class="token parameter">aPlan</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  currentTemperature<span class="token operator">=</span>thermostat<span class="token punctuation">.</span>currentTemperature<span class="token punctuation">;</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">targetTemperature</span><span class="token punctuation">(</span>aPlan<span class="token punctuation">,</span>thermostat<span class="token punctuation">.</span>currentTemperature<span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">targetTemperature</span><span class="token punctuation">(</span><span class="token parameter">aPlan<span class="token punctuation">,</span>currentTemperature</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>函数内，当引用一个<code>全局变量</code>或是<code>即将被移除的元素</code>，我们需要将此引用替换为函数参数，将处理引用关系的工作交给<strong>函数调用者</strong>。</li> <li>需要使用此重构，源于想改变代码的依赖关系，函数不再依赖某个元素，将元素的值改以参数的形式传递给函数。但请注意权衡，太过又会导致参数列表冗长。</li></ol></div> <blockquote><p>函数的返回值只依赖于其输入值，这种特性就称为引用透明性（referential transparency）</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 函数的执行不仅依赖于输入值，而且会受到全局变量，输入文件，类的成员变量等诸多因素的影响</span>
<span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">count</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">++</span>counter<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_331-移除设值函数-remove-setting-method"><a href="#_331-移除设值函数-remove-setting-method" aria-hidden="true" class="header-anchor">#</a> <span id="s311">(331)移除设值函数 / Remove Setting Method</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
  <span class="token keyword">set</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token parameter">aString</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>如果不希望在对象创建之后此字段还有机会被改变，就不要为它提供设值函数。如此此字段就只能在构造函数中赋值。</li></ol></div> <h2 id="_334-以工厂函数取代构造函数-replace-constructor-with-factory-function"><a href="#_334-以工厂函数取代构造函数-replace-constructor-with-factory-function" aria-hidden="true" class="header-anchor">#</a> <span id="s334">(334)以工厂函数取代构造函数 / Replace Constructor with Factory Function</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> LeadEngineer<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>leadEngineer<span class="token punctuation">,</span><span class="token string">'E'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> LeadEngineer<span class="token operator">=</span><span class="token function">creatEngineer</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>leadEngineer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">creatEngineer</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token string">'E'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>构造函数的名字是固定的，因此无法使用比默认名字更清晰的函数名。</li></ol></div> <h2 id="_337-以命令取代函数-replace-function-with-command"><a href="#_337-以命令取代函数-replace-function-with-command" aria-hidden="true" class="header-anchor">#</a> <span id="s337">(337)以命令取代函数 / Replace Function with Command</span></h2> <p>反向重构：<a href="#s344">(344)以函数取代命令 / Replace Command with Function</a></p> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">score</span><span class="token punctuation">(</span><span class="token parameter">candidate<span class="token punctuation">,</span>medicalExam<span class="token punctuation">,</span>scoringGuild</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> result<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> healthLevel<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>

</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Scorer</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">candidate<span class="token punctuation">,</span>medicalExam<span class="token punctuation">,</span>scoringGuild</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_candidate<span class="token operator">=</span>candidate<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>medicalExam<span class="token operator">=</span>medicalExam<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_scoringGuide<span class="token operator">=</span>scoringGuide<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_result<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_healthLevel<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>这里的<code>命令</code>，是指一个对象，其中封装了一个函数调用请求。</li> <li>将函数封装成对象里的函数，這樣的對象称之为<code>命令对象 (command object)</code>，或简称<code>命令（command)</code>。</li> <li>和普通函数相比，命令对象提供了更强大的控制灵活性和更强的表能力。<span style="color:red;">但只有当特别需要命令对象提供某种能力而普通函数无法提供时，才会考虑命令对象。</span></li></ol></div> <h2 id="_344-以函数取代命令-replace-command-with-function"><a href="#_344-以函数取代命令-replace-command-with-function" aria-hidden="true" class="header-anchor">#</a> <span id="s344">(344)以函数取代命令 / Replace Command with Function</span></h2> <p>反向重构：<a href="#s337">(337)以命令取代函数 / Replace Function with Command</a></p> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">ChargeCalculator</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">customer<span class="token punctuation">,</span>usage</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_customer<span class="token operator">=</span>customer<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_usage<span class="token operator">=</span>usage<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">charge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_customer<span class="token punctuation">.</span>rate <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_usage<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">charge</span><span class="token punctuation">(</span><span class="token parameter">customer<span class="token punctuation">,</span>usage</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> customer<span class="token punctuation">.</span>rate <span class="token operator">*</span> usage<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ol><li>只是想调用一个函数，让他完成自己的工作就好，如果这个函数不是太复杂，那么命令对象可能显得费而不惠，这时就应该将其变回普通函数。</li></ol></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/workflow/refactor/simplify.html" class="prev">
          简化条件逻辑
        </a></span> <span class="next"><a href="/workflow/refactor/inherit.html">
          处理继承关系
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/workflow/assets/js/app.21f02376.js" defer></script><script src="/workflow/assets/js/31.002ecbd9.js" defer></script>
  </body>
</html>
