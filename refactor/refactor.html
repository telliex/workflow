<!DOCTYPE html>
<html lang="zh-Hans">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>重構 | 前端学习</title>
    <meta name="description" content="工作流">
    <link rel="manifest" href="/workflow/manifest.json">
  <link rel="apple-touch-icon" href="/workflow/img/logo.png">
    
    <link rel="preload" href="/workflow/assets/css/0.styles.89c56574.css" as="style"><link rel="preload" href="/workflow/assets/js/app.21f02376.js" as="script"><link rel="preload" href="/workflow/assets/js/35.0b4e016b.js" as="script"><link rel="prefetch" href="/workflow/assets/js/10.21852b11.js"><link rel="prefetch" href="/workflow/assets/js/11.f64d45b2.js"><link rel="prefetch" href="/workflow/assets/js/12.9586b2eb.js"><link rel="prefetch" href="/workflow/assets/js/13.362695f8.js"><link rel="prefetch" href="/workflow/assets/js/14.5011e510.js"><link rel="prefetch" href="/workflow/assets/js/15.602ee5a0.js"><link rel="prefetch" href="/workflow/assets/js/16.f76b32cd.js"><link rel="prefetch" href="/workflow/assets/js/17.12a6afbb.js"><link rel="prefetch" href="/workflow/assets/js/18.eab1da27.js"><link rel="prefetch" href="/workflow/assets/js/19.2b640b10.js"><link rel="prefetch" href="/workflow/assets/js/2.d5709b3c.js"><link rel="prefetch" href="/workflow/assets/js/20.3398b7c2.js"><link rel="prefetch" href="/workflow/assets/js/21.c325b732.js"><link rel="prefetch" href="/workflow/assets/js/22.c3df5e1b.js"><link rel="prefetch" href="/workflow/assets/js/23.898e6112.js"><link rel="prefetch" href="/workflow/assets/js/24.051a0bbc.js"><link rel="prefetch" href="/workflow/assets/js/25.554600d3.js"><link rel="prefetch" href="/workflow/assets/js/26.16320fe2.js"><link rel="prefetch" href="/workflow/assets/js/27.512eede4.js"><link rel="prefetch" href="/workflow/assets/js/28.3e0725db.js"><link rel="prefetch" href="/workflow/assets/js/29.5466dfa8.js"><link rel="prefetch" href="/workflow/assets/js/3.0689ac69.js"><link rel="prefetch" href="/workflow/assets/js/30.cd41e5b5.js"><link rel="prefetch" href="/workflow/assets/js/31.002ecbd9.js"><link rel="prefetch" href="/workflow/assets/js/32.a705fe0e.js"><link rel="prefetch" href="/workflow/assets/js/33.97b79008.js"><link rel="prefetch" href="/workflow/assets/js/34.3796137b.js"><link rel="prefetch" href="/workflow/assets/js/36.dd2588d5.js"><link rel="prefetch" href="/workflow/assets/js/37.b7cf03a2.js"><link rel="prefetch" href="/workflow/assets/js/38.8e43f6aa.js"><link rel="prefetch" href="/workflow/assets/js/39.2fd073aa.js"><link rel="prefetch" href="/workflow/assets/js/4.1d131f68.js"><link rel="prefetch" href="/workflow/assets/js/40.739236ee.js"><link rel="prefetch" href="/workflow/assets/js/41.77a6a6db.js"><link rel="prefetch" href="/workflow/assets/js/42.147c2537.js"><link rel="prefetch" href="/workflow/assets/js/43.98113f75.js"><link rel="prefetch" href="/workflow/assets/js/44.7e138f8f.js"><link rel="prefetch" href="/workflow/assets/js/45.18960dae.js"><link rel="prefetch" href="/workflow/assets/js/46.5facf218.js"><link rel="prefetch" href="/workflow/assets/js/47.80ebf3e6.js"><link rel="prefetch" href="/workflow/assets/js/5.cb412c95.js"><link rel="prefetch" href="/workflow/assets/js/6.59392cf1.js"><link rel="prefetch" href="/workflow/assets/js/7.62b86de1.js"><link rel="prefetch" href="/workflow/assets/js/8.455db33c.js"><link rel="prefetch" href="/workflow/assets/js/9.eab8be47.js">
    <link rel="stylesheet" href="/workflow/assets/css/0.styles.89c56574.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/workflow/" class="home-link router-link-active"><!----> <span class="site-name">前端学习</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/workflow/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://confluence.shinho.net.cn/pages/viewpage.action?pageId=17127648" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Activo
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/telliex/telliex.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/workflow/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://confluence.shinho.net.cn/pages/viewpage.action?pageId=17127648" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Activo
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/telliex/telliex.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/workflow/work/" class="sidebar-link">工作流</a></li><li><a href="/workflow/demand/" class="sidebar-link">需求分析</a></li><li><a href="/workflow/task/" class="sidebar-link">任务拆解</a></li><li><a href="/workflow/user-story/" class="sidebar-link">使用者故事</a></li><li><a href="/workflow/test-strategy/" class="sidebar-link">测试策略</a></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>TDD</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/tdd/" class="sidebar-link">认识 TDD</a></li><li><a href="/workflow/tdd/TDD-touch.html" class="sidebar-link">TDD 轻体验</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>单元测试</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/ut/" class="sidebar-link">单元测试</a></li><li><a href="/workflow/ut/ut-vue.html" class="sidebar-link">Vue 单元测试</a></li><li><a href="/workflow/ut/jest.html" class="sidebar-link">Jest</a></li><li><a href="/workflow/ut/vue-jest-callback-functions.html" class="sidebar-link">异步调用</a></li><li><a href="/workflow/ut/vue-jest-mock.html" class="sidebar-link">Mock</a></li><li><a href="/workflow/ut/vue-jest-template1.html" class="sidebar-link">Jest 实战范例 1</a></li><li><a href="/workflow/ut/vue-jest-template2.html" class="sidebar-link">Jest 实战范例 2</a></li><li><a href="/workflow/ut/vue-jest-template3.html" class="sidebar-link">Jest 实战范例 3</a></li><li><a href="/workflow/ut/vue-jest-template4.html" class="sidebar-link">Jest 实战范例 4</a></li><li><a href="/workflow/ut/vue-jest-tools.html" class="sidebar-link">工具</a></li><li><a href="/workflow/ut/ut-doit.html" class="sidebar-link">实作</a></li><li><a href="/workflow/ut/ut-question.html" class="sidebar-link">问题</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>BDD 测试</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/vue-bdd-test/" class="sidebar-link">Vue BDD 测试</a></li><li><a href="/workflow/vue-bdd-test/bdd-cucumber.html" class="sidebar-link">Cucumber</a></li><li><a href="/workflow/vue-bdd-test/bdd-nightwatch.html" class="sidebar-link">Nightwatch</a></li><li><a href="/workflow/vue-bdd-test/bdd-cuketest.html" class="sidebar-link">Cuketest</a></li><li><a href="/workflow/vue-bdd-test/bdd-report.html" class="sidebar-link">bdd report</a></li><li><a href="/workflow/vue-bdd-test/bdd-doit.html" class="sidebar-link">实作 1</a></li><li><a href="/workflow/vue-bdd-test/bdd-doit-2.html" class="sidebar-link">实作 2</a></li></ul></div></li><li><a href="/workflow/performance/" class="sidebar-link">性能测试</a></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>重构</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/refactor/" class="sidebar-link">代码坏味道</a></li><li><a href="/workflow/refactor/refactor.html" class="active sidebar-link">重構</a></li><li><a href="/workflow/refactor/encapsulate.html" class="sidebar-link">封装</a></li><li><a href="/workflow/refactor/move.html" class="sidebar-link">搬移</a></li><li><a href="/workflow/refactor/anew.html" class="sidebar-link">重新组织数据</a></li><li><a href="/workflow/refactor/simplify.html" class="sidebar-link">简化条件逻辑</a></li><li><a href="/workflow/refactor/api.html" class="sidebar-link">重构API</a></li><li><a href="/workflow/refactor/inherit.html" class="sidebar-link">处理继承关系</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>设计模式</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/workflow/designpattern/" class="sidebar-link">设计模式</a></li></ul></div></li><li><a href="/workflow/function/" class="sidebar-link">函数式编程</a></li><li><a href="/workflow/explanation/" class="sidebar-link">名词解释</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="重構"><a href="#重構" aria-hidden="true" class="header-anchor">#</a> 重構</h1> <ul><li><a href="s#106">(106)提炼函数 / Extract Function</a></li> <li><a href="s#115">(115)内联函数 / Inline Function</a></li> <li><a href="s#119">(119)提炼变量 / Extract Variable</a></li> <li><a href="s#123">(123)内联变量 / Inline Variable</a></li> <li><a href="s#124">(124)改变函数声明 / Change Function Declaration</a></li> <li><a href="s#132">(132)封装变量 / Encapsulate Variable</a></li> <li><a href="#s137">(137)变量改名 / Rename Variable</a></li> <li><a href="#s144">(140)引入参数对象 / Introduce Parameter Object</a></li> <li><a href="s#144">(144)函数组合成类 / Combine function into Class</a></li> <li><a href="s#149">(149)函数组合成变换 / Combine Function into Transform</a></li> <li><a href="s#154">(154)拆分阶段 / Split Phase</a></li></ul> <h2 id="_106-提炼函数-extract-function"><a href="#_106-提炼函数-extract-function" aria-hidden="true" class="header-anchor">#</a> <span id="s106">(106)提炼函数 / Extract Function</span></h2> <p>反向重构：<a href="#s115">内连函数(115)</a></p> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">printOwing</span><span class="token punctuation">(</span><span class="token parameter">invoice</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">printBanner</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> outstanding <span class="token operator">=</span> <span class="token function">calculateOutstanding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">function</span> <span class="token function">printBanner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;***********************&quot;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;**** Customer Owes ****&quot;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;***********************&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// print details</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`name:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>invoice<span class="token punctuation">.</span>customer<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`amount:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>outstanding<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">printOwing</span><span class="token punctuation">(</span><span class="token parameter">invoice</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">printBanner</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> outstanding <span class="token operator">=</span> <span class="token function">calculateOutstanding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">function</span> <span class="token function">printBanner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;***********************&quot;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;**** Customer Owes ****&quot;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;***********************&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">printDetails</span><span class="token punctuation">(</span>outstanding<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">printDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`name:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>invoice<span class="token punctuation">.</span>customer<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`amount:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>outstanding<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ul><li>先浏览一段代码，理解其作用，然后将其提炼到一个独立的函数，并以这段代码的用途为这函数命名。</li> <li>将意图与现实分开，如果需要浏览一段代码才能弄清楚它到底在干嘛，那就应该将其提炼到一个函数中。</li> <li>短函数常让编译器的优化功能运转更良好，因为短函数可以更容易被缓存。</li> <li>如果编程语言支持嵌套函数，就把新函数嵌套在原函数里，这能减少后面需要处理的超出作用域的变量部分。</li></ul></div> <blockquote><p>让一个函数只返回一个值</p></blockquote> <h2 id="_115-内联函数-inline-function"><a href="#_115-内联函数-inline-function" aria-hidden="true" class="header-anchor">#</a> <span id="s115">(115)内联函数 / Inline Function</span></h2> <p>反向重构：<a href="#s106">提炼函数(106)</a></p> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getRating</span><span class="token punctuation">(</span><span class="token parameter">driver</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">moreThanFiveLateDeliveries</span><span class="token punctuation">(</span>driver<span class="token punctuation">)</span><span class="token operator">?</span> <span class="token number">2</span> <span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">moreThanFiveLateDeliveries</span><span class="token punctuation">(</span><span class="token parameter">driver</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> driver<span class="token punctuation">.</span>numberOfLateDeliveries <span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getRating</span><span class="token punctuation">(</span><span class="token parameter">driver</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>driver<span class="token punctuation">.</span>numberOfLateDeliveries <span class="token operator">&gt;</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">2</span> <span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ul><li>函数若内容与名称变得同样清晰，就应该去掉这函数，直接使用内含代码。</li> <li>通过内联手法，找出那些有用的间接层，同时将无用间接层去除。</li> <li>如果函数属于一个类，并且有子类继承这函数，此时就无法使用内联。</li></ul></div> <h2 id="_119-提炼变量-extract-variable"><a href="#_119-提炼变量-extract-variable" aria-hidden="true" class="header-anchor">#</a> <span id="s119">(119)提炼变量 / Extract Variable</span></h2> <p>反向重构：<a href="#s123">内联变量(123)</a></p> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">return</span> order<span class="token punctuation">.</span>quantity <span class="token operator">*</span> order<span class="token punctuation">.</span>itemPrice <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>order<span class="token punctuation">.</span>quantity<span class="token operator">-</span><span class="token number">500</span><span class="token punctuation">)</span> <span class="token operator">*</span> order<span class="token punctuation">.</span>itemPrice <span class="token operator">*</span> <span class="token number">0.05</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span>quantity <span class="token operator">*</span> order<span class="token punctuation">.</span>itemPrice <span class="token operator">*</span> <span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> basePrice<span class="token operator">=</span> order<span class="token punctuation">.</span>quantity <span class="token operator">*</span> order<span class="token punctuation">.</span>itemPrice<span class="token punctuation">;</span>
<span class="token keyword">const</span> quantityDiscount<span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>order<span class="token punctuation">.</span>quantity<span class="token operator">-</span><span class="token number">500</span><span class="token punctuation">)</span> <span class="token operator">*</span> order<span class="token punctuation">.</span>itemPrice <span class="token operator">*</span> <span class="token number">0.05</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> shipping<span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>basePrice <span class="token operator">*</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> basePrice<span class="token operator">-</span> quantityDiscount <span class="token operator">+</span> shipping<span class="token punctuation">;</span>

</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ul><li>局部变量可以帮助我们将表达式分解为比较容易管理的形式。面对一块复杂逻辑时，局部变量使我能将其中一部分命名，这样就能很好的理解这部份逻辑是要干什么。</li></ul></div> <h2 id="_123-内联变量-inline-variable"><a href="#_123-内联变量-inline-variable" aria-hidden="true" class="header-anchor">#</a> <span id="s123">(123)内联变量 / Inline Variable</span></h2> <p>反向重构：<a href="#s119">提炼变量(119)</a></p> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> basePrice <span class="token operator">=</span> anOrder<span class="token punctuation">.</span>basePrice<span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token punctuation">(</span>basePrice <span class="token operator">&gt;</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">return</span> anOrder<span class="token punctuation">.</span>basePrice <span class="token operator">&gt;</span> <span class="token number">1000</span><span class="token punctuation">;</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ul><li>有时候变量的名字并不比表达式本身更具表现力，也可能变量会妨碍重构，此时就应该考虑消除变量。</li> <li>如果变量没有被声名为不可更改，重构前为确保该变量只被赋值一次，可先将其宣告为不可修改，再进行测试。</li></ul></div> <h2 id="_124-改变函数声明-change-function-declaration"><a href="#_124-改变函数声明-change-function-declaration" aria-hidden="true" class="header-anchor">#</a> <span id="s124">(124)改变函数声明 / Change Function Declaration</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">circum</span><span class="token punctuation">(</span><span class="token parameter">radius</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>  <span class="token comment">// circum 围绕</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">circumference</span><span class="token punctuation">(</span><span class="token parameter">radius</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>  <span class="token comment">// circumference 周长</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ul><li>一旦发现一个函数的名字不对，而有好的名字，就尽快进行更名。</li> <li>重构时先查看变更范围，自问是否能一次到位地修改函数声明及其所有的调用者。若可以，就采简单法。迁移式的作法则是渐进式的修改调用代码。</li></ul></div> <h3 id="完整范例"><a href="#完整范例" aria-hidden="true" class="header-anchor">#</a> 完整范例</h3> <h4 id="简单作法"><a href="#简单作法" aria-hidden="true" class="header-anchor">#</a> 简单作法</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">circum</span><span class="token punctuation">(</span><span class="token parameter">radius</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> radius<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">circumference</span><span class="token punctuation">(</span><span class="token parameter">radius</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> radius<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="迁移式作法"><a href="#迁移式作法" aria-hidden="true" class="header-anchor">#</a> 迁移式作法</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">circum</span><span class="token punctuation">(</span><span class="token parameter">radius</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> radius<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">circum</span><span class="token punctuation">(</span><span class="token parameter">radius</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">circumference</span><span class="token punctuation">(</span>radius<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">circumference</span><span class="token punctuation">(</span><span class="token parameter">radius</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> radius<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_132-封装变量-encapsulate-variable"><a href="#_132-封装变量-encapsulate-variable" aria-hidden="true" class="header-anchor">#</a> <span id="s132">(132)封装变量 / Encapsulate Variable</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> defaultOwner<span class="token operator">=</span><span class="token punctuation">{</span>firstName<span class="token punctuation">:</span><span class="token string">&quot;Martin&quot;</span><span class="token punctuation">,</span>lastName<span class="token punctuation">:</span><span class="token string">&quot;Fowler&quot;</span><span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> defaultOwnerData<span class="token operator">=</span><span class="token punctuation">{</span>firstName<span class="token punctuation">:</span><span class="token string">&quot;Martin&quot;</span><span class="token punctuation">,</span>lastName<span class="token punctuation">:</span><span class="token string">&quot;Fowler&quot;</span><span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">defaultOwner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> efaultOwnerData<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">setDefaultOwner</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  defaultOwnerData<span class="token operator">=</span>arg<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ul><li>如果想要搬移一处被广泛使用的数据，最好的办法往往是以函数的形式封装所有对该数据的访问。</li> <li>封装能提供一个清晰的观测点，可以由此监控数据的变化和使用情况。还可轻松地添加数据被修改时的验证或后续逻辑。</li></ul></div> <h2 id="_137-变量改名-rename-variable"><a href="#_137-变量改名-rename-variable" aria-hidden="true" class="header-anchor">#</a> <span id="s137">(137)变量改名 / Rename Variable</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> a<span class="token operator">=</span> height <span class="token operator">*</span> width<span class="token punctuation">;</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> area<span class="token operator">=</span>height <span class="token operator">*</span> width<span class="token punctuation">;</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ul><li>好的变量命名可以解释一段程序在干嘛。</li> <li>可以把类型信息也放进名称里(cCustomer)。</li></ul></div> <h2 id="_140-引入参数对象-introduce-parameter-object"><a href="#_140-引入参数对象-introduce-parameter-object" aria-hidden="true" class="header-anchor">#</a> <span id="s140">(140)引入参数对象 / Introduce Parameter Object</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">amountInvoiced</span><span class="token punctuation">(</span><span class="token parameter">startDate<span class="token punctuation">,</span>endDate</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">amountReceived</span><span class="token punctuation">(</span><span class="token parameter">startDate<span class="token punctuation">,</span>endDate</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">amountOverdue</span><span class="token punctuation">(</span><span class="token parameter">startDate<span class="token punctuation">,</span>endDate</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">amountInvoiced</span><span class="token punctuation">(</span><span class="token parameter">aDateRange</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">amountReceived</span><span class="token punctuation">(</span><span class="token parameter">aDateRange</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">amountOverdue</span><span class="token punctuation">(</span><span class="token parameter">aDateRange</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ul><li>一组数据项总是结伴同行，出没于一个个的函数。这样的数据我们称为<code>数据泥团</code>。</li> <li>此项重构方法最重要的意义在于，它会催生代码中更深层的改变。一旦识别出新的数据结构，我就可以重组程序的行为来使用这些结构。</li></ul></div> <h2 id="_144-函数组合成类-combine-function-into-class"><a href="#_144-函数组合成类-combine-function-into-class" aria-hidden="true" class="header-anchor">#</a> <span id="s144">(144)函数组合成类 / Combine function into Class</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">base</span><span class="token punctuation">(</span><span class="token parameter">aReading</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">taxableCharge</span><span class="token punctuation">(</span><span class="token parameter">aReading</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">calculateBaseCharge</span><span class="token punctuation">(</span><span class="token parameter">aReading</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Reading</span><span class="token punctuation">{</span>
  <span class="token function">base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
  <span class="token function">taxableCharge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
  <span class="token function">calculateBaseCharge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ul><li>相比嵌套函数，我们更倾向于类，前者测试起来较困难。</li> <li>如果想对外暴露多个函数，必须采用类的形式。</li></ul></div> <h2 id="_149-函数组合成变换-combine-function-into-transform"><a href="#_149-函数组合成变换-combine-function-into-transform" aria-hidden="true" class="header-anchor">#</a> <span id="s149">(149)函数组合成变换 / Combine Function into Transform</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">base</span><span class="token punctuation">(</span><span class="token parameter">aReading</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">taxableCharge</span><span class="token punctuation">(</span><span class="token parameter">aReading</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">enrichReading</span><span class="token punctuation">(</span><span class="token parameter">argReading</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> aReading<span class="token operator">=</span>_<span class="token punctuation">.</span><span class="token function">cloneDeep</span><span class="token punctuation">(</span>argReading<span class="token punctuation">)</span><span class="token punctuation">;</span>
  aReading<span class="token punctuation">.</span>baseCharge<span class="token operator">=</span><span class="token function">base</span><span class="token punctuation">(</span>aReading<span class="token punctuation">)</span><span class="token punctuation">;</span>
  aReading<span class="token punctuation">.</span>taxableCharge<span class="token operator">=</span><span class="token function">taxableCharge</span><span class="token punctuation">(</span>aReading<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> aReading<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ul><li>数据变换函数：这种函数接受原数据作为输入，计算出所有的派生数据，将派生数据以字段形式填入输出数据。有了变换函数，始终只需要在在函数中检查计算派生数据的逻辑。</li> <li>替代方案是<code>函数组合成类(144)</code>，作法是先利用源数据創建类，再把相关的逻辑搬到类中</li></ul></div> <h2 id="_154-拆分阶段-split-phase"><a href="#_154-拆分阶段-split-phase" aria-hidden="true" class="header-anchor">#</a> <span id="s154">(154)拆分阶段 / Split Phase</span></h2> <div class="warning custom-block"><p class="custom-block-title">简式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> orderData<span class="token operator">=</span>orderString<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/\s+/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> productPrice<span class="token operator">=</span>priceList<span class="token punctuation">[</span>orderData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> orderPrice<span class="token operator">=</span><span class="token function">parseInt</span><span class="token punctuation">(</span>orderDeta<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> productPrice<span class="token punctuation">;</span>
</code></pre></div><p style="text-align:center">⇩</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> orderRecord<span class="token operator">=</span><span class="token function">parseOrder</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> orderPrice<span class="token operator">=</span><span class="token function">price</span><span class="token punctuation">(</span>orderRecord<span class="token punctuation">,</span>priceList<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">parseOrder</span><span class="token punctuation">(</span><span class="token parameter">aString</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> values<span class="token operator">=</span>aString<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/\s+/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    productID<span class="token punctuation">:</span>values<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    quantity<span class="token punctuation">:</span><span class="token function">parseInt</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">price</span><span class="token punctuation">(</span><span class="token parameter">order<span class="token punctuation">,</span>priceList</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> order<span class="token punctuation">.</span>quantity <span class="token operator">*</span> priceList<span class="token punctuation">[</span>order<span class="token punctuation">.</span>productID<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">动机</p> <ul><li>一段代码在同一时间处理两件不同的事，应把它拆成各自独立的模块，如此，需要修改的时候，就可以单独处理每个主题，不用考虑其他。</li></ul></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/workflow/refactor/" class="prev router-link-active">
          代码坏味道
        </a></span> <span class="next"><a href="/workflow/refactor/encapsulate.html">
          封装
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/workflow/assets/js/app.21f02376.js" defer></script><script src="/workflow/assets/js/35.0b4e016b.js" defer></script>
  </body>
</html>
